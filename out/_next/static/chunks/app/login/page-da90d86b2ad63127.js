(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[626],{97479:function(e,t,a){Promise.resolve().then(a.bind(a,56823))},56823:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return b}});var i=a(57437),s=a(2265),r=a(99376),n=a(62950),l=a(58856),o=a(5978),c=a(8858);let d=async(e,t)=>{await (0,c.uo)();let a=(0,c.hi)();if(!a)throw Error("Firestore no est\xe1 inicializado");let i=(0,o.JU)(a,e,t),s=await (0,o.QT)(i);return s.exists()?{id:s.id,...s.data()}:null},u=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];await (0,c.uo)();let a=(0,c.hi)();if(!a)throw Error("Firestore no est\xe1 inicializado");let i=(0,o.hJ)(a,e),s=(0,o.IO)(i);return t.forEach(e=>{"where"===e.type?s=(0,o.IO)(s,(0,o.ar)(e.field,e.operator,e.value)):"orderBy"===e.type?s=(0,o.IO)(s,(0,o.Xo)(e.field,e.direction||"asc")):"limit"===e.type&&(s=(0,o.IO)(s,(0,o.b9)(e.value)))}),(await (0,o.PL)(s)).docs.map(e=>({id:e.id,...e.data()}))},m=async(e,t)=>{await (0,c.uo)();let a=(0,c.hi)();if(!a)throw Error("Firestore no est\xe1 inicializado");let i=(0,o.hJ)(a,e),s={...t,createdAt:(0,o.serverTimestamp)(),updatedAt:(0,o.serverTimestamp)()};return(await (0,o.ET)(i,s)).id},h=async(e,t,a)=>{await (0,c.uo)();let i=(0,c.hi)();if(!i)throw Error("Firestore no est\xe1 inicializado");let s=(0,o.JU)(i,e,t);await (0,o.pl)(s,{...a,updatedAt:(0,o.serverTimestamp)()},{merge:!0})};var x=a(12381),p=a(53459),g=a(67350),f=a(23340),v=a(74291),j=a(40279),w=a(75060);function y(e){let{isOpen:t,onOpenChange:a,mode:r,onAuth:n}=e,[l,o]=(0,s.useState)(""),[c,d]=(0,s.useState)(""),[u,m]=(0,s.useState)(""),[h,g]=(0,s.useState)(!1),{toast:y}=(0,f.pm)(),b=async e=>{if(e.preventDefault(),!l||!c){y({variant:"destructive",title:"Error",description:"Por favor completa todos los campos."});return}if("signup"===r&&c!==u){y({variant:"destructive",title:"Error",description:"Las contrase\xf1as no coinciden."});return}if(c.length<6){y({variant:"destructive",title:"Error",description:"La contrase\xf1a debe tener al menos 6 caracteres."});return}g(!0);try{await n(l,c),o(""),d(""),m(""),a(!1)}catch(t){console.error("Error en autenticaci\xf3n:",t);let e="No se pudo completar la operaci\xf3n.";"auth/email-already-in-use"===t.code?e="Este correo electr\xf3nico ya est\xe1 en uso.":"auth/invalid-email"===t.code?e="El correo electr\xf3nico no es v\xe1lido.":"auth/weak-password"===t.code?e="La contrase\xf1a es muy d\xe9bil.":"auth/user-not-found"===t.code?e="No existe una cuenta con este correo electr\xf3nico.":"auth/wrong-password"===t.code?e="La contrase\xf1a es incorrecta.":t.message&&(e=t.message),y({variant:"destructive",title:"Error",description:e})}finally{g(!1)}};return(0,i.jsx)(v.Vq,{open:t,onOpenChange:a,children:(0,i.jsxs)(v.cZ,{className:"sm:max-w-[425px]",children:[(0,i.jsxs)(v.fK,{children:[(0,i.jsx)(v.$N,{children:"login"===r?"Iniciar Sesi\xf3n":"Crear Cuenta"}),(0,i.jsx)(v.Be,{children:"login"===r?"Ingresa tu correo electr\xf3nico y contrase\xf1a para iniciar sesi\xf3n.":"Crea una cuenta nueva con tu correo electr\xf3nico y contrase\xf1a."})]}),(0,i.jsxs)("form",{onSubmit:b,className:"space-y-4",children:[(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(w._,{htmlFor:"email",children:"Correo electr\xf3nico"}),(0,i.jsx)(j.I,{id:"email",type:"email",placeholder:"tu@email.com",value:l,onChange:e=>o(e.target.value),disabled:h,required:!0})]}),(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(w._,{htmlFor:"password",children:"Contrase\xf1a"}),(0,i.jsx)(j.I,{id:"password",type:"password",placeholder:"••••••••",value:c,onChange:e=>d(e.target.value),disabled:h,required:!0,minLength:6})]}),"signup"===r&&(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(w._,{htmlFor:"confirmPassword",children:"Confirmar contrase\xf1a"}),(0,i.jsx)(j.I,{id:"confirmPassword",type:"password",placeholder:"••••••••",value:u,onChange:e=>m(e.target.value),disabled:h,required:!0,minLength:6})]}),(0,i.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,i.jsx)(x.z,{type:"button",variant:"outline",onClick:()=>a(!1),disabled:h,children:"Cancelar"}),(0,i.jsx)(x.z,{type:"submit",disabled:h,children:h?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(p.Z,{className:"mr-2 h-4 w-4 animate-spin"}),"login"===r?"Iniciando sesi\xf3n...":"Creando cuenta..."]}):"login"===r?"Iniciar Sesi\xf3n":"Crear Cuenta"})]})]})]})})}function b(){let e=(0,r.useRouter)(),{user:t,loading:a}=(0,n.E)(),{toast:o}=(0,f.pm)(),[c,v]=(0,s.useState)(!1),[j,w]=(0,s.useState)("login"),[b,N]=(0,s.useState)(!1),[C,E]=(0,s.useState)(!1),D=(0,s.useRef)(!1);(0,s.useEffect)(()=>{a||!t||C||k(t)},[t,a,C]);let k=(0,s.useCallback)(async t=>{if(!D.current&&!C){D.current=!0,E(!0);try{await d("users",t.uid)||await h("users",t.uid,{uid:t.uid,email:t.email,displayName:t.displayName||"Invitado"});let a="users/".concat(t.uid,"/canvasBoards"),i=null;try{let e=await u(a,[{type:"orderBy",field:"updatedAt",direction:"desc"},{type:"limit",value:1}]);e.length>0&&(i=e[0].id)}catch(t){let e=await u(a);e.length>0&&(i=e[0].id)}i||(i=await m(a,{name:"Mi Primer Tablero",userId:t.uid}),o({title:"\xa1Bienvenido!",description:"Hemos creado tu primer tablero."})),console.log("\uD83D\uDE80 Redirigiendo a:","/board/".concat(i,"/")),e.push("/board/".concat(i,"/"))}catch(e){console.error("Error:",e),D.current=!1,E(!1),o({variant:"destructive",title:"Error",description:"No se pudo cargar el tablero."})}}},[C,e,o]),I=(0,s.useCallback)(async()=>{if(console.log("\uD83D\uDD35 handleGoogleLogin llamado",{isLoggingIn:b,authLoading:a}),b){console.log("⚠️ Ya est\xe1 iniciando sesi\xf3n, ignorando click");return}N(!0),D.current=!1;try{var e;console.log("\uD83D\uDD04 Iniciando login Google...");let t=await (0,l.qj)();console.log("✅ Login exitoso:",null==t?void 0:null===(e=t.user)||void 0===e?void 0:e.email),(null==t?void 0:t.user)&&await k(t.user)}catch(e){console.error("❌ Error login Google:",e),console.error("❌ Error completo:",JSON.stringify(e,null,2)),o({variant:"destructive",title:"Error",description:(null==e?void 0:e.message)||(null==e?void 0:e.toString())||"Error al iniciar sesi\xf3n."}),N(!1)}},[b,a,k,o]),S=(0,s.useCallback)(async()=>{if(console.log("\uD83D\uDD35 handleGuestLogin llamado",{isLoggingIn:b,authLoading:a}),b){console.log("⚠️ Ya est\xe1 iniciando sesi\xf3n, ignorando click");return}N(!0),D.current=!1;try{console.log("\uD83D\uDD04 Iniciando login invitado...");let e=await (0,l.I2)();console.log("✅ Login invitado exitoso"),(null==e?void 0:e.user)&&await k(e.user)}catch(e){console.error("❌ Error login invitado:",e),console.error("❌ Error completo:",JSON.stringify(e,null,2)),o({variant:"destructive",title:"Error",description:(null==e?void 0:e.message)||(null==e?void 0:e.toString())||"Error al iniciar sesi\xf3n."}),N(!1)}},[b,a,k,o]),z=(0,s.useCallback)(async(e,t)=>{D.current=!1;try{let a="login"===j?await (0,l.Ry)(e,t):await (0,l.ol)(e,t);(null==a?void 0:a.user)&&await k(a.user)}catch(e){throw e}},[j,k]);return C||b&&D.current?(0,i.jsxs)("div",{className:"flex h-screen w-full flex-col items-center justify-center",style:{backgroundColor:"#96e4e6"},children:[(0,i.jsx)(p.Z,{className:"h-8 w-8 animate-spin text-slate-900"}),(0,i.jsx)("p",{className:"mt-4 text-lg font-semibold text-slate-900",children:"Cargando tu tablero..."})]}):(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("div",{className:"min-h-screen w-full flex flex-col items-center justify-center",style:{backgroundColor:"#96e4e6"},children:(0,i.jsxs)("div",{className:"w-full max-w-md px-6",children:[(0,i.jsxs)("div",{className:"flex flex-col items-center mb-10 text-center",children:[(0,i.jsx)("div",{className:"h-16 w-16 bg-black rounded-full flex items-center justify-center mb-4 shadow-lg",children:(0,i.jsxs)("svg",{width:"36",height:"36",viewBox:"0 0 36 36",fill:"none",children:[(0,i.jsx)("defs",{children:(0,i.jsxs)("linearGradient",{id:"logoGradient",x1:"0%",y1:"0%",x2:"100%",y2:"0%",children:[(0,i.jsx)("stop",{offset:"0%",stopColor:"#00ffaa"}),(0,i.jsx)("stop",{offset:"50%",stopColor:"#00d4ff"}),(0,i.jsx)("stop",{offset:"100%",stopColor:"#0066ff"})]})}),(0,i.jsx)("path",{d:"M6 18C6 14 8 12 12 12C14 12 16 13 18 14C20 15 22 16 24 16C26 16 28 15 30 14C32 13 34 14 34 18C34 22 32 24 30 24C28 24 26 23 24 22C22 21 20 20 18 20C16 20 14 21 12 22C10 23 8 22 6 18Z",fill:"url(#logoGradient)"})]})}),(0,i.jsx)("h1",{className:"text-4xl font-bold text-slate-900 mb-2",children:"Mi cerebro"}),(0,i.jsx)("p",{className:"text-slate-500 text-lg",children:"Tu lienzo de ideas infinitas."})]}),(0,i.jsxs)("div",{className:"bg-white p-8 rounded-2xl shadow-xl",children:[a?(0,i.jsxs)("div",{className:"flex flex-col items-center justify-center py-8",children:[(0,i.jsx)(p.Z,{className:"h-8 w-8 animate-spin text-slate-400"}),(0,i.jsx)("p",{className:"mt-4 text-slate-500",children:"Inicializando..."})]}):(0,i.jsxs)("div",{className:"space-y-4",children:[(0,i.jsxs)(x.z,{onClick:e=>{e.preventDefault(),e.stopPropagation(),console.log("\uD83D\uDFE2 Bot\xf3n Google clickeado"),I()},disabled:b||a,size:"lg",className:"w-full",type:"button",children:[b?(0,i.jsx)(p.Z,{className:"h-5 w-5 animate-spin mr-2"}):(0,i.jsx)("img",{src:"/google-logo.svg",alt:"Google",width:20,height:20,className:"mr-2"}),b?"Iniciando...":"Iniciar con Google"]}),(0,i.jsxs)("div",{className:"relative",children:[(0,i.jsx)("div",{className:"absolute inset-0 flex items-center",children:(0,i.jsx)("span",{className:"w-full border-t border-slate-200"})}),(0,i.jsx)("div",{className:"relative flex justify-center text-xs uppercase",children:(0,i.jsx)("span",{className:"bg-white px-2 text-slate-400",children:"O contin\xfaa como"})})]}),(0,i.jsxs)(x.z,{onClick:e=>{e.preventDefault(),e.stopPropagation(),console.log("\uD83D\uDFE2 Bot\xf3n Invitado clickeado"),S()},disabled:b||a,size:"lg",variant:"default",className:"w-full bg-[#16b5a8] hover:bg-[#139c91] text-white",type:"button",children:[b?(0,i.jsx)(p.Z,{className:"h-5 w-5 animate-spin mr-2"}):(0,i.jsx)(g.Z,{className:"h-5 w-5 mr-2"}),b?"Iniciando...":"Invitado"]})]}),(0,i.jsxs)("div",{className:"mt-6 text-center space-x-2",children:[(0,i.jsx)("button",{onClick:()=>{w("login"),v(!0)},className:"text-blue-600 hover:text-blue-700 underline text-sm",type:"button",disabled:a,children:"Log in"}),(0,i.jsx)("span",{className:"text-slate-400",children:"/"}),(0,i.jsx)("button",{onClick:()=>{w("signup"),v(!0)},className:"text-blue-600 hover:text-blue-700 underline text-sm",type:"button",disabled:a,children:"Crear Cuenta"})]})]})]})}),(0,i.jsx)(y,{isOpen:c,onOpenChange:v,mode:j,onAuth:z})]})}},67350:function(e,t,a){"use strict";a.d(t,{Z:function(){return i}});let i=(0,a(96471).Z)("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]])}},function(e){e.O(0,[358,637,279,899,876,712,656,53,971,117,744],function(){return e(e.s=97479)}),_N_E=e.O()}]);