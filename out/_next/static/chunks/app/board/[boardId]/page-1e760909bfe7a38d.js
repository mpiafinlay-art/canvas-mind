(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[872],{58781:function(e,t,a){Promise.resolve().then(a.bind(a,39818))},39818:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return aZ}});var n=a(57437),r=a(99376),s=a(2265),l=a(53459),i=a(62950),o=a(8858),c=a(3011),d=a(5978);let u="localhost"===window.location.hostname,p=e=>{let t=localStorage.getItem("dev_board_".concat(e,"_elements"));return t?JSON.parse(t):[]},m=(e,t)=>{localStorage.setItem("dev_board_".concat(e,"_elements"),JSON.stringify(t))},h=e=>{let t=localStorage.getItem("dev_board_".concat(e));if(t)return JSON.parse(t);let a={id:e,name:"Tablero de Desarrollo",userId:"dev-user",createdAt:new Date,updatedAt:new Date};return localStorage.setItem("dev_board_".concat(e),JSON.stringify(a)),a},x=()=>{let e=(0,o.hi)();if(!e)throw Error("Firestore no est\xe1 inicializado");return e},g=(0,c.U)((e,t)=>({elements:[],board:null,selectedElementIds:[],isLoading:!0,error:null,unsubscribeElements:null,loadBoard:async(a,n)=>{var r;let s=t();if(s.isLoading&&(null===(r=s.board)||void 0===r?void 0:r.id)===a)return console.log("⏸️ Tablero ya se est\xe1 cargando:",a),a;let{unsubscribeElements:l}=t();if(l&&(l(),e({unsubscribeElements:null})),e({isLoading:!0,error:null}),u)return console.log("\uD83D\uDD27 MODO DESARROLLO: usando localStorage"),e({board:h(a),elements:p(a),isLoading:!1,error:null}),a;try{let r;let s=x(),l=(0,d.JU)(s,"users",n,"canvasBoards",a),i=await (0,d.QT)(l);if(!i.exists())throw Error("El tablero no existe o no tienes permiso para verlo.");let o=i.data(),c={id:i.id,...o,userId:o.userId||o.ownerId||n},u=(0,d.hJ)(s,"users",n,"canvasBoards",a,"canvasElements");try{let a=(0,d.IO)(u,(0,d.Xo)("zIndex","asc"));r=(0,d.cf)(a,a=>{let n=a.docs.map(e=>({id:e.id,...e.data()})),r=t().elements,s=new Set(r.map(e=>e.id)),l=new Set(n.map(e=>e.id));s.size!==l.size||Array.from(s).some(e=>!l.has(e))||Array.from(l).some(e=>!s.has(e))||0===r.length?e({elements:n,isLoading:!1}):r.some(e=>{let t=n.find(t=>t.id===e.id);return!t||JSON.stringify(e.content)!==JSON.stringify(t.content)||JSON.stringify(e.properties)!==JSON.stringify(t.properties)||e.zIndex!==t.zIndex})&&e({elements:n,isLoading:!1})},a=>{console.error("Error en listener de elementos:",a),r&&r();let n=(0,d.cf)(u,a=>{let n=a.docs.map(e=>({id:e.id,...e.data()}));n.sort((e,t)=>{let a=e.zIndex||0,n=t.zIndex||0;return a-n});let r=t().elements,s=new Set(r.map(e=>e.id)),l=new Set(n.map(e=>e.id));s.size!==l.size||Array.from(s).some(e=>!l.has(e))||Array.from(l).some(e=>!s.has(e))||0===r.length?e({elements:n,isLoading:!1}):r.some(e=>{let t=n.find(t=>t.id===e.id);return!t||JSON.stringify(e.content)!==JSON.stringify(t.content)||JSON.stringify(e.properties)!==JSON.stringify(t.properties)||e.zIndex!==t.zIndex})&&e({elements:n,isLoading:!1})},t=>{console.error("Error en listener de elementos (fallback):",t),e({isLoading:!1,error:t.message})});e({unsubscribeElements:n})})}catch(a){console.warn("orderBy fall\xf3, usando sin orden:",a),r=(0,d.cf)(u,a=>{let n=a.docs.map(e=>({id:e.id,...e.data()}));n.sort((e,t)=>{let a=e.zIndex||0,n=t.zIndex||0;return a-n});let r=t().elements,s=new Set(r.map(e=>e.id)),l=new Set(n.map(e=>e.id));s.size!==l.size||Array.from(s).some(e=>!l.has(e))||Array.from(l).some(e=>!s.has(e))||0===r.length?e({elements:n,isLoading:!1}):r.some(e=>{let t=n.find(t=>t.id===e.id);return!t||JSON.stringify(e.content)!==JSON.stringify(t.content)||JSON.stringify(e.properties)!==JSON.stringify(t.properties)||e.zIndex!==t.zIndex})&&e({elements:n,isLoading:!1})},t=>{console.error("Error en listener de elementos:",t),e({isLoading:!1,error:t.message})})}return e({board:c,unsubscribeElements:r,selectedElementIds:[],isLoading:!1}),console.log("✅ [boardStore] Tablero cargado exitosamente:",{boardId:a,userId:n,boardName:c.name}),a}catch(t){return console.error("❌ [boardStore] Error al cargar el tablero:",t),e({isLoading:!1,error:t.message,board:null,elements:[]}),null}},cleanup:()=>{let{unsubscribeElements:a}=t();a&&(a(),e({unsubscribeElements:null}))},createBoard:async function(n){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Mi Primer Tablero";if(t().isLoading)return console.log("⏸️ Ya hay una operaci\xf3n en progreso, esperando..."),new Promise(e=>{let a=setInterval(()=>{t().isLoading||(clearInterval(a),e(t().createBoard(n,r)))},100)});e({isLoading:!0,error:null});try{let t=x(),{serverTimestamp:s}=await Promise.resolve().then(a.bind(a,5978)),l={name:r,userId:n,createdAt:s(),updatedAt:s()},i=await (0,d.ET)((0,d.hJ)(t,"users",n,"canvasBoards"),l);return console.log("✅ Nuevo tablero creado con ID:",i.id),e({isLoading:!1}),i.id}catch(t){return console.error("❌ Error al crear el tablero:",t),e({error:t.message,isLoading:!1}),""}},addElement:async a=>{let{board:n,elements:r}=t();if(!n)return;if(u){let t={...a,id:"dev-".concat(Date.now(),"-").concat(Math.random().toString(36).substr(2,9))},s=[...r,t];e({elements:s}),m(n.id,s),console.log("\uD83D\uDD27 DEV: Elemento a\xf1adido",t.id);return}let s=n.userId||n.ownerId;if(!s){console.error("No se pudo obtener userId para a\xf1adir elemento");return}try{let e=x(),t=(0,d.hJ)(e,"users",s,"canvasBoards",n.id,"canvasElements");await (0,d.ET)(t,a)}catch(e){console.error("Error al a\xf1adir el elemento:",e)}},updateElement:async(a,n)=>{let{board:r,elements:s}=t();if(!r)return;if(u){let t=s.map(e=>e.id===a?{...e,...n}:e);e({elements:t}),m(r.id,t);return}let l=r.userId||r.ownerId;if(!l){console.error("No se pudo obtener userId para actualizar elemento");return}try{let e=x(),t=(0,d.JU)(e,"users",l,"canvasBoards",r.id,"canvasElements",a);await (0,d.r7)(t,n)}catch(e){console.error("Error al actualizar el elemento:",e)}},deleteElement:async a=>{let{board:n,elements:r}=t();if(!n)return;if(u){let t=r.filter(e=>e.id!==a);e({elements:t}),m(n.id,t),console.log("\uD83D\uDD27 DEV: Elemento eliminado",a);return}let s=n.userId||n.ownerId;if(!s){console.error("No se pudo obtener userId para eliminar elemento");return}try{let e=x(),t=(0,d.JU)(e,"users",s,"canvasBoards",n.id,"canvasElements",a);await (0,d.oe)(t)}catch(e){console.error("Error al eliminar el elemento:",e)}},setSelectedElementIds:t=>{e({selectedElementIds:t})}}));var f=a(23340),v=a(63996);let b=e=>{let[t,a]=(0,s.useState)(!1);return(0,s.useEffect)(()=>{let t=window.matchMedia(e),n=()=>a(t.matches);return n(),t.addEventListener("change",n),()=>t.removeEventListener("change",n)},[e]),t};var j=a(60062);async function w(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:200;return new Promise((a,n)=>{let r=new FileReader;r.onload=r=>{var s;let l=new Image;l.onload=()=>{let r=document.createElement("canvas"),s=l.width,i=l.height;if((s>1920||i>1920)&&(s>i?(i=i/s*1920,s=1920):(s=s/i*1920,i=1920)),s>720||i>720){let e=s/i;s>i?i=(s=720)/e:s=(i=720)*e}r.width=s,r.height=i;let o=r.getContext("2d");if(!o){n(Error("No se pudo obtener el contexto del canvas"));return}o.imageSmoothingEnabled=!0,o.imageSmoothingQuality="high",o.drawImage(l,0,0,s,i);let c=l=>{r.toBlob(r=>{if(!r){n(Error("Error al comprimir la imagen"));return}let o=r.size/1024;if(o<=t||l<=.1){let n=new File([r],e.name,{type:"image/jpeg",lastModified:Date.now()});o>t&&console.warn("⚠️ Imagen comprimida pero a\xfan excede ".concat(t,"KB: ").concat(o.toFixed(2),"KB")),console.log("✅ Imagen comprimida a 72 DPI efectivo: ".concat((e.size/1024).toFixed(2),"KB → ").concat(o.toFixed(2),"KB (").concat(s,"x").concat(i,"px)")),a(n)}else c(Math.max(.1,l-.1))},"image/jpeg",l)};c(.9)},l.onerror=()=>{n(Error("Error al cargar la imagen"))},(null===(s=r.target)||void 0===s?void 0:s.result)&&(l.src=r.target.result)},r.onerror=()=>{n(Error("Error al leer el archivo"))},r.readAsDataURL(e)})}async function y(e,t,a){if(!["image/jpeg","image/jpg","image/png","image/gif","image/webp","image/svg+xml"].includes(e.type))return{success:!1,url:"",path:"",fileName:"",size:0,type:e.type,error:"Tipo de archivo no permitido. Solo se permiten im\xe1genes (JPEG, PNG, GIF, WebP, SVG)"};if(e.size>20971520)return{success:!1,url:"",path:"",fileName:"",size:e.size,type:e.type,error:"El archivo es demasiado grande. El tama\xf1o m\xe1ximo es 20MB"};if(!a)return{success:!1,url:"",path:"",fileName:"",size:e.size,type:e.type,error:"Firebase Storage no est\xe1 disponible. Verifica tu conexi\xf3n."};try{console.log("\uD83D\uDCE4 uploadFile: Iniciando subida directa a Firebase Storage:",{fileName:e.name,size:e.size,type:e.type,userId:t});let n=e;if(e.type.startsWith("image/")&&!e.type.includes("svg")){let t=(e.size/1048576).toFixed(2);console.log("\uD83D\uDCE6 Comprimiendo imagen (".concat(t,"MB) a m\xe1ximo 200KB y 72 DPI efectivo..."));try{let a=(n=await w(e,200)).size/1024;if(a>200){console.error("❌ ERROR: Archivo comprimido excede 200KB: ".concat(a.toFixed(2),"KB"));let t=(n=await w(e,200)).size/1024;if(t>200)return{success:!1,url:"",path:"",fileName:"",size:n.size,type:e.type,error:"No se pudo comprimir la imagen a menos de 200KB. Tama\xf1o final: ".concat(t.toFixed(2),"KB")}}console.log("✅ Imagen comprimida a 72 DPI efectivo: ".concat(t,"MB → ").concat(a.toFixed(2),"KB"))}catch(t){return console.error("❌ Error al comprimir imagen:",t),{success:!1,url:"",path:"",fileName:"",size:e.size,type:e.type,error:"Error al comprimir imagen. No se pudo procesar el archivo de ".concat((e.size/1048576).toFixed(2),"MB.")}}}else if(!(e.type.startsWith("image/")&&e.type.includes("svg")))return{success:!1,url:"",path:"",fileName:"",size:e.size,type:e.type,error:"Solo se permiten archivos de imagen. El archivo (".concat((e.size/1024).toFixed(2),"KB) no es una imagen v\xe1lida.")};else if(e.size>5242880)return{success:!1,url:"",path:"",fileName:"",size:e.size,type:e.type,error:"El archivo SVG (".concat((e.size/1048576).toFixed(2),"MB) excede el l\xedmite m\xe1ximo de 5MB permitido.")};let r=Date.now(),s=Math.random().toString(36).substring(2,15),l=n.name.split(".").pop()||"jpg",i="".concat(r,"_").concat(s,".").concat(l),o="users/".concat(t,"/images/").concat(i),c=(0,j.iH)(a,o),d={contentType:n.type,customMetadata:{originalName:e.name,originalSize:e.size.toString(),compressedSize:n.size.toString(),uploadedBy:t,uploadedAt:new Date().toISOString()}};console.log("\uD83D\uDCE4 uploadFile: Subiendo bytes a Storage...");let u=await (0,j.KV)(c,n,d);console.log("\uD83D\uDCE4 uploadFile: Archivo subido, obteniendo URL de descarga...");let p=await (0,j.Jt)(u.ref);return console.log("✅ uploadFile: Subida exitosa:",{url:p,path:o}),{success:!0,url:p,path:o,fileName:i,size:n.size,type:n.type}}catch(a){console.error("❌ uploadFile: Error al subir:",a);let t="Error al subir el archivo.";return"storage/unauthorized"===a.code?t="No tienes permisos para subir archivos. Verifica que est\xe9s autenticado correctamente.":"storage/quota-exceeded"===a.code?t="Se ha excedido la cuota de almacenamiento.":"storage/unauthenticated"===a.code?t="Debes estar autenticado para subir archivos.":a.message&&(t=a.message),{success:!1,url:"",path:"",fileName:"",size:e.size,type:e.type,error:t}}}var N=a(24457),C=a.n(N),k=a(93448),E=a(12381),z=a(49902),D=a(60895),S=a(56477),T=a(99049),P=a(41936),R=a(3289),I=a(13195),M=a(90759);let Z=s.forwardRef((e,t)=>{let{className:a,orientation:r="horizontal",decorative:s=!0,...l}=e;return(0,n.jsx)(M.f,{ref:t,decorative:s,orientation:r,className:(0,k.cn)("shrink-0 bg-border","horizontal"===r?"h-[1px] w-full":"h-full w-[1px]",a),...l})});function A(e){let{zoomIn:t,zoomOut:a,resetZoom:r,scale:s,centerOnElements:l,goToHome:i,selectedElement:o,onBringToFront:c,onSendToBack:d,onMoveBackward:u,isMobile:p}=e,m=(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(E.z,{variant:"ghost",size:"icon",onClick:a,className:"h-8 w-8",children:[(0,n.jsx)(z.Z,{className:"h-4 w-4"}),(0,n.jsx)("span",{className:"sr-only",children:"Alejar"})]}),(0,n.jsxs)("button",{onClick:r,className:"flex h-8 w-12 items-center justify-center rounded-sm text-sm font-medium text-muted-foreground transition-colors hover:bg-accent hover:text-accent-foreground",children:[Math.round(100*s),"%"]}),(0,n.jsxs)(E.z,{variant:"ghost",size:"icon",onClick:t,className:"h-8 w-8",children:[(0,n.jsx)(D.Z,{className:"h-4 w-4"}),(0,n.jsx)("span",{className:"sr-only",children:"Acercar"})]}),(0,n.jsx)(Z,{orientation:"vertical",className:"h-6"}),(0,n.jsxs)(E.z,{variant:"ghost",size:"icon",onClick:l,className:"h-8 w-8",children:[(0,n.jsx)(S.Z,{className:"h-4 w-4"}),(0,n.jsx)("span",{className:"sr-only",children:"Centrar en Contenido"})]}),(0,n.jsxs)(E.z,{variant:"ghost",size:"icon",onClick:i,className:"h-8 w-8",children:[(0,n.jsx)(T.Z,{className:"h-4 w-4"}),(0,n.jsx)("span",{className:"sr-only",children:"Ir al Inicio"})]}),o&&"frame"!==o.type&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(Z,{orientation:"vertical",className:"h-6 mx-1"}),(0,n.jsxs)(E.z,{variant:"ghost",size:"icon",onClick:()=>c(o.id),className:"h-8 w-8",title:"Traer al frente",children:[(0,n.jsx)(P.Z,{className:"h-4 w-4"}),(0,n.jsx)("span",{className:"sr-only",children:"Traer al frente"})]}),(0,n.jsxs)(E.z,{variant:"ghost",size:"icon",onClick:()=>u(o.id),className:"h-8 w-8",title:"Enviar hacia atr\xe1s",children:[(0,n.jsx)(R.Z,{className:"h-4 w-4"}),(0,n.jsx)("span",{className:"sr-only",children:"Enviar hacia atr\xe1s"})]}),(0,n.jsxs)(E.z,{variant:"ghost",size:"icon",onClick:()=>d(o.id),className:"h-8 w-8",title:"Enviar al fondo",children:[(0,n.jsx)(I.Z,{className:"h-4 w-4"}),(0,n.jsx)("span",{className:"sr-only",children:"Enviar al fondo"})]})]})]});return(0,n.jsx)("div",{className:(0,k.cn)("absolute z-[10002] flex items-center gap-1 rounded-lg border bg-background p-1 shadow-md",p?"bottom-4 left-1/2 -translate-x-1/2":"bottom-4 right-4"),children:m})}Z.displayName=M.f.displayName;var L=a(43728),F=a(27860),B=a(7880);let O=B.fC,_=B.xz,H=B.h_,U=s.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,n.jsx)(B.aV,{className:(0,k.cn)("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",a),...r,ref:t})});U.displayName=B.aV.displayName;let J=s.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,n.jsxs)(H,{children:[(0,n.jsx)(U,{}),(0,n.jsx)(B.VY,{ref:t,className:(0,k.cn)("fixed left-[50%] top-[50%] z-[50001] grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",a),...r})]})});J.displayName=B.VY.displayName;let q=e=>{let{className:t,...a}=e;return(0,n.jsx)("div",{className:(0,k.cn)("flex flex-col space-y-2 text-center sm:text-left",t),...a})};q.displayName="AlertDialogHeader";let K=e=>{let{className:t,...a}=e;return(0,n.jsx)("div",{className:(0,k.cn)("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",t),...a})};K.displayName="AlertDialogFooter";let V=s.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,n.jsx)(B.Dx,{ref:t,className:(0,k.cn)("text-lg font-semibold",a),...r})});V.displayName=B.Dx.displayName;let W=s.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,n.jsx)(B.dk,{ref:t,className:(0,k.cn)("text-sm text-muted-foreground",a),...r})});W.displayName=B.dk.displayName;let G=s.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,n.jsx)(B.aU,{ref:t,className:(0,k.cn)((0,E.d)(),a),...r})});G.displayName=B.aU.displayName;let Y=s.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,n.jsx)(B.$j,{ref:t,className:(0,k.cn)((0,E.d)({variant:"outline"}),"mt-2 sm:mt-0",a),...r})});function Q(e){let{isOpen:t,onOpenChange:a,onConfirm:r}=e;return(0,n.jsx)(O,{open:t,onOpenChange:a,children:(0,n.jsxs)(J,{children:[(0,n.jsxs)(q,{children:[(0,n.jsx)(V,{children:"\xbfEst\xe1s seguro?"}),(0,n.jsx)(W,{children:"Esta acci\xf3n no se puede deshacer. Se eliminar\xe1 permanentemente el elemento."})]}),(0,n.jsxs)(K,{children:[(0,n.jsx)(Y,{onClick:()=>a(!1),children:"Cancelar"}),(0,n.jsx)(G,{onClick:r,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"S\xed, eliminar"})]})]})})}Y.displayName=B.$j.displayName;let X=s.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,n.jsx)("div",{ref:t,className:(0,k.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",a),...r})});X.displayName="Card";let $=s.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,n.jsx)("div",{ref:t,className:(0,k.cn)("flex flex-col space-y-1.5 p-6",a),...r})});$.displayName="CardHeader",s.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,n.jsx)("div",{ref:t,className:(0,k.cn)("text-2xl font-semibold leading-none tracking-tight",a),...r})}).displayName="CardTitle",s.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,n.jsx)("div",{ref:t,className:(0,k.cn)("text-sm text-muted-foreground",a),...r})}).displayName="CardDescription";let ee=s.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,n.jsx)("div",{ref:t,className:(0,k.cn)("p-6 pt-0",a),...r})});ee.displayName="CardContent";let et=s.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,n.jsx)("div",{ref:t,className:(0,k.cn)("flex items-center p-6 pt-0",a),...r})});et.displayName="CardFooter";var ea=a(82521),en=a(76848),er=a(69626),es=a(24926),el=a(78868),ei=a(35465),eo=a(99342),ec=a(96888),ed=a(25229),eu=a(37287),ep=a(25518),em=a(14787),eh=a(26254),ex=a(40339),eg=a(95490),ef=a(44986),ev=a(28119),eb=a(59559),ej=a(78084);let ew=ev.fC,ey=ev.xz;ev.ZA,ev.Uv;let eN=ev.Tr;ev.Ee;let eC=s.forwardRef((e,t)=>{let{className:a,inset:r,children:s,...l}=e;return(0,n.jsxs)(ev.fF,{ref:t,className:(0,k.cn)("flex cursor-default gap-2 select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",r&&"pl-8",a),...l,children:[s,(0,n.jsx)(en.Z,{className:"ml-auto"})]})});eC.displayName=ev.fF.displayName;let ek=s.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,n.jsx)(ev.tu,{ref:t,className:(0,k.cn)("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",a),...r})});ek.displayName=ev.tu.displayName;let eE=s.forwardRef((e,t)=>{let{className:a,sideOffset:r=4,...s}=e;return(0,n.jsx)(ev.Uv,{children:(0,n.jsx)(ev.VY,{ref:t,sideOffset:r,className:(0,k.cn)("z-[50001] min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",a),...s})})});eE.displayName=ev.VY.displayName;let ez=s.forwardRef((e,t)=>{let{className:a,inset:r,...s}=e;return(0,n.jsx)(ev.ck,{ref:t,className:(0,k.cn)("relative flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",r&&"pl-8",a),...s})});ez.displayName=ev.ck.displayName,s.forwardRef((e,t)=>{let{className:a,children:r,checked:s,...l}=e;return(0,n.jsxs)(ev.oC,{ref:t,className:(0,k.cn)("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",a),checked:s,...l,children:[(0,n.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,n.jsx)(ev.wU,{children:(0,n.jsx)(eb.Z,{className:"h-4 w-4"})})}),r]})}).displayName=ev.oC.displayName,s.forwardRef((e,t)=>{let{className:a,children:r,...s}=e;return(0,n.jsxs)(ev.Rk,{ref:t,className:(0,k.cn)("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",a),...s,children:[(0,n.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,n.jsx)(ev.wU,{children:(0,n.jsx)(ej.Z,{className:"h-2 w-2 fill-current"})})}),r]})}).displayName=ev.Rk.displayName,s.forwardRef((e,t)=>{let{className:a,inset:r,...s}=e;return(0,n.jsx)(ev.__,{ref:t,className:(0,k.cn)("px-2 py-1.5 text-sm font-semibold",r&&"pl-8",a),...s})}).displayName=ev.__.displayName;let eD=s.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,n.jsx)(ev.Z0,{ref:t,className:(0,k.cn)("-mx-1 my-1 h-px bg-muted",a),...r})});eD.displayName=ev.Z0.displayName;var eS=a(64014);function eT(e){let{isOpen:t,onOpenChange:a,onConfirm:r}=e;return(0,n.jsx)(O,{open:t,onOpenChange:a,children:(0,n.jsxs)(J,{onMouseDown:e=>e.stopPropagation(),children:[(0,n.jsxs)(q,{children:[(0,n.jsx)(V,{children:"\xbfEliminar este cuaderno?"}),(0,n.jsx)(W,{children:"Esta acci\xf3n no se puede deshacer. Se eliminar\xe1 permanentemente el cuaderno y todo su contenido."})]}),(0,n.jsxs)(K,{children:[(0,n.jsx)(Y,{onClick:()=>a(!1),children:"Cancelar"}),(0,n.jsx)(G,{onClick:r,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"S\xed, eliminar"})]})]})})}function eP(e){let{getContent:t,onSave:a,debounceMs:n=2e3,disabled:r=!1,compareContent:l}=e,[i,o]=(0,s.useState)("idle"),c=(0,s.useRef)(null),d=(0,s.useRef)(null),u=(0,s.useRef)(!1),p=(0,s.useRef)(null),m=(0,s.useCallback)((e,t)=>e===t,[]);(0,s.useEffect)(()=>()=>{c.current&&clearTimeout(c.current),p.current&&clearTimeout(p.current)},[]);let h=(0,s.useCallback)(async()=>{if(!u.current)try{u.current=!0;let e=t(),n=e=>{if("string"==typeof e)return e.replace(/\s+/g," ").replace(/>\s+</g,"><").trim();if("object"==typeof e&&null!==e)try{return JSON.stringify(e)}catch(e){}return e},r=n(e),s=null!==d.current?n(d.current):null;if(null!==s&&r===s){u.current=!1;return}o("saving"),await a(e),d.current=e,o("saved"),p.current&&clearTimeout(p.current),p.current=setTimeout(()=>{o("idle")},2e3)}catch(e){console.error("Error al guardar:",e),o("error"),p.current&&clearTimeout(p.current),p.current=setTimeout(()=>{o("idle")},3e3)}finally{u.current=!1}},[t,a,l||m]),x=(0,s.useCallback)(()=>{c.current&&(clearTimeout(c.current),c.current=null)},[]);return{saveStatus:i,forceSave:(0,s.useCallback)(async()=>{x(),await h()},[x,h]),handleBlur:(0,s.useCallback)(async()=>{x(),await h()},[x,h]),handleChange:(0,s.useCallback)(()=>{r||(x(),c.current=setTimeout(()=>{h()},n))},[r,x,h,n]),cancelPendingSave:x}}var eR=a(24287),eI=a(25309),eM=a(74587);function eZ(e){let{status:t,className:a,size:r="sm"}=e,s={sm:"w-3 h-3",md:"w-4 h-4",lg:"w-5 h-5"}[r],i=()=>{switch(t){case"saving":return"Guardando...";case"saved":return"Guardado";case"error":return"Error";default:return""}};return(0,n.jsxs)("div",{className:(0,k.cn)("flex items-center gap-1 text-xs text-muted-foreground",a),title:i(),children:[(()=>{switch(t){case"saving":return(0,n.jsx)(l.Z,{className:(0,k.cn)(s,"animate-spin text-blue-500")});case"saved":return(0,n.jsx)(eR.Z,{className:(0,k.cn)(s,"text-green-500")});case"error":return(0,n.jsx)(eI.Z,{className:(0,k.cn)(s,"text-red-500")});default:return(0,n.jsx)(eM.Z,{className:(0,k.cn)(s,"text-gray-400")})}})(),"idle"!==t&&(0,n.jsx)("span",{className:"text-[10px] leading-none",children:i()})]})}var eA=a(53375),eL=a(74291),eF=a(9270);let eB=s.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,n.jsx)(eF.fC,{ref:t,className:(0,k.cn)("peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",a),...r,children:(0,n.jsx)(eF.z$,{className:(0,k.cn)("flex items-center justify-center text-current"),children:(0,n.jsx)(eb.Z,{className:"h-4 w-4"})})})});eB.displayName=eF.fC.displayName;var eO=a(75060);function e_(e){let{isOpen:t,onOpenChange:a,totalPages:r,onExport:l}=e,[i,o]=(0,s.useState)([]);(0,s.useEffect)(()=>{t&&o(Array.from({length:r},(e,t)=>t))},[t,r]);let c=e=>{o(t=>t.includes(e)?t.filter(t=>t!==e):[...t,e].sort((e,t)=>e-t))};return(0,n.jsx)(eL.Vq,{open:t,onOpenChange:a,children:(0,n.jsxs)(eL.cZ,{className:"max-w-md",children:[(0,n.jsx)(eL.fK,{children:(0,n.jsx)(eL.$N,{children:"Exportar P\xe1ginas a PDF"})}),(0,n.jsxs)("div",{className:"py-4",children:[(0,n.jsx)("div",{className:"mb-4",children:(0,n.jsx)(E.z,{variant:"outline",size:"sm",onClick:()=>{i.length===r?o([]):o(Array.from({length:r},(e,t)=>t))},className:"w-full",children:i.length===r?"Deseleccionar Todas":"Seleccionar Todas"})}),(0,n.jsx)("div",{className:"max-h-64 overflow-y-auto space-y-2",children:Array.from({length:r},(e,t)=>(0,n.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,n.jsx)(eB,{id:"page-".concat(t),checked:i.includes(t),onCheckedChange:()=>c(t)}),(0,n.jsxs)(eO._,{htmlFor:"page-".concat(t),className:"flex-1 cursor-pointer",children:["P\xe1gina ",t+1]})]},t))}),(0,n.jsx)("p",{className:"mt-4 text-sm text-muted-foreground",children:0===i.length?"Selecciona al menos una p\xe1gina para exportar":"Se exportar\xe1n ".concat(i.length," p\xe1gina").concat(i.length>1?"s":"")})]}),(0,n.jsxs)(eL.cN,{children:[(0,n.jsx)(E.z,{variant:"outline",onClick:()=>a(!1),children:"Cancelar"}),(0,n.jsx)(E.z,{onClick:()=>{0!==i.length&&(l(i),a(!1))},disabled:0===i.length,children:"Exportar PDF"})]})]})})}a(55392);var eH=a(20271);let eU=eH.fC,eJ=s.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,n.jsx)(eH.aV,{ref:t,className:(0,k.cn)("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",a),...r})});eJ.displayName=eH.aV.displayName;let eq=s.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,n.jsx)(eH.xz,{ref:t,className:(0,k.cn)("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",a),...r})});eq.displayName=eH.xz.displayName;let eK=s.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,n.jsx)(eH.VY,{ref:t,className:(0,k.cn)("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",a),...r})});eK.displayName=eH.VY.displayName;var eV=a(87928),eW=a(75980),eG=a(23846),eY=a(34368),eQ=a(13147),eX=a(91929);let e$=[{id:"all",label:"Todo",icon:eV.Z,keywords:[],color:"gray"},{id:"ideas",label:"Ideas",icon:eW.Z,keywords:["idea","pensar","crear","innovar","brainstorm"],color:"yellow"},{id:"tasks",label:"Tareas",icon:eG.Z,keywords:["hacer","tarea","pendiente","completar","check","✓","☐"],color:"blue"},{id:"notes",label:"Notas",icon:eV.Z,keywords:["nota","recordar","importante","nota:","apuntar"],color:"green"},{id:"references",label:"Referencias",icon:eY.Z,keywords:["http","www","link","url","referencia"],color:"purple"},{id:"dates",label:"Fechas",icon:eQ.Z,keywords:["fecha","d\xeda","mes","a\xf1o","deadline","vencimiento"],color:"orange"},{id:"tags",label:"Tags",icon:eX.Z,keywords:["#","tag","etiqueta","@"],color:"pink"}];function e0(e){let{content:t,onCategorySelect:a}=e,[r,l]=(0,s.useState)("all"),i=(0,s.useMemo)(()=>{let e="";"string"==typeof t?e=t.toLowerCase():"pages"in t?e=(t.pages||[]).map(e=>e.text||"").join(" ").toLowerCase():("text"in t||"content"in t)&&(e=(t.text||t.content||"").toLowerCase());let a={};return e$.forEach(t=>{if("all"===t.id)return;let n=t.keywords.filter(t=>e.includes(t.toLowerCase())).length;a[t.id]=n}),a},[t]);return(0,n.jsx)("div",{className:"px-2 py-1 border-b bg-gray-50/50",children:(0,n.jsx)(eU,{value:r,onValueChange:e=>{l(e),null==a||a("all"===e?null:e)},className:"w-full",children:(0,n.jsx)(eJ,{className:"h-7 w-full justify-start gap-1",children:e$.map(e=>{let t=e.icon,a=i[e.id]||0,r="all"!==e.id&&a>0;return(0,n.jsxs)(eq,{value:e.id,className:"h-6 px-2 text-[10px] data-[state=active]:bg-teal-500 data-[state=active]:text-white",children:[(0,n.jsx)(t,{className:"w-3 h-3 mr-1"}),(0,n.jsx)("span",{children:e.label}),r&&(0,n.jsx)("span",{className:"ml-1 px-1 py-0.5 bg-teal-500 text-white rounded text-[9px]",children:a})]},e.id)})})})})}let e1=e=>{let{currentPage:t,totalPages:a,onPageChange:r,onAddPage:s}=e;return(0,n.jsxs)("div",{className:"flex items-center justify-center gap-1",children:[(0,n.jsx)(E.z,{variant:"outline",size:"icon",className:"h-7 w-7",onClick:()=>r(t-1),disabled:0===t,children:(0,n.jsx)(ea.Z,{className:"h-4 w-4"})}),(0,n.jsxs)("span",{className:"text-sm font-medium text-muted-foreground",children:[t+1," / ",a]}),(0,n.jsx)(E.z,{variant:"outline",size:"icon",className:"h-7 w-7",onClick:()=>r(t+1),disabled:t>=a-1,children:(0,n.jsx)(en.Z,{className:"h-4 w-4"})}),(0,n.jsx)(E.z,{variant:"outline",size:"icon",className:"h-7 w-7",onClick:s,disabled:a>=20,children:(0,n.jsx)(er.Z,{className:"h-4 w-4"})})]})};var e2=a(51777);let e4=e2.fC,e5=e2.xz,e3=s.forwardRef((e,t)=>{let{className:a,align:r="center",sideOffset:s=4,...l}=e;return(0,n.jsx)(e2.h_,{children:(0,n.jsx)(e2.VY,{ref:t,align:r,sideOffset:s,className:(0,k.cn)("z-[60000] w-auto rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",a),...l})})});e3.displayName=e2.VY.displayName;var e8=a(77269),e6=a(81022),e7=a(25567);let e9=["#FF6900","#FCB900","#7BDCB5","#00D084","#8ED1FC","#0693E3","#ABB8C3","#EB144C","#F78DA7","#9900EF"],te={yellow:"#fffb8b",pink:"#ffc2d4",blue:"#bce8f1",green:"#d4edda",orange:"#ffeeba",purple:"#e9d5ff",white:"#ffffff"};var tt=a(40279),ta=a(17900),tn=a(80659),tr=a(45736),ts=a(82762);let tl=[{name:"white",label:"Blanco",value:"#ffffff"},{name:"yellow",label:"Amarillo",value:"#fffb8b"},{name:"pink",label:"Rosa",value:"#ffc2d4"},{name:"blue",label:"Azul",value:"#bce8f1"},{name:"green",label:"Verde",value:"#d4edda"},{name:"orange",label:"Naranja",value:"#ffeeba"},{name:"purple",label:"Morado",value:"#e9d5ff"}];var ti=a(33145),to=a(93529),tc=a(16859);function td(e){let{tag:t,isEditing:a,onSave:r,onCancel:l}=e,[i,o]=(0,s.useState)(t),c=(0,s.useRef)(null);return((0,s.useEffect)(()=>{o(t),a&&c.current&&(c.current.focus(),c.current.select())},[t,a]),a)?(0,n.jsx)("div",{className:"absolute -top-10 left-0 z-30",onMouseDown:e=>e.stopPropagation(),children:(0,n.jsx)(tt.I,{ref:c,id:"floating-tag-input",name:"floating-tag-input",type:"text",value:i,onChange:e=>o(e.target.value),onKeyDown:e=>{"Enter"===e.key?r(i):"Escape"===e.key&&l()},onBlur:()=>{r(i)},className:"h-8 w-48 bg-black text-white border-primary placeholder:text-gray-400",placeholder:"A\xf1adir etiqueta..."})}):t?(0,n.jsx)("div",{className:"absolute -top-8 left-0 z-20 bg-black text-white text-xs rounded-md px-2 py-1 cursor-default pointer-events-none",children:(0,n.jsx)("p",{className:"break-words leading-tight",children:t})}):null}var tu=a(76618),tp=a.n(tu),tm=a(5820),th=a(59022);let tx=[{name:"white",label:"Blanco",value:"#ffffff"},{name:"yellow",label:"Amarillo",value:"#fffb8b"},{name:"pink",label:"Rosa",value:"#ffc2d4"},{name:"blue",label:"Azul",value:"#bce8f1"},{name:"green",label:"Verde",value:"#d4edda"},{name:"orange",label:"Naranja",value:"#ffeeba"},{name:"purple",label:"Morado",value:"#e9d5ff"}];var tg=a(98012),tf=a(47677),tv=a(23818);function tb(e){return"object"==typeof e&&null!==e&&("text"in e||"content"in e)}var tj=a(46087),tw=a(13134);let ty=tw.fC,tN=s.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,n.jsx)(tw.ck,{ref:t,className:(0,k.cn)("border-b",a),...r})});tN.displayName="AccordionItem";let tC=s.forwardRef((e,t)=>{let{className:a,children:r,...s}=e;return(0,n.jsx)(tw.h4,{className:"flex",children:(0,n.jsxs)(tw.xz,{ref:t,className:(0,k.cn)("flex flex-1 items-center justify-between py-4 font-medium transition-all hover:underline [&[data-state=open]>svg]:rotate-180",a),...s,children:[r,(0,n.jsx)(R.Z,{className:"h-4 w-4 shrink-0 transition-transform duration-200"})]})})});tC.displayName=tw.xz.displayName;let tk=s.forwardRef((e,t)=>{let{className:a,children:r,...s}=e;return(0,n.jsx)(tw.VY,{ref:t,className:"overflow-hidden text-sm transition-all data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down",...s,children:(0,n.jsx)("div",{className:(0,k.cn)("pb-4 pt-0",a),children:r})})});function tE(e){let{value:t,onChange:a,isListening:r,liveTranscript:l,finalTranscript:i,interimTranscript:o}=e,[c,d]=(0,s.useState)(!1),u=(0,s.useRef)(null);return((0,s.useEffect)(()=>{if(c&&u.current){u.current.focus();let e=u.current.value.length;u.current.setSelectionRange(e,e)}},[c]),c)?(0,n.jsx)("input",{ref:u,type:"text",value:t,onChange:e=>a(e.target.value),onBlur:()=>d(!1),onKeyDown:e=>{"Enter"===e.key&&(e.preventDefault(),d(!1))},className:"flex-1 bg-transparent border-none outline-none font-medium text-sm",onClick:e=>e.stopPropagation(),onFocus:e=>{let t=e.target.value.length;e.target.setSelectionRange(t,t)}}):(0,n.jsx)("span",{onClick:e=>{e.stopPropagation(),d(!0)},className:"cursor-text text-sm",children:t||"Nuevo Item"})}function tz(e){let{value:t,onChange:r,isListening:l,liveTranscript:i,finalTranscript:o,interimTranscript:c,isSelected:d}=e,u=(0,s.useRef)(null),{handleBlur:p,handleChange:m}=eP({getContent:()=>{var e;return((null===(e=u.current)||void 0===e?void 0:e.innerHTML)||"").replace(/\s+/g," ").replace(/>\s+</g,"><").trim()},onSave:async e=>{e!==(t||"").replace(/\s+/g," ").replace(/>\s+</g,"><").trim()&&await r(e)},debounceMs:500,compareContent:(e,t)=>(e||"").replace(/\s+/g," ").replace(/>\s+</g,"><").trim()===(t||"").replace(/\s+/g," ").replace(/>\s+</g,"><").trim()}),h=(0,s.useRef)("");return(0,s.useEffect)(()=>{if(h.current!==t&&(h.current=t,u.current&&t!==u.current.innerHTML)){let e=document.activeElement===u.current,n=l&&(i||o||c);if(e||n)return;let{updateInnerHTMLPreservingCursor:r}=a(5690);r(u.current,t||"")}},[t,l,i,o,c]),(0,n.jsx)("div",{ref:u,contentEditable:!0,onBlur:p,onInput:m,className:"min-h-[50px] p-2 border border-slate-200 rounded focus:outline-none focus:ring-2 focus:ring-primary/20 text-sm",dangerouslySetInnerHTML:{__html:t||""}})}tk.displayName=tw.VY.displayName;var tD=a(50471);let tS=e=>{let{currentPage:t,totalPages:a,onPageChange:r,onAddPage:s}=e;return(0,n.jsxs)("div",{className:"flex items-center justify-center gap-1",children:[(0,n.jsx)(E.z,{variant:"outline",size:"icon",className:"h-7 w-7",onClick:()=>r(t-1),disabled:0===t,children:(0,n.jsx)(ea.Z,{className:"h-4 w-4"})}),(0,n.jsxs)("span",{className:"text-sm font-medium text-muted-foreground",children:[t+1," / ",a]}),(0,n.jsx)(E.z,{variant:"outline",size:"icon",className:"h-7 w-7",onClick:()=>r(t+1),disabled:t>=a-1,children:(0,n.jsx)(en.Z,{className:"h-4 w-4"})}),(0,n.jsx)(E.z,{variant:"outline",size:"icon",className:"h-7 w-7",onClick:s,disabled:a>=20,children:(0,n.jsx)(er.Z,{className:"h-4 w-4"})})]})};var tT=a(65265),tP=a(77101),tR=a(62360),tI=a(90887);let tM=[1,5,10,15,20,25,30,45,60],tZ=[{name:"yellow",value:"#fffb8b",label:"Amarillo"},{name:"green",value:"#d4edda",label:"Verde"},{name:"blue",value:"#bce8f1",label:"Azul"},{name:"cyan",value:"#cae3e1",label:"Calipso"},{name:"orange",value:"#ffeeba",label:"Naranjo"},{name:"purple",value:"#e9d5ff",label:"Morado"}],tA={notepad:function(e){var t,a,r;let{id:l,content:i,properties:o,onUpdate:c,deleteElement:d,isPreview:u=!1,onFormatToggle:p,isListening:m,liveTranscript:h,finalTranscript:x,interimTranscript:g,isSelected:v,minimized:b,onChangeNotepadFormat:j,onEditElement:w}=e,y=i||{},N=(0,s.useRef)(null),z=(0,s.useRef)(null),{toast:D}=(0,f.pm)(),[S,T]=(0,s.useState)(!1),[P,R]=(0,s.useState)(!1),[I,M]=(0,s.useState)(!1),[Z,A]=(0,s.useState)(!1),[F,B]=(0,s.useState)(!1),[O,_]=(0,s.useState)(null),H=null!==(r=y.currentPage)&&void 0!==r?r:0,{saveStatus:U,handleBlur:J,handleChange:q,forceSave:K}=eP({getContent:()=>u||!z.current?"":z.current.innerHTML.replace(/\s+/g," ").replace(/>\s+</g,"><").trim(),onSave:async e=>{if(u||!z.current)return;let t=y.pages||[""];if(e!==(t[H]||"").replace(/\s+/g," ").replace(/>\s+</g,"><").trim()){let a=[...t];a[H]=e,await c(l,{content:{...y,pages:a}})}},debounceMs:2e3,disabled:u,compareContent:(e,t)=>{let a=((y.pages||[""])[H]||"").replace(/\s+/g," ").replace(/>\s+</g,"><").trim(),n=(e||"").replace(/\s+/g," ").replace(/>\s+</g,"><").trim();return n===(t||"").replace(/\s+/g," ").replace(/>\s+</g,"><").trim()&&n===a}}),V=(0,s.useCallback)(async()=>{await K()},[K]);(0,s.useEffect)(()=>{if(z.current&&document.activeElement!==z.current){var e,t;let a=null!==(t=null===(e=y.pages)||void 0===e?void 0:e[H])&&void 0!==t?t:"",n="<div><br></div>"===a||"<div></div>"===a||""===a.trim()?"":a;document.activeElement!==z.current&&z.current.innerHTML!==n&&(z.current.innerHTML=n)}},[y.pages,H]);let W=(0,s.useCallback)(()=>{u||w(l)},[u,w,l]),{handleBlur:G}=eP({getContent:()=>{var e;return(null===(e=N.current)||void 0===e?void 0:e.innerText)||""},onSave:async e=>{!u&&N.current&&y.title!==e&&c(l,{content:{...y,title:e}})},debounceMs:1e3,disabled:u}),Y=(0,s.useCallback)(async()=>{!u&&N.current&&await G()},[u,G]),Q=(0,s.useCallback)(e=>{e.preventDefault();let t=e.clipboardData.getData("text/plain");t&&document.execCommand("insertText",!1,t)},[]),$=(0,s.useCallback)(e=>{var t;!u&&e>=0&&e<((null===(t=y.pages)||void 0===t?void 0:t.length)||0)&&(V(),c(l,{content:{...y,currentPage:e}}))},[u,y,c,l,V]),ea=(0,s.useCallback)(()=>{var e;if(!u&&20>((null===(e=y.pages)||void 0===e?void 0:e.length)||0)){V();let e=[...y.pages||[],""];c(l,{content:{...y,pages:e,currentPage:e.length-1}})}},[u,y,c,l,V]),en=(0,s.useCallback)(e=>{e.stopPropagation(),e.preventDefault(),u||(V(),setTimeout(()=>{let e=!!b,t=(null==o?void 0:o.size)||{width:794,height:1021},a={width:"number"==typeof t.width?t.width:parseFloat(String(t.width))||794,height:"number"==typeof t.height?t.height:parseFloat(String(t.height))||1021};if(e){let{originalSize:e,...t}=o||{};c(l,{minimized:!1,properties:{...t,size:e||{width:794,height:1021}}})}else{let e="number"==typeof t.width?t.width:parseFloat(String(t.width))||794;c(l,{minimized:!0,properties:{...o,size:{width:e,height:48},originalSize:a}})}},100))},[u,b,o,c,l,V]),er=(0,s.useCallback)(e=>{e.stopPropagation(),e.preventDefault(),u||(V(),c(l,{hidden:!0}))},[u,V,c,l]),ev=(0,s.useCallback)(async e=>{if(e.stopPropagation(),e.preventDefault(),!u)try{let e=document.querySelector('[data-element-id="'.concat(l,'"]'));if(!e){D({variant:"destructive",title:"Error",description:"No se pudo encontrar el elemento para exportar."});return}T(!0),D({title:"Exportando...",description:"Generando imagen PNG de alta resoluci\xf3n del cuaderno."}),(await C()(e,{backgroundColor:"#ffffff",scale:3,useCORS:!0,logging:!1,allowTaint:!1,windowWidth:e.scrollWidth,windowHeight:e.scrollHeight})).toBlob(e=>{if(!e){D({variant:"destructive",title:"Error",description:"No se pudo generar la imagen."}),T(!1);return}let t=URL.createObjectURL(e),a=document.createElement("a");a.href=t;let n=y.title||"cuaderno";a.download="".concat(n,"_").concat(Date.now(),".png"),document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(t),D({title:"Exportado",description:"El cuaderno se ha exportado como PNG de alta resoluci\xf3n."}),T(!1)},"image/png",1)}catch(e){console.error("Error al exportar cuaderno:",e),D({variant:"destructive",title:"Error",description:e.message||"No se pudo exportar el cuaderno."}),T(!1)}},[D,l,u,y.title]),eb=(0,s.useCallback)(async e=>{if(!u)try{R(!0),D({title:"Exportando...",description:"Generando PDF con ".concat(e.length," p\xe1gina").concat(e.length>1?"s":"",".")});let t=document.querySelector('[data-element-id="'.concat(l,'"]'));if(!t){D({variant:"destructive",title:"Error",description:"No se pudo encontrar el elemento para exportar."}),R(!1);return}let a=new eA.ZP({orientation:"portrait",unit:"px",format:[794,1021]}),n=y.currentPage||0;for(let r=0;r<e.length;r++){let s=e[r];c&&s!==n&&(c(l,{content:{...y,currentPage:s}}),await new Promise(e=>setTimeout(e,100)));let i=await C()(t,{backgroundColor:"#ffffff",scale:2,useCORS:!0,logging:!1,allowTaint:!1,windowWidth:t.scrollWidth,windowHeight:t.scrollHeight}),o=i.toDataURL("image/png");r>0&&a.addPage();let d=a.internal.pageSize.getWidth(),u=a.internal.pageSize.getHeight(),p=i.width,m=i.height,h=Math.min(d/p,u/m),x=p*h,g=m*h,f=(d-x)/2,v=(u-g)/2;a.addImage(o,"PNG",f,v,x,g)}c&&n!==y.currentPage&&c(l,{content:{...y,currentPage:n}});let r=y.title||"cuaderno";a.save("".concat(r,"_").concat(Date.now(),".pdf")),D({title:"Exportado",description:"PDF exportado con ".concat(e.length," p\xe1gina").concat(e.length>1?"s":"",".")}),R(!1)}catch(e){console.error("Error al exportar cuaderno a PDF:",e),D({variant:"destructive",title:"Error",description:e.message||"No se pudo exportar el cuaderno a PDF."}),R(!1)}},[D,l,u,y,c]);(0,s.useEffect)(()=>{let e=N.current;e&&e.innerText!==(y.title||"")&&(e.innerText=y.title||"")},[y.title]);let ej=(0,s.useCallback)((e,t,a)=>{e.preventDefault(),e.stopPropagation(),z.current&&(z.current.focus(),document.execCommand(t,!1,null!=a?a:void 0))},[]),eN=(0,s.useCallback)(e=>ej(e,"removeFormat"),[ej]),eC=(0,s.useCallback)(e=>ej(e,"insertHTML",'<span style="color: #a0a1a6;">-- '.concat((0,eS.WU)(new Date,"dd/MM/yy")," </span>")),[ej]),ek=(0,s.useCallback)(e=>{if(e.preventDefault(),e.stopPropagation(),z.current){z.current.focus();let e=document.createRange();e.selectNodeContents(z.current);let t=window.getSelection();t&&(t.removeAllRanges(),t.addRange(e))}},[]),eD=(0,s.useCallback)(()=>{d(l),B(!1)},[d,l]),eR="object"==typeof o&&null!==o?o:{},eI="10x15"===((null==eR?void 0:eR.format)||"letter"),eM="oyDN2LIr8z7VyYA5727F"===l||"FdQ656GJ94TePuHpotbY"===l||"Iz0UWQ5gQwXlkX1kGBf1"===l||"kRfKpBDg946Y99668Tih"===l?"#f8f0ad":"#ffffff",eL=(0,s.useCallback)(e=>{if(e.target.closest(".drag-handle"))return;let t="number"==typeof(null==eR?void 0:eR.zIndex)?eR.zIndex:-1;c(l,{properties:{...eR,zIndex:0},zIndex:0}),setTimeout(()=>{v||c(l,{properties:{...eR,zIndex:t},zIndex:t})},2e3)},[l,eR,c,v]),eF=u?null:(0,n.jsx)(e0,{content:y,onCategorySelect:_});return b?(0,n.jsx)(X,{className:"notepad-card w-full h-full flex items-center shadow-lg rounded-lg bg-card border-2 border-primary/50 group","data-element-id":l,children:(0,n.jsxs)("div",{className:"p-2 flex flex-row items-center gap-1 w-full cursor-grab active:cursor-grabbing drag-handle",children:[(0,n.jsx)("div",{className:"p-1",children:(0,n.jsx)(es.Z,{className:"size-5 text-muted-foreground"})}),(0,n.jsx)("p",{className:"font-headline text-sm font-semibold truncate flex-grow",children:y.title||"Sin t\xedtulo"}),(0,n.jsx)(E.z,{variant:"ghost",size:"icon",className:"size-7",title:"Maximizar",onMouseDown:e=>{e.preventDefault(),e.stopPropagation(),en(e)},children:(0,n.jsx)(el.Z,{className:"size-4"})})]})}):(0,n.jsxs)(X,{"data-element-id":l,className:"notepad-card w-full h-full flex flex-col shadow-lg rounded-lg group",style:{backgroundColor:eM},onClick:eL,children:[(0,n.jsxs)("div",{className:"p-2 border-b flex flex-row items-center gap-1 cursor-grab active:cursor-grabbing drag-handle",children:[(0,n.jsx)("div",{className:"p-1",children:(0,n.jsx)(es.Z,{className:"size-5 text-muted-foreground"})}),(0,n.jsx)("div",{ref:N,contentEditable:!u,spellCheck:"true",suppressContentEditableWarning:!0,onFocus:W,onBlur:Y,className:"bg-transparent flex-grow outline-none cursor-text font-headline text-sm font-semibold p-1","data-placeholder":"T\xedtulo",onMouseDown:e=>e.stopPropagation()}),!u&&(0,n.jsxs)("div",{onMouseDown:e=>e.stopPropagation(),className:"flex items-center",children:[(0,n.jsx)(E.z,{variant:"ghost",size:"icon",className:"size-7",title:"Guardar",onClick:V,children:(0,n.jsx)(ei.Z,{className:"size-4"})}),(0,n.jsx)(E.z,{variant:"ghost",size:"icon",className:"size-7",title:"Info",onClick:()=>A(!Z),children:(0,n.jsx)(eo.Z,{className:"size-4"})}),(0,n.jsx)(E.z,{variant:"ghost",size:"icon",className:"size-7",title:"Seleccionar Todo",onClick:ek,children:(0,n.jsx)(ec.Z,{className:"size-4"})}),(0,n.jsx)(E.z,{variant:"ghost",size:"icon",className:"size-7",title:"Limpiar Formato",onClick:eN,children:(0,n.jsx)(ed.Z,{className:"size-4"})}),p&&(0,n.jsx)(E.z,{variant:"ghost",size:"icon",className:"size-7",title:"Herramientas de Formato",onClick:p,children:(0,n.jsx)(eu.Z,{className:"size-4"})}),(0,n.jsx)(E.z,{variant:"ghost",size:"icon",className:"size-7",title:"Insertar Fecha",onClick:eC,children:(0,n.jsx)(ep.Z,{className:"size-4"})}),(0,n.jsxs)(ew,{modal:!1,children:[(0,n.jsx)(ey,{asChild:!0,children:(0,n.jsx)(E.z,{variant:"ghost",size:"icon",className:"size-7",children:(0,n.jsx)(em.Z,{className:"size-4"})})}),(0,n.jsxs)(eE,{children:[(0,n.jsxs)(ez,{onMouseDown:e=>{e.preventDefault(),e.stopPropagation(),ev(e)},disabled:S,children:[(0,n.jsx)(eh.Z,{className:"mr-2 h-4 w-4"}),(0,n.jsx)("span",{children:S?"Exportando...":"Exportar a PNG: alta resoluci\xf3n"})]}),(0,n.jsxs)(ez,{onMouseDown:e=>{e.preventDefault(),e.stopPropagation(),M(!0)},disabled:P,children:[(0,n.jsx)(eh.Z,{className:"mr-2 h-4 w-4"}),(0,n.jsx)("span",{children:P?"Exportando PDF...":"Exportar p\xe1ginas a PDF"})]}),j&&(0,n.jsxs)(ez,{onMouseDown:e=>{e.preventDefault(),e.stopPropagation(),j(l)},children:[(0,n.jsx)(ex.Z,{className:"mr-2 h-4 w-4"}),(0,n.jsx)("span",{children:"Cambiar formato..."})]})]})]}),(0,n.jsx)(E.z,{variant:"ghost",size:"icon",className:"size-7",title:b?"Maximizar":"Minimizar",onMouseDown:e=>{e.preventDefault(),e.stopPropagation(),en(e)},children:b?(0,n.jsx)(el.Z,{className:"size-4"}):(0,n.jsx)(eg.Z,{className:"size-4"})}),(0,n.jsx)(E.z,{variant:"ghost",size:"icon",className:"size-7 text-destructive hover:text-destructive",title:"Eliminar Cuaderno",onMouseDown:e=>{e.preventDefault(),e.stopPropagation(),B(!0)},children:(0,n.jsx)(L.Z,{className:"size-4"})}),(0,n.jsx)(E.z,{variant:"ghost",size:"icon",className:"size-7",title:"Cerrar",onMouseDown:er,children:(0,n.jsx)(ef.Z,{className:"size-4"})})]})]}),!b&&eF,!b&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(ee,{className:(0,k.cn)("p-0 flex-grow relative font-body","overflow-y-auto"),style:{backgroundColor:"rzBhqCTd8wwZmD8JCNEk"===l?"#fafad7":eM},children:(0,n.jsxs)("div",{className:(0,k.cn)("notepad-content-container",eI&&"small-format",("oyDN2LIr8z7VyYA5727F"===l||"FdQ656GJ94TePuHpotbY"===l||"Iz0UWQ5gQwXlk1kGBf1"===l||"kRfKpBDg946Y99668Tih"===l||"EktERYKT8kyk3JWymwbu"===l||"rzBhqCTd8wwZmD8JCNEk"===l)&&"small-typography"),"data-element-id":l,children:[(0,n.jsx)("div",{className:(0,k.cn)("notepad-lines-background",eI&&"small-format",("oyDN2LIr8z7VyYA5727F"===l||"FdQ656GJ94TePuHpotbY"===l||"Iz0UWQ5gQwXlk1kGBf1"===l||"kRfKpBDg946Y99668Tih"===l||"EktERYKT8kyk3JWymwbu"===l||"rzBhqCTd8wwZmD8JCNEk"===l)&&"small-typography"),"data-element-id":l}),!u&&(0,n.jsx)("div",{className:"absolute w-1 h-1 bg-red-500 rounded-full",style:{left:eI?"18px":"38px",top:eI?"calc(100% - 30px)":"calc(100% - 48px)"},title:"Indicador de fin de p\xe1gina visible"}),Z&&(0,n.jsxs)("div",{className:"absolute inset-0 bg-white/95 z-20 p-4 text-xs overflow-y-auto",onClick:()=>A(!1),children:[(0,n.jsx)("h3",{className:"font-bold mb-2 text-base",children:"Comandos de Dictado por Voz"}),(0,n.jsx)("p",{children:"WIP"}),(0,n.jsx)("p",{className:"text-center mt-4 text-gray-500",children:"Haz clic en cualquier lugar para cerrar"})]}),(0,n.jsx)("div",{ref:z,contentEditable:!u,spellCheck:"true",suppressContentEditableWarning:!0,onPaste:Q,onFocus:()=>w(l),onInput:q,onBlur:J,className:(0,k.cn)("notepad-content-editable",eI&&"small-format",("oyDN2LIr8z7VyYA5727F"===l||"FdQ656GJ94TePuHpotbY"===l||"Iz0UWQ5gQwXlk1kGBf1"===l||"kRfKpBDg946Y99668Tih"===l||"EktERYKT8kyk3JWymwbu"===l||"rzBhqCTd8wwZmD8JCNEk"===l)&&"small-typography","kRfKpBDg946Y99668Tih"===l&&"infinite-scroll",!eI&&"p-[32px_24px_16px_0px]",eI&&"p-[16px_12px_8px_0px]"),"data-element-id":l}),!u&&(0,n.jsx)("div",{className:"absolute top-2 right-2 z-20",children:(0,n.jsx)(eZ,{status:U,size:"sm"})})]})}),!u&&(0,n.jsx)(et,{className:"p-2 border-t justify-center",onMouseDown:e=>e.stopPropagation(),children:(0,n.jsx)(e1,{currentPage:H,totalPages:(null===(t=y.pages)||void 0===t?void 0:t.length)||1,onPageChange:$,onAddPage:ea})})]}),(0,n.jsx)(eT,{isOpen:F,onOpenChange:B,onConfirm:eD}),(0,n.jsx)(e_,{isOpen:I,onOpenChange:M,totalPages:(null===(a=y.pages)||void 0===a?void 0:a.length)||1,onExport:eb})]})},"notepad-simple":function(e){let{id:t,content:a,onUpdate:r,onEditElement:l,deleteElement:i,isListening:o,liveTranscript:c,finalTranscript:d,interimTranscript:u,isSelected:p}=e,m=(0,s.useRef)(null),h=(0,s.useRef)(null),x=(0,s.useRef)(null),[g,f]=(0,s.useState)(""),v="string"==typeof a?a:tb(a)&&(a.text||a.content)||"",b=tb(a)&&a.title||"Nuevo Notepad",{saveStatus:j,handleBlur:w,handleChange:y}=eP({getContent:()=>{var e;return(null===(e=m.current)||void 0===e?void 0:e.value)||""},onSave:async e=>{e!==v&&r(t,{content:{...tb(a)?a:{},text:e,content:e}})},debounceMs:2e3,compareContent:(e,t)=>e===t}),{saveStatus:N,handleBlur:C,handleChange:z}=eP({getContent:()=>{var e;return(null===(e=h.current)||void 0===e?void 0:e.value)||b},onSave:async e=>{e!==b&&r(t,{content:{...tb(a)?a:{},title:e}})},debounceMs:1e3,compareContent:(e,t)=>e===t}),D=async()=>{await w()};(0,s.useEffect)(()=>{let e=m.current;if(!e)return;let t=()=>{let{scrollTop:t,scrollHeight:a,clientHeight:n}=e;a-t-n<100&&(e.style.minHeight="".concat(a+500,"px"))};return e.addEventListener("scroll",t),()=>e.removeEventListener("scroll",t)},[]);let S=()=>{if(m.current){let e=(0,eS.WU)(new Date,"dd/MM/yy"),t=m.current.selectionStart||m.current.value.length,a=m.current.value.substring(0,t),n=m.current.value.substring(t);m.current.value=a+e+" "+n,m.current.setSelectionRange(t+e.length+1,t+e.length+1),y(),m.current.focus()}},T=()=>{i&&i(t)};return(0,n.jsxs)("div",{ref:x,className:(0,k.cn)("w-full h-full flex flex-col rounded-lg shadow-lg overflow-hidden drag-handle","cursor-grab active:cursor-grabbing"),style:{backgroundColor:"#ffff00"},onClick:()=>l(t),children:[(0,n.jsxs)("div",{className:"flex items-center justify-between p-3 border-b border-gray-300 bg-white flex-shrink-0",children:[(0,n.jsxs)("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:[(0,n.jsx)("div",{className:"drag-handle cursor-grab active:cursor-grabbing flex-shrink-0",children:(0,n.jsx)("div",{className:"grid grid-cols-3 gap-0.5 w-4 h-4",children:Array.from({length:9}).map((e,t)=>(0,n.jsx)("div",{className:"w-1 h-1 bg-gray-700 rounded-full"},t))})}),(0,n.jsx)("input",{ref:h,type:"text",value:b,onChange:e=>{r(t,{content:{...tb(a)?a:{},title:e.target.value}}),z()},onBlur:C,className:"text-sm font-semibold text-gray-800 bg-transparent border-none outline-none flex-1 min-w-0 px-2",placeholder:"Nuevo Notepad",onClick:e=>e.stopPropagation(),onMouseDown:e=>e.stopPropagation(),style:{fontFamily:"inherit"}}),(0,n.jsx)("div",{className:"flex-shrink-0",children:(0,n.jsx)(eZ,{status:N,size:"sm"})})]}),(0,n.jsx)("div",{className:"flex items-center gap-2 mx-4 flex-shrink-0",children:(0,n.jsxs)("div",{className:"relative",children:[(0,n.jsx)(tv.Z,{className:"absolute left-2 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-500 pointer-events-none"}),(0,n.jsx)("input",{type:"text",value:g,onChange:e=>f(e.target.value),placeholder:"Buscar...",className:"pl-8 pr-2 py-1 text-xs border border-gray-300 rounded bg-white text-gray-700 placeholder-gray-400 outline-none focus:ring-1 focus:ring-blue-500",onClick:e=>e.stopPropagation(),onMouseDown:e=>e.stopPropagation(),style:{width:"120px"}})]})}),(0,n.jsxs)("div",{className:"flex items-center gap-1 flex-shrink-0",children:[(0,n.jsx)(E.z,{variant:"ghost",size:"icon",className:"h-7 w-7 hover:bg-gray-100",onClick:e=>{e.stopPropagation(),S()},title:"Insertar Fecha",children:(0,n.jsx)(eQ.Z,{className:"h-4 w-4 text-gray-700"})}),(0,n.jsx)(E.z,{variant:"ghost",size:"icon",className:"h-7 w-7 hover:bg-red-50 text-red-600 hover:text-red-700",onClick:e=>{e.stopPropagation(),T()},title:"Eliminar",children:(0,n.jsx)(L.Z,{className:"h-4 w-4"})}),(0,n.jsx)(E.z,{variant:"ghost",size:"icon",className:"h-7 w-7 hover:bg-gray-100",onClick:e=>{e.stopPropagation()},title:"Cerrar",children:(0,n.jsx)(ef.Z,{className:"h-4 w-4 text-gray-700"})})]})]}),(0,n.jsx)(e0,{content:tb(a)?a:v,onCategorySelect:e=>{console.log("Categor\xeda seleccionada:",e)}}),(0,n.jsxs)("div",{className:"flex-1 relative overflow-hidden",style:{backgroundColor:"#ffff00"},children:[(0,n.jsx)("div",{className:"absolute inset-0 pointer-events-none z-0",style:{backgroundImage:"linear-gradient(#3b82f6 1px, transparent 1px)",backgroundSize:"100% 24px",backgroundPosition:"0 60px"}}),(0,n.jsx)("div",{className:"absolute top-0 bottom-0 pointer-events-none z-0",style:{left:"50px",width:"1px",backgroundColor:"#fca5a5",top:"60px"}}),(0,n.jsx)("textarea",{ref:m,value:v,onChange:e=>{y()},onBlur:D,className:"absolute inset-0 w-full h-full bg-transparent text-sm resize-none outline-none z-10 font-mono",style:{paddingLeft:"70px",paddingTop:"60px",paddingRight:"16px",paddingBottom:"16px",lineHeight:"24px",fontSize:"14px",color:"#1e293b",fontFamily:"monospace",whiteSpace:"pre-wrap",wordWrap:"break-word",minHeight:"100%"},placeholder:"Escribe aqu\xed...",onClick:e=>e.stopPropagation(),onMouseDown:e=>e.stopPropagation()}),(0,n.jsx)("div",{className:"absolute top-2 right-2 z-20",children:(0,n.jsx)(eZ,{status:j,size:"sm"})})]})]})},"test-notepad":function(e){var t,a,r;let{id:l,content:i,properties:o,onUpdate:c,deleteElement:d,isPreview:u=!1,onFormatToggle:p,isListening:m,liveTranscript:h,isSelected:x,minimized:g,onChangeNotepadFormat:v,onEditElement:b}=e,j=i||{},w=(0,s.useRef)(null),y=(0,s.useRef)(null),{toast:N}=(0,f.pm)(),[z,D]=(0,s.useState)(!1),[S,T]=(0,s.useState)(!1),[P,R]=(0,s.useState)(!1),[I,M]=(0,s.useState)(!1),[Z,A]=(0,s.useState)(!1),F=null!==(r=j.currentPage)&&void 0!==r?r:0,{saveStatus:B,handleBlur:O,handleChange:_,forceSave:H}=eP({getContent:()=>u||!y.current?"":y.current.innerHTML,onSave:async e=>{if(u||!y.current)return;let t=j.pages||[""];if(e!==(t[F]||"")){let a=[...t];a[F]=e,c(l,{content:{...j,pages:a}})}},debounceMs:2e3,disabled:u,compareContent:(e,t)=>e===((j.pages||[""])[F]||"")}),U=(0,s.useCallback)(async()=>{await H()},[H]);(0,s.useEffect)(()=>{if(y.current&&document.activeElement!==y.current){var e,t;let a=null!==(t=null===(e=j.pages)||void 0===e?void 0:e[F])&&void 0!==t?t:"<div><br></div>";y.current.innerHTML!==a&&(y.current.innerHTML=a)}},[j.pages,F]),(0,s.useEffect)(()=>{m&&x&&y.current&&document.activeElement===y.current&&document.execCommand("insertText",!1,h)},[m,h,x]);let J=(0,s.useCallback)(()=>{u||b(l)},[u,b,l]),{handleBlur:q}=eP({getContent:()=>{var e;return(null===(e=w.current)||void 0===e?void 0:e.innerText)||""},onSave:async e=>{!u&&w.current&&j.title!==e&&c(l,{content:{...j,title:e}})},debounceMs:1e3,disabled:u}),K=(0,s.useCallback)(async()=>{!u&&w.current&&await q()},[u,q]),V=(0,s.useCallback)(e=>{e.preventDefault();let t=e.clipboardData.getData("text/plain");t&&document.execCommand("insertText",!1,t)},[]),W=(0,s.useCallback)(e=>{var t;!u&&e>=0&&e<((null===(t=j.pages)||void 0===t?void 0:t.length)||0)&&(U(),c(l,{content:{...j,currentPage:e}}))},[u,j,c,l,U]),G=(0,s.useCallback)(()=>{var e;if(!u&&20>((null===(e=j.pages)||void 0===e?void 0:e.length)||0)){U();let e=[...j.pages||[],"<div><br></div>"];c(l,{content:{...j,pages:e,currentPage:e.length-1}})}},[u,j,c,l,U]),Y=(0,s.useCallback)(e=>{e.stopPropagation(),e.preventDefault(),u||(U(),setTimeout(()=>{let e=!!g,t=(null==o?void 0:o.size)||{width:794,height:1021},a={width:"number"==typeof t.width?t.width:parseFloat(String(t.width))||794,height:"number"==typeof t.height?t.height:parseFloat(String(t.height))||1021};if(e){let{originalSize:e,...t}=o||{};c(l,{minimized:!1,properties:{...t,size:e||{width:794,height:1021}}})}else{let e="number"==typeof t.width?t.width:parseFloat(String(t.width))||794;c(l,{minimized:!0,properties:{...o,size:{width:e,height:48},originalSize:a}})}},100))},[u,g,o,c,l,U]),Q=(0,s.useCallback)(e=>{e.stopPropagation(),e.preventDefault(),u||(U(),c(l,{hidden:!0}))},[u,U,c,l]),$=(0,s.useCallback)(async e=>{if(e.stopPropagation(),e.preventDefault(),!u)try{let e=document.querySelector('[data-element-id="'.concat(l,'"]'));if(!e){N({variant:"destructive",title:"Error",description:"No se pudo encontrar el elemento para exportar."});return}D(!0),N({title:"Exportando...",description:"Generando imagen PNG de alta resoluci\xf3n del cuaderno."}),(await C()(e,{backgroundColor:"#ffffff",scale:3,useCORS:!0,logging:!1,allowTaint:!1,windowWidth:e.scrollWidth,windowHeight:e.scrollHeight})).toBlob(e=>{if(!e){N({variant:"destructive",title:"Error",description:"No se pudo generar la imagen."}),D(!1);return}let t=URL.createObjectURL(e),a=document.createElement("a");a.href=t;let n=j.title||"cuaderno-test";a.download="".concat(n,"_").concat(Date.now(),".png"),document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(t),N({title:"Exportado",description:"El cuaderno se ha exportado como PNG de alta resoluci\xf3n."}),D(!1)},"image/png",1)}catch(e){console.error("Error al exportar cuaderno:",e),N({variant:"destructive",title:"Error",description:e.message||"No se pudo exportar el cuaderno."}),D(!1)}},[N,l,u,j.title]),ea=(0,s.useCallback)(async e=>{if(!u)try{T(!0),N({title:"Exportando...",description:"Generando PDF con ".concat(e.length," p\xe1gina").concat(e.length>1?"s":"",".")});let t=document.querySelector('[data-element-id="'.concat(l,'"]'));if(!t){N({variant:"destructive",title:"Error",description:"No se pudo encontrar el elemento para exportar."}),T(!1);return}let a=new eA.ZP({orientation:"portrait",unit:"px",format:[794,1021]}),n=j.currentPage||0;for(let r=0;r<e.length;r++){let s=e[r];c&&s!==n&&(c(l,{content:{...j,currentPage:s}}),await new Promise(e=>setTimeout(e,100)));let i=await C()(t,{backgroundColor:"#ffffff",scale:2,useCORS:!0,logging:!1,allowTaint:!1,windowWidth:t.scrollWidth,windowHeight:t.scrollHeight}),o=i.toDataURL("image/png");r>0&&a.addPage();let d=a.internal.pageSize.getWidth(),u=a.internal.pageSize.getHeight(),p=i.width,m=i.height,h=Math.min(d/p,u/m),x=p*h,g=m*h,f=(d-x)/2,v=(u-g)/2;a.addImage(o,"PNG",f,v,x,g)}c&&n!==j.currentPage&&c(l,{content:{...j,currentPage:n}});let r=j.title||"cuaderno-test";a.save("".concat(r,"_").concat(Date.now(),".pdf")),N({title:"Exportado",description:"PDF exportado con ".concat(e.length," p\xe1gina").concat(e.length>1?"s":"",".")}),T(!1)}catch(e){console.error("Error al exportar cuaderno a PDF:",e),N({variant:"destructive",title:"Error",description:e.message||"No se pudo exportar el cuaderno a PDF."}),T(!1)}},[N,l,u,j,c]);(0,s.useEffect)(()=>{let e=w.current;e&&e.innerText!==(j.title||"")&&(e.innerText=j.title||"")},[j.title]);let en=(0,s.useCallback)((e,t,a)=>{e.preventDefault(),e.stopPropagation(),y.current&&(y.current.focus(),document.execCommand(t,!1,null!=a?a:void 0))},[]),er=(0,s.useCallback)(e=>en(e,"removeFormat"),[en]),ev=(0,s.useCallback)(e=>en(e,"insertHTML",'<span style="color: #a0a1a6;">-- '.concat((0,eS.WU)(new Date,"dd/MM/yy")," </span>")),[en]),eb=(0,s.useCallback)(e=>{if(e.preventDefault(),e.stopPropagation(),y.current){y.current.focus();let e=document.createRange();e.selectNodeContents(y.current);let t=window.getSelection();t&&(t.removeAllRanges(),t.addRange(e))}},[]),ej=(0,s.useCallback)(()=>{d(l),A(!1)},[d,l]),eN="object"==typeof o&&null!==o?o:{},eC="10x15"===((null==eN?void 0:eN.format)||"letter");return g?(0,n.jsx)(X,{className:"notepad-card w-full h-full flex items-center shadow-lg rounded-lg bg-card border-2 border-primary/50 group","data-element-id":l,children:(0,n.jsxs)("div",{className:"p-2 flex flex-row items-center gap-1 w-full cursor-grab active:cursor-grabbing drag-handle",children:[(0,n.jsx)("div",{className:"p-1",children:(0,n.jsx)(es.Z,{className:"size-5 text-muted-foreground"})}),(0,n.jsx)("p",{className:"font-headline text-sm font-semibold truncate flex-grow",children:j.title||"Cuaderno Test"}),(0,n.jsx)(E.z,{variant:"ghost",size:"icon",className:"size-7",title:"Maximizar",onMouseDown:e=>{e.preventDefault(),e.stopPropagation(),Y(e)},children:(0,n.jsx)(el.Z,{className:"size-4"})})]})}):(0,n.jsxs)(X,{"data-element-id":l,className:"notepad-card w-full h-full flex flex-col shadow-lg rounded-lg bg-card group",children:[(0,n.jsxs)("div",{className:"p-2 border-b flex flex-row items-center gap-1 cursor-grab active:cursor-grabbing drag-handle",children:[(0,n.jsx)("div",{className:"p-1",children:(0,n.jsx)(es.Z,{className:"size-5 text-muted-foreground"})}),(0,n.jsx)("div",{ref:w,contentEditable:!u,spellCheck:"true",suppressContentEditableWarning:!0,onFocus:J,onBlur:K,className:"bg-transparent flex-grow outline-none cursor-text font-headline text-sm font-semibold p-1","data-placeholder":"Cuaderno Test",onMouseDown:e=>e.stopPropagation()}),!u&&(0,n.jsxs)("div",{onMouseDown:e=>e.stopPropagation(),className:"flex items-center",children:[(0,n.jsx)(E.z,{variant:"ghost",size:"icon",className:"size-7",title:"Guardar",onClick:U,children:(0,n.jsx)(ei.Z,{className:"size-4"})}),(0,n.jsx)(E.z,{variant:"ghost",size:"icon",className:"size-7",title:"Info",onClick:()=>M(!I),children:(0,n.jsx)(eo.Z,{className:"size-4"})}),(0,n.jsx)(E.z,{variant:"ghost",size:"icon",className:"size-7",title:"Seleccionar Todo",onClick:eb,children:(0,n.jsx)(ec.Z,{className:"size-4"})}),(0,n.jsx)(E.z,{variant:"ghost",size:"icon",className:"size-7",title:"Limpiar Formato",onClick:er,children:(0,n.jsx)(ed.Z,{className:"size-4"})}),p&&(0,n.jsx)(E.z,{variant:"ghost",size:"icon",className:"size-7",title:"Herramientas de Formato",onClick:p,children:(0,n.jsx)(eu.Z,{className:"size-4"})}),(0,n.jsx)(E.z,{variant:"ghost",size:"icon",className:"size-7",title:"Insertar Fecha",onClick:ev,children:(0,n.jsx)(ep.Z,{className:"size-4"})}),(0,n.jsxs)(ew,{modal:!1,children:[(0,n.jsx)(ey,{asChild:!0,children:(0,n.jsx)(E.z,{variant:"ghost",size:"icon",className:"size-7",children:(0,n.jsx)(em.Z,{className:"size-4"})})}),(0,n.jsxs)(eE,{children:[(0,n.jsxs)(ez,{onMouseDown:e=>{e.preventDefault(),e.stopPropagation(),$(e)},disabled:z,children:[(0,n.jsx)(eh.Z,{className:"mr-2 h-4 w-4"}),(0,n.jsx)("span",{children:z?"Exportando...":"Exportar a PNG: alta resoluci\xf3n"})]}),(0,n.jsxs)(ez,{onMouseDown:e=>{e.preventDefault(),e.stopPropagation(),R(!0)},disabled:S,children:[(0,n.jsx)(eh.Z,{className:"mr-2 h-4 w-4"}),(0,n.jsx)("span",{children:S?"Exportando PDF...":"Exportar p\xe1ginas a PDF"})]}),v&&(0,n.jsxs)(ez,{onMouseDown:e=>{e.preventDefault(),e.stopPropagation(),v(l)},children:[(0,n.jsx)(ex.Z,{className:"mr-2 h-4 w-4"}),(0,n.jsx)("span",{children:"Cambiar formato..."})]})]})]}),(0,n.jsx)(E.z,{variant:"ghost",size:"icon",className:"size-7",title:g?"Maximizar":"Minimizar",onMouseDown:e=>{e.preventDefault(),e.stopPropagation(),Y(e)},children:g?(0,n.jsx)(el.Z,{className:"size-4"}):(0,n.jsx)(eg.Z,{className:"size-4"})}),(0,n.jsx)(E.z,{variant:"ghost",size:"icon",className:"size-7 text-destructive hover:text-destructive",title:"Eliminar Cuaderno",onMouseDown:e=>{e.preventDefault(),e.stopPropagation(),A(!0)},children:(0,n.jsx)(L.Z,{className:"size-4"})}),(0,n.jsx)(E.z,{variant:"ghost",size:"icon",className:"size-7",title:"Cerrar",onMouseDown:Q,children:(0,n.jsx)(ef.Z,{className:"size-4"})})]})]}),!g&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(ee,{className:"p-0 flex-grow relative bg-card font-body overflow-y-auto",children:(0,n.jsxs)("div",{className:(0,k.cn)("notepad-content-container",eC&&"small-format"),children:[(0,n.jsx)("div",{className:(0,k.cn)("notepad-lines-background",eC&&"small-format")}),!u&&(0,n.jsx)("div",{className:"absolute w-1 h-1 bg-red-500 rounded-full",style:{left:eC?"18px":"38px",top:eC?"calc(100% - 30px)":"calc(100% - 48px)"},title:"Indicador de fin de p\xe1gina visible"}),I&&(0,n.jsxs)("div",{className:"absolute inset-0 bg-white/95 z-20 p-4 text-xs overflow-y-auto",onClick:()=>M(!1),children:[(0,n.jsx)("h3",{className:"font-bold mb-2 text-base",children:"Comandos de Dictado por Voz"}),(0,n.jsx)("p",{children:"WIP"}),(0,n.jsx)("p",{className:"text-center mt-4 text-gray-500",children:"Haz clic en cualquier lugar para cerrar"})]}),(0,n.jsx)("div",{ref:y,contentEditable:!u,spellCheck:"true",suppressContentEditableWarning:!0,onPaste:V,onFocus:()=>b(l),onInput:_,onBlur:O,className:(0,k.cn)("notepad-content-editable",eC&&"small-format",!eC&&"p-[32px_24px_16px_0px]",eC&&"p-[16px_12px_8px_0px]")}),!u&&(0,n.jsx)("div",{className:"absolute top-2 right-2 z-20",children:(0,n.jsx)(eZ,{status:B,size:"sm"})})]})}),!u&&(0,n.jsx)(et,{className:"p-2 border-t justify-center",onMouseDown:e=>e.stopPropagation(),children:(0,n.jsx)(tS,{currentPage:F,totalPages:(null===(t=j.pages)||void 0===t?void 0:t.length)||1,onPageChange:W,onAddPage:G})})]}),(0,n.jsx)(eT,{isOpen:Z,onOpenChange:A,onConfirm:ej}),(0,n.jsx)(e_,{isOpen:P,onOpenChange:R,totalPages:(null===(a=j.pages)||void 0===a?void 0:a.length)||1,onExport:ea})]})},sticky:function(e){let{id:t,content:r,properties:l,isSelected:i,onUpdate:o,onEditElement:c,deleteElement:d,isListening:u,liveTranscript:p,finalTranscript:m,interimTranscript:h}=e,x="object"==typeof l&&null!==l?l:{},g=("string"==typeof x.color?x.color:"yellow")||"yellow",f=te[g]||(g.startsWith("#")?g:"#fffb8b"),v=x.rotation||0,b=(0,s.useRef)(null),j="string"==typeof r?r:"",{saveStatus:w,handleBlur:y,handleChange:N}=eP({getContent:()=>{var e;return((null===(e=b.current)||void 0===e?void 0:e.innerHTML)||"").replace(/\s+/g," ").replace(/>\s+</g,"><").trim()},onSave:async e=>{e!==(j||"").replace(/\s+/g," ").replace(/>\s+</g,"><").trim()&&await o(t,{content:e})},debounceMs:2e3,compareContent:(e,t)=>(e||"").replace(/\s+/g," ").replace(/>\s+</g,"><").trim()===(t||"").replace(/\s+/g," ").replace(/>\s+</g,"><").trim()}),C=(0,s.useRef)("");(0,s.useEffect)(()=>{if(b.current){let e=document.activeElement===b.current;if(C.current!==j&&(C.current=j,!e)){let{updateInnerHTMLPreservingCursor:e}=a(5690),t=/<[^>]+>/.test(j);e(b.current,t?j:j||"")}}},[j]);let z=async()=>{await y()};return(0,n.jsxs)(X,{className:(0,k.cn)("w-full h-full flex flex-col relative group overflow-hidden","min-w-[200px] min-h-[150px] max-w-[400px] max-h-[500px]","rounded-lg shadow-md border-none"),style:{backgroundColor:f},onClick:()=>c(t),children:[(0,n.jsxs)("div",{className:"absolute top-2 right-2 flex items-center gap-1 opacity-0 group-hover:opacity-100 transition-opacity z-10",children:[(0,n.jsx)("div",{className:"drag-handle cursor-grab active:cursor-grabbing p-1 hover:bg-black/10 rounded",children:(0,n.jsx)(es.Z,{className:"h-4 w-4 text-gray-700"})}),(0,n.jsx)(E.z,{variant:"ghost",size:"icon",className:"h-6 w-6 p-1 hover:bg-black/10 rounded",onClick:e=>{if(e.stopPropagation(),b.current){b.current.focus();let e=window.getSelection();if(e&&e.rangeCount>0){let t=e.getRangeAt(0);t.collapse(!1);let a=document.createElement("br");t.insertNode(a),t.setStartAfter(a),t.collapse(!0),e.removeAllRanges(),e.addRange(t)}}},onMouseDown:e=>e.stopPropagation(),children:(0,n.jsx)(er.Z,{className:"h-4 w-4 text-gray-700"})}),i&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(e4,{children:[(0,n.jsx)(e5,{asChild:!0,children:(0,n.jsx)(E.z,{variant:"ghost",size:"icon",className:"h-6 w-6 p-1 hover:bg-black/10 rounded",onClick:e=>e.stopPropagation(),children:(0,n.jsx)(e6.Z,{className:"h-4 w-4 text-gray-700"})})}),(0,n.jsx)(e3,{onClick:e=>e.stopPropagation(),className:"w-auto p-0 border-none",children:(0,n.jsx)(e8.e8,{colors:e9,color:f,onChangeComplete:e=>{o(t,{properties:{...x,color:e.hex}})}})})]}),(0,n.jsx)(E.z,{variant:"ghost",size:"icon",className:"h-6 w-6 p-1 hover:bg-black/10 rounded",onClick:e=>{e.stopPropagation(),o(t,{properties:{...x,rotation:((v||0)+15)%360}})},onMouseDown:e=>e.stopPropagation(),title:"Rotar 15\xb0",children:(0,n.jsx)(e7.Z,{className:"h-4 w-4 text-gray-700"})})]}),(0,n.jsx)(E.z,{variant:"ghost",size:"icon",className:"h-6 w-6 p-1 hover:bg-black/10 rounded",onClick:e=>{e.stopPropagation(),e.preventDefault(),d&&d(t)},onMouseDown:e=>e.stopPropagation(),children:(0,n.jsx)(ef.Z,{className:"h-4 w-4 text-gray-700"})})]}),(0,n.jsxs)("div",{className:"relative flex-grow",children:[(0,n.jsx)("div",{ref:b,contentEditable:!0,suppressContentEditableWarning:!0,onInput:()=>{N()},onBlur:z,className:"text-base font-medium break-words outline-none cursor-text p-4 pt-6",style:{color:"#333",minHeight:"calc(100% - 1rem)"}}),(0,n.jsx)("div",{className:"absolute top-2 right-2 z-10",children:(0,n.jsx)(eZ,{status:w,size:"sm"})})]})]})},todo:function(e){let{id:t,content:a,properties:r,onUpdate:l,onEditElement:i,isSelected:o,deleteElement:c,onLocateElement:d,onEditComment:u,isListening:p,liveTranscript:m,finalTranscript:h,interimTranscript:x}=e,{toast:g}=(0,f.pm)(),v=(0,s.useRef)(null),[b,j]=(0,s.useState)(""),[w,y]=(0,s.useState)(!1),N="object"==typeof r&&null!==r?r:{},z=N.backgroundColor||"#ffffff",D="object"==typeof a&&null!==a&&"items"in a?a:{title:"Lista de Tareas",items:[]},{title:S,items:T}=D,{saveStatus:P,handleChange:R}=eP({getContent:()=>D,onSave:async e=>{JSON.stringify(D)!==JSON.stringify(e)&&l(t,{content:e})},debounceMs:2e3,compareContent:(e,t)=>JSON.stringify(e)===JSON.stringify(t)}),I=e=>{let a=[...T];a[e]={...a[e],completed:!a[e].completed},l(t,{content:{...D,items:a}}),R()},M=(e,a)=>{let n=[...T];n[e]={...n[e],text:a},l(t,{content:{...D,items:n}}),R()},Z=()=>{if(""!==b.trim()){let e=[...T,{id:"item-".concat(Date.now()),text:b,completed:!1}];l(t,{content:{...D,items:e}}),j(""),R()}},A=e=>{let a=T.filter((t,a)=>a!==e);l(t,{content:{...D,items:a}}),R()},F=e=>{l(t,{properties:{...N,backgroundColor:e}}),y(!1)},B=async()=>{try{let e="*".concat(S||"Lista de Tareas","*\n\n");T.forEach(t=>{t.completed?e+="✅ ".concat(t.text,"\n"):e+="⬜ ".concat(t.text,"\n")}),await navigator.clipboard.writeText(e),g({title:"Lista copiada",description:"La lista se ha copiado al portapapeles."})}catch(e){console.error("Error al copiar:",e),g({variant:"destructive",title:"Error",description:"No se pudo copiar la lista."})}},O=async()=>{try{if(!v.current){g({variant:"destructive",title:"Error",description:"No se pudo capturar el elemento."});return}g({title:"Exportando...",description:"Generando imagen PNG de la lista."}),(await C()(v.current,{scale:2.1,backgroundColor:z,useCORS:!0,logging:!1,allowTaint:!1})).toBlob(e=>{if(!e){g({variant:"destructive",title:"Error",description:"No se pudo generar la imagen."});return}let t=URL.createObjectURL(e),a=document.createElement("a");a.href=t,a.download="".concat(S||"lista",".png"),document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(t),g({title:"Exportado",description:"La lista se ha exportado como PNG."})},"image/png")}catch(e){console.error("Error al exportar:",e),g({variant:"destructive",title:"Error",description:e.message||"No se pudo exportar la lista."})}};return(0,n.jsxs)(X,{ref:v,className:(0,k.cn)("w-full h-full flex flex-col relative group overflow-hidden","min-w-[200px] min-h-[150px]","rounded-lg shadow-md border-none"),style:{backgroundColor:"#ffffff"},onClick:()=>i(t),children:[(0,n.jsx)("div",{className:"absolute top-2 right-2 z-10",children:(0,n.jsx)(eZ,{status:P,size:"sm"})}),(0,n.jsx)($,{className:"p-2 pb-2 border-b border-gray-200/50",style:{backgroundColor:z},children:(0,n.jsxs)("div",{className:"flex items-center justify-between gap-1",children:[(0,n.jsxs)("div",{className:"flex items-center gap-1 flex-1 min-w-0",children:[(0,n.jsx)("div",{className:"drag-handle cursor-grab active:cursor-grabbing flex-shrink-0",children:(0,n.jsx)(es.Z,{className:"h-3 w-3 text-gray-400"})}),(0,n.jsx)(tt.I,{type:"text",value:S||"",onChange:e=>{l(t,{content:{...D,title:e.target.value}}),R()},className:"text-sm font-semibold border-none shadow-none focus-visible:ring-0 p-1 bg-transparent flex-1 min-w-0",placeholder:"T\xedtulo...",onClick:e=>e.stopPropagation(),onMouseDown:e=>e.stopPropagation()})]}),(0,n.jsxs)("div",{className:"flex items-center gap-0.5 flex-shrink-0",children:[(0,n.jsxs)(e4,{open:w,onOpenChange:y,children:[(0,n.jsx)(e5,{asChild:!0,children:(0,n.jsx)(E.z,{variant:"ghost",size:"icon",className:"h-6 w-6",onClick:e=>{e.stopPropagation(),y(!0)},title:"Cambiar color del header",children:(0,n.jsx)(ta.Z,{className:"h-3 w-3"})})}),(0,n.jsx)(e3,{className:"w-auto p-2",onClick:e=>e.stopPropagation(),onMouseDown:e=>e.stopPropagation(),children:(0,n.jsx)("div",{className:"grid grid-cols-4 gap-1.5",children:tl.map(e=>(0,n.jsx)("button",{className:(0,k.cn)("w-6 h-6 rounded-full border-2 transition-all hover:scale-110",z===e.value?"border-gray-800 scale-110":"border-gray-300"),style:{backgroundColor:e.value},onClick:t=>{t.stopPropagation(),F(e.value)},title:"".concat(e.label," - Aplicar al header")},e.name))})})]}),(0,n.jsxs)(ew,{children:[(0,n.jsx)(ey,{asChild:!0,children:(0,n.jsx)(E.z,{variant:"ghost",size:"icon",className:"h-6 w-6",onClick:e=>e.stopPropagation(),title:"M\xe1s opciones - Copiar, exportar o eliminar lista",children:(0,n.jsx)(em.Z,{className:"h-3 w-3"})})}),(0,n.jsxs)(eE,{align:"end",onClick:e=>e.stopPropagation(),className:"text-sm",children:[(0,n.jsxs)(ez,{onClick:B,className:"text-sm",title:"Copia la lista completa al portapapeles en formato texto",children:[(0,n.jsx)(tn.Z,{className:"mr-2 h-3 w-3"}),(0,n.jsx)("span",{children:"Copiar lista como texto"})]}),(0,n.jsxs)(ez,{onClick:O,className:"text-sm",title:"Exporta la lista como imagen PNG de alta resoluci\xf3n (reducida 30%)",children:[(0,n.jsx)(tr.Z,{className:"mr-2 h-3 w-3"}),(0,n.jsx)("span",{children:"Exportar a PNG: alta resoluci\xf3n"})]}),(0,n.jsx)(eD,{}),(0,n.jsxs)(ez,{onClick:()=>{c&&c(t)},className:"text-sm text-destructive focus:text-destructive",children:[(0,n.jsx)(L.Z,{className:"mr-2 h-3 w-3"}),(0,n.jsx)("span",{children:"Eliminar Lista"})]})]})]})]})]})}),(0,n.jsx)(ee,{className:"flex-grow overflow-y-auto p-2",children:(0,n.jsx)(ts.Z5,{onDragEnd:e=>{if(!e.destination)return;let a=Array.from(T),[n]=a.splice(e.source.index,1);a.splice(e.destination.index,0,n),l(t,{content:{...D,items:a}}),R()},children:(0,n.jsx)(ts.bK,{droppableId:"droppable-".concat(t),children:e=>(0,n.jsxs)("div",{...e.droppableProps,ref:e.innerRef,className:"space-y-0.5",children:[0===T.length?(0,n.jsx)("p",{className:"text-xs text-gray-400 italic py-2 text-center",children:"No hay tareas. Agrega una nueva..."}):T.map((e,t)=>(0,n.jsx)(ts._l,{draggableId:e.id,index:t,children:(a,r)=>(0,n.jsxs)("div",{ref:a.innerRef,...a.draggableProps,className:(0,k.cn)("flex items-center gap-1 p-1 rounded transition-colors group/item",r.isDragging?"bg-gray-100 shadow-md":"hover:bg-gray-50/50",o&&"hover:bg-gray-50"),children:[(0,n.jsx)("div",{...a.dragHandleProps,className:"cursor-grab active:cursor-grabbing p-0.5 opacity-50 hover:opacity-100 flex-shrink-0",children:(0,n.jsx)(es.Z,{className:"h-3 w-3 text-gray-400"})}),(0,n.jsx)(eB,{checked:e.completed,onCheckedChange:()=>I(t),className:"flex-shrink-0 h-3 w-3",onClick:e=>e.stopPropagation()}),(0,n.jsx)("input",{type:"text",value:e.text,onChange:e=>M(t,e.target.value),className:(0,k.cn)("flex-grow text-sm border-none shadow-none focus:outline-none focus:ring-0 p-1 bg-transparent",e.completed?"line-through text-gray-500":"text-gray-900"),placeholder:"Tarea...",onClick:e=>e.stopPropagation()}),o&&(0,n.jsx)(E.z,{variant:"ghost",size:"icon",onClick:e=>{e.stopPropagation(),A(t)},className:"h-5 w-5 opacity-0 group-hover/item:opacity-100 hover:opacity-100 transition-opacity flex-shrink-0",children:(0,n.jsx)(ef.Z,{className:"h-2.5 w-2.5 text-gray-400"})})]})},e.id)),e.placeholder]})})})}),(0,n.jsx)(et,{className:"p-2 pt-1.5 border-t border-gray-200/50",children:(0,n.jsxs)("div",{className:"flex items-center gap-1 w-full",children:[(0,n.jsx)("input",{type:"text",value:b,onChange:e=>j(e.target.value),onKeyDown:e=>{"Enter"===e.key&&(e.preventDefault(),Z())},placeholder:"Agregar tarea...",className:"flex-grow text-sm border-none shadow-none focus:outline-none focus:ring-0 p-1 bg-transparent",onClick:e=>e.stopPropagation()}),(0,n.jsx)(E.z,{onClick:e=>{e.stopPropagation(),Z()},size:"sm",className:"flex-shrink-0 h-6 w-6 p-0",children:(0,n.jsx)(er.Z,{className:"h-3 w-3"})})]})})]})},image:function(e){let{isSelected:t,properties:a,id:r,onUpdate:l,onEditElement:i,onSelectElement:o,content:c,isListening:d,liveTranscript:u}=e,p=("object"==typeof c&&null!==c&&"url"in c&&"string"==typeof c.url?c:{url:""}).url,m="object"==typeof a&&null!==a?a:{},h=(null==m?void 0:m.rotation)||0,x=(null==m?void 0:m.showFloatingTag)||!1,g=(null==m?void 0:m.floatingTag)||"",f=(null==m?void 0:m.label)||"",v=(0,s.useRef)(null),[b,j]=(0,s.useState)(!1);(0,s.useEffect)(()=>{v.current&&v.current.innerText!==f&&(v.current.innerText=f||"")},[f]),(0,s.useEffect)(()=>{if(b&&v.current){v.current.focus();let e=document.createRange(),t=window.getSelection();e.selectNodeContents(v.current),e.collapse(!1),null==t||t.removeAllRanges(),null==t||t.addRange(e)}},[b]);let{saveStatus:w,handleBlur:y,handleChange:N}=eP({getContent:()=>{var e;return(null===(e=v.current)||void 0===e?void 0:e.innerText)||f},onSave:async e=>{e!==f&&v.current&&l(r,{properties:{...m,label:e}})},debounceMs:2e3,compareContent:(e,t)=>e===t});return(0,s.useEffect)(()=>{d&&t&&b&&v.current&&document.activeElement===v.current&&(document.execCommand("insertText",!1,u||""),N())},[d,u,t,b,N]),(0,n.jsxs)("div",{className:"group/image flex flex-col w-full h-full",onDoubleClick:e=>{e.stopPropagation(),t&&(i(r),j(!0))},onMouseDown:e=>o(r,e.shiftKey||e.ctrlKey||e.metaKey),children:[(0,n.jsxs)("div",{className:"relative w-full flex-grow flex flex-col",children:[(t||x||g)&&(0,n.jsx)(td,{tag:g||"",isEditing:!!x,onSave:e=>{l(r,{properties:{...m,floatingTag:e,showFloatingTag:!1}})},onCancel:()=>{l(r,{properties:{...m,showFloatingTag:!1}})}}),(0,n.jsx)("div",{onMouseDown:e=>e.stopPropagation(),className:(0,k.cn)("absolute top-1 left-1 z-20 opacity-0 group-hover/image:opacity-100 transition-opacity",t&&"opacity-100"),children:(0,n.jsx)(E.z,{variant:"ghost",size:"icon",className:"h-7 w-7",onClick:e=>{e.stopPropagation(),i(r),l(r,{properties:{...m,showFloatingTag:!x}})},children:(0,n.jsx)(to.Z,{className:"h-4 w-4"})})}),(0,n.jsx)("div",{onMouseDown:e=>e.stopPropagation(),className:"absolute bottom-1 left-1 z-20 opacity-0 group-hover/image:opacity-100 transition-opacity",children:(0,n.jsx)(E.z,{variant:"default",size:"icon",className:"h-6 w-6 rounded-full shadow-lg",onClick:e=>{e.stopPropagation(),window.open(p,"_blank","noopener,noreferrer")},title:"Abrir imagen original",children:(0,n.jsx)(tc.Z,{className:"h-3 w-3"})})}),(0,n.jsx)("div",{className:(0,k.cn)("relative flex-grow rounded-lg overflow-hidden drag-handle","cursor-grab active:cursor-grabbing"),style:{transform:"rotate(".concat(h||0,"deg)")},children:(0,n.jsx)("div",{className:"relative w-full h-full bg-card",children:(0,n.jsx)(ti.default,{src:"".concat(p),alt:f||"Canvas Image",fill:!0,className:"object-cover pointer-events-none"})})})]}),(b||f&&""!==f.trim())&&(0,n.jsx)("div",{className:"w-full pt-2 flex justify-center items-center",onMouseDown:e=>e.stopPropagation(),children:(0,n.jsxs)("div",{className:"relative inline-flex items-center gap-2",children:[(0,n.jsx)("div",{ref:v,contentEditable:b,suppressContentEditableWarning:!0,onBlur:()=>{y(),j(!1)},onInput:N,onKeyDown:e=>{"Enter"===e.key&&(e.preventDefault(),e.target.blur())},className:(0,k.cn)("text-white text-xs rounded-md px-3 py-1 whitespace-nowrap outline-none max-w-full",b?"ring-1 ring-primary cursor-text":"cursor-pointer"),style:{backgroundColor:"#2eb1ca"}}),b&&(0,n.jsx)("div",{className:"flex-shrink-0",children:(0,n.jsx)(eZ,{status:w,size:"sm"})})]})})]})},text:function(e){let{id:t,content:r,properties:l,onUpdate:i,onEditElement:o,isSelected:c,isListening:d,liveTranscript:u,finalTranscript:p,interimTranscript:m}=e,h=(0,s.useRef)(null),[x,g]=(0,s.useState)(!1),f="object"==typeof l&&null!==l?l:{},{fontSize:v,fontWeight:b,textAlign:j,fontStyle:w}=f,y="string"==typeof r?r:"",{saveStatus:N,handleBlur:C,handleChange:E}=eP({getContent:()=>{var e;return((null===(e=h.current)||void 0===e?void 0:e.innerHTML)||"").replace(/\s+/g," ").replace(/>\s+</g,"><").trim()},onSave:async e=>{var a;let n=((null===(a=h.current)||void 0===a?void 0:a.innerHTML)||"").replace(/\s+/g," ").replace(/>\s+</g,"><").trim(),r=(e||"").replace(/\s+/g," ").replace(/>\s+</g,"><").trim();r!==n&&await i(t,{content:r})},debounceMs:2e3,compareContent:(e,t)=>(e||"").replace(/\s+/g," ").replace(/>\s+</g,"><").trim()===(t||"").replace(/\s+/g," ").replace(/>\s+</g,"><").trim()}),z=(0,s.useRef)("");(0,s.useEffect)(()=>{if(h.current){let e=document.activeElement===h.current,t=h.current.innerHTML||"";if(z.current!==y&&(z.current=y,!e)){let e=/<[^>]+>/.test(y);if(e&&t!==y){let{updateInnerHTMLPreservingCursor:e}=a(5690);e(h.current,y)}else if(!e&&t!==y&&!(t.includes("<span")||t.includes("<div"))){let{updateInnerHTMLPreservingCursor:e}=a(5690);e(h.current,y||"")}}}},[y]);let D=async()=>{g(!1),await C()};return(0,n.jsxs)("div",{className:"relative w-full h-full",children:[(0,n.jsx)(tp(),{innerRef:h,html:y||"",disabled:!x,onChange:e=>{E()},onBlur:D,onDoubleClick:()=>{g(!0),o(t)},className:(0,k.cn)("w-full h-full outline-none break-words",x||c?"cursor-text":"cursor-grab drag-handle active:cursor-grabbing"),style:{fontSize:"".concat(v||24,"px"),fontWeight:b||"normal",textAlign:j||"left",fontStyle:w||"normal",color:f.color||"#000000",backgroundColor:f.backgroundColor||"#ffffff"}}),x&&(0,n.jsx)("div",{className:"absolute top-2 right-2 z-10",children:(0,n.jsx)(eZ,{status:N,size:"sm"})})]})},container:function(e){let{id:t,properties:a,isSelected:r,onSelectElement:l,onEditElement:i,content:o,onUpdate:c,deleteElement:d,allElements:u=[],onLocateElement:p,unanchorElement:m}=e,h="object"==typeof a&&null!==a?a:{},x="object"==typeof o&&null!==o&&"elementIds"in o?o:{title:"Nuevo Contenedor",elementIds:[],layout:"single"},g=(null==h?void 0:h.backgroundColor)||"#ffffff",f=x.layout||"single",[v,b]=(0,s.useState)(!1),j=(0,s.useRef)(null),w=(0,s.useRef)(null),y=x.elementIds.map(e=>{let t=u.find(t=>t.id===e);return t?{elementId:e,element:t}:null}).filter(e=>null!==e),{saveStatus:N,handleBlur:C,handleChange:z}=eP({getContent:()=>{var e;return(null===(e=j.current)||void 0===e?void 0:e.value)||x.title||""},onSave:async e=>{e!==x.title&&c(t,{content:{...x,title:e}})},debounceMs:1e3}),D=(0,s.useCallback)(e=>{c(t,{properties:{...h,backgroundColor:e.hex}}),b(!1)},[t,h,c]),S=(0,s.useCallback)(()=>{c(t,{content:{...x,layout:"single"===f?"two-columns":"single"}})},[t,x,f,c]),T=(0,s.useCallback)(()=>{c(t,{hidden:!0})},[t,c]),P=(0,s.useCallback)(e=>{let a=x.elementIds.filter(t=>t!==e);c(t,{content:{...x,elementIds:a}});let n=u.find(e=>e.id===t);if(n&&m){let t="object"==typeof n.properties&&null!==n.properties?n.properties:{},a=t.position||{x:0,y:0},r=t.size||{width:378,height:567},s=u.find(t=>t.id===e);if(s){let t={x:a.x+("number"==typeof r.width?r.width:parseInt(String(r.width)))+20,y:a.y};c(e,{parentId:void 0,hidden:!1,properties:{..."object"==typeof s.properties&&null!==s.properties?s.properties:{},position:t}})}}},[t,x,u,c,m]),R=e=>{if("text"===e.type)return"string"==typeof e.content?e.content.substring(0,30):"Texto";if("sticky"===e.type)return"string"==typeof e.content?e.content.substring(0,30):"Nota";if("notepad"===e.type||"notepad-simple"===e.type){let t=e.content;return(null==t?void 0:t.title)||"Cuaderno"}if("todo"===e.type){let t=e.content;return(null==t?void 0:t.title)||"Lista de Tareas"}return"image"===e.type?"Imagen":e.type.charAt(0).toUpperCase()+e.type.slice(1)},I=e=>{let t="object"==typeof e.properties&&null!==e.properties&&e.properties.size?e.properties.size:{width:e.width||100,height:e.height||100},a=("number"==typeof t.width?t.width:parseInt(String(t.width)))/("number"==typeof t.height?t.height:parseInt(String(t.height))),r=100,s=100;if(a>1?s=100/a:r=100*a,"image"===e.type){let t=e.content;return(0,n.jsx)("div",{className:"relative w-full h-full rounded overflow-hidden bg-gray-100",children:(0,n.jsx)("img",{src:(null==t?void 0:t.url)||"",alt:"Preview",className:"w-full h-full object-cover",style:{width:r,height:s},onError:e=>{e.target.style.display="none"}})})}if("sticky"===e.type){var l;let t=(null===(l=e.properties)||void 0===l?void 0:l.color)||e.color||"yellow",a={yellow:"#fffb8b",pink:"#ffc2d4",blue:"#bce8f1",green:"#d4edda",orange:"#ffeeba",purple:"#e9d5ff"}[t]||(t.startsWith("#")?t:"#fffb8b"),r="string"==typeof e.content?e.content.substring(0,50):"Nota";return(0,n.jsx)("div",{className:"w-full h-full rounded p-2 text-xs overflow-hidden flex items-center justify-center",style:{backgroundColor:a,minHeight:s},children:(0,n.jsx)("p",{className:"line-clamp-3 text-center",children:r})})}if("text"===e.type){let t="string"==typeof e.content?e.content.substring(0,100):"Texto";return(0,n.jsx)("div",{className:"w-full h-full rounded p-2 bg-white border border-gray-200 flex items-center justify-center text-xs text-gray-600",children:(0,n.jsx)("p",{className:"line-clamp-4 text-center",children:t})})}if("notepad"===e.type||"notepad-simple"===e.type||"super-notebook"===e.type){let t=e.content,a=(null==t?void 0:t.title)||"Cuaderno",r=(null==t?void 0:t.content)||(null==t?void 0:t.text)||"";return(0,n.jsxs)("div",{className:"w-full h-full rounded p-2 bg-white border border-gray-200 flex flex-col",children:[(0,n.jsx)("div",{className:"font-semibold text-xs mb-1 truncate",children:a}),(0,n.jsx)("div",{className:"text-xs text-gray-500 line-clamp-2",children:r.substring(0,60)})]})}if("todo"===e.type){let t=e.content,a=(null==t?void 0:t.items)||[],r=a.filter(e=>e.completed).length;return(0,n.jsxs)("div",{className:"w-full h-full rounded p-2 bg-white border border-gray-200 flex flex-col",children:[(0,n.jsx)("div",{className:"font-semibold text-xs mb-1",children:(null==t?void 0:t.title)||"Lista"}),(0,n.jsxs)("div",{className:"text-xs text-gray-500",children:[r,"/",a.length," completadas"]})]})}return(0,n.jsxs)("div",{className:"bg-gradient-to-br from-gray-100 to-gray-200 rounded flex flex-col items-center justify-center text-xs text-gray-500 p-2",style:{minHeight:s},children:[(0,n.jsx)("div",{className:"text-lg mb-1",children:e.type.charAt(0).toUpperCase()}),(0,n.jsx)("div",{className:"text-center capitalize",children:e.type})]})};return(0,n.jsxs)(X,{id:t,"data-element-type":"container","data-element-id":t,ref:w,className:(0,k.cn)("w-full h-full flex flex-col overflow-hidden","min-w-[200px] min-h-[300px]","rounded-lg shadow-lg border border-gray-200/50",r?"ring-2 ring-blue-500 ring-offset-2":"","hover:shadow-xl transition-shadow"),style:{backgroundColor:"transparent"===g?"#ffffff":g,pointerEvents:"auto"},onClick:e=>{if(!e.target.closest(".drag-handle")){if("K85hC8M5spfsgRITnEQR"===t){let e=(null==h?void 0:h.zIndex)||-1;c(t,{properties:{...h,zIndex:9999}}),i(t),setTimeout(()=>{c(t,{properties:{...h,zIndex:e}})},1e3)}else i(t)}},onMouseDown:e=>{if(!e.target.closest(".drag-handle")){if(e.stopPropagation(),"K85hC8M5spfsgRITnEQR"===t){let a=(null==h?void 0:h.zIndex)||-1;c(t,{properties:{...h,zIndex:9999}}),l(t,e.shiftKey||e.ctrlKey||e.metaKey),setTimeout(()=>{r||c(t,{properties:{...h,zIndex:a}})},2e3)}else l(t,e.shiftKey||e.ctrlKey||e.metaKey)}},onDrop:e=>{e.preventDefault(),e.stopPropagation()},onDragOver:e=>{e.preventDefault(),e.stopPropagation(),e.currentTarget&&(e.currentTarget.style.opacity="0.9")},onDragLeave:e=>{e.preventDefault(),e.stopPropagation(),e.currentTarget&&(e.currentTarget.style.opacity="1")},children:[(0,n.jsxs)($,{className:"p-3 border-b border-gray-200 bg-white flex flex-row items-center justify-between group/header",children:[(0,n.jsxs)("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:[(0,n.jsx)("div",{className:"drag-handle cursor-grab active:cursor-grabbing flex-shrink-0",children:(0,n.jsx)(es.Z,{className:"h-4 w-4 text-gray-400"})}),(0,n.jsx)("input",{ref:j,type:"text",value:x.title||"",onChange:e=>{z(),c(t,{content:{...x,title:e.target.value}})},onBlur:C,className:"flex-1 min-w-0 text-sm font-semibold bg-transparent border-none outline-none focus:outline-none focus:ring-0 p-1",placeholder:"T\xedtulo del contenedor...",onClick:e=>e.stopPropagation(),onMouseDown:e=>e.stopPropagation()})]}),(0,n.jsxs)("div",{className:"flex items-center gap-1 flex-shrink-0",children:[(0,n.jsx)(eZ,{status:N,size:"sm"}),(0,n.jsx)(E.z,{variant:"ghost",size:"icon",className:"h-7 w-7",title:"single"===f?"Dividir en dos columnas":"Una sola columna",onClick:e=>{e.stopPropagation(),S()},children:(0,n.jsx)(tm.Z,{className:(0,k.cn)("h-4 w-4","two-columns"===f&&"text-blue-600")})}),(0,n.jsxs)(e4,{open:v,onOpenChange:b,children:[(0,n.jsx)(e5,{asChild:!0,children:(0,n.jsx)(E.z,{variant:"ghost",size:"icon",className:"h-7 w-7",title:"Cambiar color de fondo",onClick:e=>e.stopPropagation(),children:(0,n.jsx)(ta.Z,{className:"h-4 w-4"})})}),(0,n.jsx)(e3,{className:"w-auto p-0",onClick:e=>e.stopPropagation(),children:(0,n.jsx)(e8.e8,{colors:tx.map(e=>e.value),color:g,onChange:D,triangle:"hide"})})]}),(0,n.jsx)(E.z,{variant:"ghost",size:"icon",className:"h-7 w-7 text-gray-400 hover:text-gray-600",title:"Cerrar contenedor",onClick:e=>{e.stopPropagation(),T()},children:(0,n.jsx)(ef.Z,{className:"h-4 w-4"})})]})]}),(0,n.jsx)(ee,{className:"flex-1 p-3 overflow-y-auto",style:{minHeight:0},onDrop:e=>{e.preventDefault(),e.stopPropagation(),console.log("\uD83D\uDCE6 Drop en CardContent del contenedor")},onDragOver:e=>{e.preventDefault(),e.stopPropagation(),e.dataTransfer.dropEffect="move"},children:0===y.length?(0,n.jsx)("div",{className:"flex items-center justify-center h-full text-sm text-gray-400",children:"Arrastra elementos aqu\xed para guardarlos"}):(0,n.jsx)("div",{className:(0,k.cn)("grid gap-3","two-columns"===f?"grid-cols-2":"grid-cols-1"),children:y.map(e=>{let{elementId:t,element:a}=e;return(0,n.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-3 flex flex-col gap-2 group/card hover:shadow-md transition-shadow",children:[(0,n.jsx)("div",{className:"flex items-center justify-center bg-gray-50 rounded p-2 min-h-[80px]",children:I(a)}),(0,n.jsx)("div",{className:"text-xs font-medium text-gray-700 truncate",children:R(a)}),(0,n.jsx)(E.z,{variant:"ghost",size:"icon",className:"h-6 w-6 self-end opacity-0 group-hover/card:opacity-100 transition-opacity",title:"Soltar elemento del contenedor",onClick:e=>{e.stopPropagation(),P(t)},children:(0,n.jsx)(th.Z,{className:"h-3 w-3"})})]},t)})})})]})},comment:function(e){let{content:t,properties:a,onEditComment:r,onUpdate:l,onLocateElement:i,id:o,type:c,x:d,y:u,width:p,height:m,rotation:h,zIndex:x,color:g,backgroundColor:f,hidden:v,parentId:b,isSelected:j,onSelectElement:w,isListening:y,liveTranscript:N,finalTranscript:C,interimTranscript:z}=e,[D,S]=(0,s.useState)(!1),T=(0,s.useRef)(null),P="object"==typeof t&&null!==t?t:"string"==typeof t?{text:t}:{};P.text||P.title||P.label;let R=P.label||P.title||"Localizador",{saveStatus:I,handleBlur:M,handleChange:Z}=eP({getContent:()=>{var e;return(null===(e=T.current)||void 0===e?void 0:e.value)||R},onSave:async e=>{e!==R&&l(o,{content:{...P,label:e,title:e}})},debounceMs:1e3}),A=()=>{T.current&&M(),S(!1)};return(0,n.jsxs)("div",{onClick:e=>{e.stopPropagation(),D||(j&&i?i(o):w(o,!1))},onDoubleClick:e=>{e.stopPropagation(),S(!0),setTimeout(()=>{var e,t;null===(e=T.current)||void 0===e||e.focus(),null===(t=T.current)||void 0===t||t.select()},0)},className:(0,k.cn)("w-full h-full cursor-move relative group","flex flex-col items-center justify-center gap-1",j&&"ring-2 ring-blue-500 ring-offset-2 rounded-lg"),style:{minWidth:"80px",minHeight:"80px"},children:[(0,n.jsxs)("div",{className:(0,k.cn)("relative flex items-center justify-center","transition-transform hover:scale-110"),children:[(0,n.jsx)("div",{className:"absolute inset-0 rounded-full",style:{backgroundColor:"#b7ddda",backgroundImage:"\n              repeating-linear-gradient(45deg, transparent, transparent 4px, rgba(0,0,0,0.05) 4px, rgba(0,0,0,0.05) 8px),\n              repeating-linear-gradient(-45deg, transparent, transparent 4px, rgba(0,0,0,0.05) 4px, rgba(0,0,0,0.05) 8px)\n            ",backgroundSize:"8px 8px",width:"48px",height:"48px"}}),(0,n.jsx)("div",{className:"w-12 h-12 rounded-full flex items-center justify-center relative z-10",style:{backgroundColor:"#4a5568"},children:(0,n.jsx)(tg.Z,{className:"w-6 h-6 text-white",strokeWidth:2.5,style:{filter:"drop-shadow(0 0 1px rgba(0,0,0,0.3))"}})})]}),D?(0,n.jsxs)("div",{className:"flex items-center gap-1 mt-1",onClick:e=>e.stopPropagation(),children:[(0,n.jsx)(tt.I,{ref:T,type:"text",value:R,onChange:e=>{Z(),l(o,{content:{...P,label:e.target.value,title:e.target.value}})},onBlur:A,onKeyDown:e=>{"Enter"===e.key?A():"Escape"===e.key&&S(!1)},className:"h-6 text-xs px-2 w-24",onClick:e=>e.stopPropagation(),onMouseDown:e=>e.stopPropagation(),autoFocus:!0}),(0,n.jsx)(eZ,{status:I,size:"sm"})]}):(0,n.jsx)("div",{className:"mt-1 text-xs font-medium text-gray-700 text-center max-w-[100px] truncate px-1",children:R||"Localizador"}),!D&&(0,n.jsx)(E.z,{variant:"ghost",size:"icon",className:"absolute top-0 right-0 h-5 w-5 opacity-0 group-hover:opacity-100 transition-opacity z-50",onClick:e=>{e.preventDefault(),e.stopPropagation(),S(!0),setTimeout(()=>{var e,t;null===(e=T.current)||void 0===e||e.focus(),null===(t=T.current)||void 0===t||t.select()},0)},onMouseDown:e=>{e.preventDefault(),e.stopPropagation()},children:(0,n.jsx)(tf.Z,{className:"h-3 w-3"})})]})},moodboard:function(e){let{id:t,properties:a,isSelected:r,onSelectElement:l,onEditElement:i,content:o,onUpdate:c,deleteElement:d,isListening:u,liveTranscript:p}=e,m="object"==typeof a&&null!==a?a:{},h="object"==typeof o&&null!==o&&"images"in o?o:{title:"Nuevo Moodboard",images:[],annotations:[],layout:"grid"},[x,g]=(0,s.useState)(!1),[f,v]=(0,s.useState)(""),[b,j]=(0,s.useState)(null),[w,y]=(0,s.useState)(null),[N,C]=(0,s.useState)(null),z=(0,s.useRef)(null),D=(0,s.useRef)(null),{saveStatus:S,handleBlur:T,handleChange:P}=eP({getContent:()=>{var e;return(null===(e=z.current)||void 0===e?void 0:e.value)||h.title||""},onSave:async e=>{e!==h.title&&c(t,{content:{...h,title:e}})},debounceMs:1e3}),R=(0,s.useCallback)(()=>{if(!f.trim())return;let e={id:"img-".concat(Date.now()),url:f.trim()};c(t,{content:{...h,images:[...h.images,e]}}),v(""),g(!1)},[t,h,f,c]),I=(0,s.useCallback)(e=>{c(t,{content:{...h,images:h.images.filter(t=>t.id!==e),annotations:h.annotations.filter(t=>t.imageId!==e)}})},[t,h,c]),M=(0,s.useCallback)((e,a)=>{let n=a.currentTarget.getBoundingClientRect(),r=(a.clientX-n.left)/n.width*100,s=(a.clientY-n.top)/n.height*100,l={id:"ann-".concat(Date.now()),imageId:e,x:Math.max(0,Math.min(100,r)),y:Math.max(0,Math.min(100,s)),text:"Nueva anotaci\xf3n",color:"#fffb8b"};c(t,{content:{...h,annotations:[...h.annotations,l]}}),j(l.id)},[t,h,c]),Z=(0,s.useCallback)((e,a)=>{c(t,{content:{...h,annotations:h.annotations.map(t=>t.id===e?{...t,...a}:t)}})},[t,h,c]);(0,s.useCallback)(e=>{c(t,{content:{...h,annotations:h.annotations.filter(t=>t.id!==e)}}),j(null)},[t,h,c]);let A=(0,s.useCallback)((e,t)=>{y(t),e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("text/html",t)},[]),L=(0,s.useCallback)((e,t)=>{e.preventDefault(),e.dataTransfer.dropEffect="move",C(t)},[]),F=(0,s.useCallback)(()=>{C(null)},[]),B=(0,s.useCallback)((e,a)=>{if(e.preventDefault(),!w)return;let n=h.images.findIndex(e=>e.id===w);if(-1===n||n===a){y(null),C(null);return}let r=[...h.images],[s]=r.splice(n,1);r.splice(a,0,s),c(t,{content:{...h,images:r}}),y(null),C(null)},[w,h,t,c]),O=(0,s.useCallback)(()=>{y(null),C(null)},[]),_=(0,s.useCallback)(()=>{c(t,{hidden:!0})},[t,c]),H=(null==m?void 0:m.backgroundColor)||"#ffffff";return h.layout,(0,n.jsxs)(X,{id:t,"data-element-type":"moodboard","data-element-id":t,ref:D,className:(0,k.cn)("w-full h-full flex flex-col overflow-hidden","min-w-[400px] min-h-[300px]","rounded-lg shadow-lg border border-gray-200/50",r?"ring-2 ring-blue-500 ring-offset-2":"","hover:shadow-xl transition-shadow"),style:{backgroundColor:"transparent"===H?"#ffffff":H,pointerEvents:"auto"},onClick:e=>{e.target.closest(".drag-handle")||i(t)},onMouseDown:e=>{e.target.closest(".drag-handle")||(e.stopPropagation(),l(t,!1))},children:[(0,n.jsxs)($,{className:"p-3 border-b border-gray-200 bg-white flex flex-row items-center justify-between",children:[(0,n.jsxs)("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:[(0,n.jsx)("div",{className:"drag-handle cursor-grab active:cursor-grabbing flex-shrink-0",children:(0,n.jsx)(es.Z,{className:"h-4 w-4 text-gray-400"})}),(0,n.jsx)("input",{ref:z,type:"text",value:h.title||"",onChange:e=>{P(),c(t,{content:{...h,title:e.target.value}})},onBlur:T,className:"flex-1 min-w-0 text-sm font-semibold bg-transparent border-none outline-none focus:outline-none focus:ring-0 p-1",placeholder:"T\xedtulo del moodboard...",onClick:e=>e.stopPropagation(),onMouseDown:e=>e.stopPropagation()})]}),(0,n.jsxs)("div",{className:"flex items-center gap-1 flex-shrink-0",children:[(0,n.jsx)(eZ,{status:S,size:"sm"}),(0,n.jsx)(E.z,{variant:"ghost",size:"icon",className:"h-7 w-7",title:"Agregar imagen",onClick:e=>{e.stopPropagation(),g(!0)},children:(0,n.jsx)(tj.Z,{className:"h-4 w-4"})}),(0,n.jsx)(E.z,{variant:"ghost",size:"icon",className:"h-7 w-7 text-gray-400 hover:text-gray-600",title:"Cerrar moodboard",onClick:e=>{e.stopPropagation(),_()},children:(0,n.jsx)(ef.Z,{className:"h-4 w-4"})})]})]}),(0,n.jsxs)(ee,{className:"flex-1 p-3 overflow-y-auto",style:{minHeight:0},children:[x&&(0,n.jsx)("div",{className:"mb-3 p-3 bg-gray-50 rounded-lg border border-gray-200",children:(0,n.jsxs)("div",{className:"flex gap-2",children:[(0,n.jsx)(tt.I,{type:"url",placeholder:"URL de la imagen...",value:f,onChange:e=>v(e.target.value),onKeyDown:e=>{"Enter"===e.key?R():"Escape"===e.key&&(g(!1),v(""))},className:"flex-1",onClick:e=>e.stopPropagation(),onMouseDown:e=>e.stopPropagation()}),(0,n.jsx)(E.z,{size:"sm",onClick:e=>{e.stopPropagation(),R()},children:"Agregar"}),(0,n.jsx)(E.z,{size:"sm",variant:"ghost",onClick:e=>{e.stopPropagation(),g(!1),v("")},children:"Cancelar"})]})}),0===h.images.length?(0,n.jsx)("div",{className:"flex items-center justify-center h-full text-sm text-gray-400",children:"Haz clic en el bot\xf3n de imagen para agregar im\xe1genes al moodboard"}):(0,n.jsx)("div",{className:(0,k.cn)("grid gap-4","grid-cols-2"),children:h.images.map((e,t)=>{let a=h.annotations.filter(t=>t.imageId===e.id),r=w===e.id;return(0,n.jsxs)("div",{draggable:!0,onDragStart:t=>A(t,e.id),onDragOver:e=>L(e,t),onDragLeave:F,onDrop:e=>B(e,t),onDragEnd:O,className:(0,k.cn)("relative group rounded-lg overflow-hidden border border-gray-200 bg-gray-50 transition-all",r&&"opacity-50 cursor-grabbing",N===t&&"ring-2 ring-blue-500 ring-offset-2 scale-105"),style:{cursor:r?"grabbing":"grab"},children:[(0,n.jsxs)("div",{className:"relative w-full aspect-square cursor-crosshair",onClick:t=>{t.target.closest(".annotation")||M(e.id,t)},children:[(0,n.jsx)("img",{src:e.url,alt:"Moodboard image",className:"w-full h-full object-cover",onError:e=>{e.target.style.display="none"}}),a.map(e=>(0,n.jsx)("div",{className:(0,k.cn)("annotation absolute p-2 rounded shadow-lg cursor-move min-w-[80px]",b===e.id?"z-10 ring-2 ring-blue-500":""),style:{left:"".concat(e.x,"%"),top:"".concat(e.y,"%"),backgroundColor:e.color||"#fffb8b",transform:"translate(-50%, -50%)"},onClick:t=>{t.stopPropagation(),j(e.id)},onMouseDown:e=>e.stopPropagation(),children:b===e.id?(0,n.jsx)(tt.I,{type:"text",value:e.text,onChange:t=>{Z(e.id,{text:t.target.value})},onBlur:()=>j(null),className:"text-xs h-6 px-1",onClick:e=>e.stopPropagation(),onMouseDown:e=>e.stopPropagation(),"data-annotation-id":e.id,autoFocus:!0}):(0,n.jsx)("div",{className:"text-xs font-medium",children:e.text})},e.id))]}),(0,n.jsx)(E.z,{variant:"ghost",size:"icon",className:"absolute top-2 right-2 h-6 w-6 opacity-0 group-hover:opacity-100 transition-opacity bg-red-500 hover:bg-red-600 text-white",onClick:t=>{t.stopPropagation(),I(e.id)},children:(0,n.jsx)(ef.Z,{className:"h-3 w-3"})})]},e.id)})})]})]})},"tabbed-notepad":function(e){var t;let{id:a,properties:r,isSelected:l,onSelectElement:i,onEditElement:o,content:c,onUpdate:d,deleteElement:u,isListening:p,liveTranscript:m,finalTranscript:h,interimTranscript:x}=e,{toast:g}=(0,f.pm)(),v="object"==typeof r&&null!==r?r:{},b="object"==typeof c&&null!==c&&"tabs"in c?c:{title:"Bloc de Notas",tabs:[{id:"tab-1",title:"Pesta\xf1a 1",content:""}],activeTabId:"tab-1"},[j,w]=(0,s.useState)(!1),[y,N]=(0,s.useState)(null),z=(0,s.useRef)(null),D=(0,s.useRef)(null),S=(0,s.useRef)({}),[T,P]=(0,s.useState)({}),R=(null==v?void 0:v.minimized)||!1,I=b.activeTabId||(null===(t=b.tabs[0])||void 0===t?void 0:t.id)||"tab-1",M=b.tabs.find(e=>e.id===I)||b.tabs[0],{saveStatus:Z,handleBlur:A,handleChange:L}=eP({getContent:()=>{var e;return(null===(e=z.current)||void 0===e?void 0:e.value)||b.title||""},onSave:async e=>{e!==b.title&&d(a,{content:{...b,title:e}})},debounceMs:1e3}),F=(0,s.useCallback)(()=>{let e={id:"tab-".concat(Date.now()),title:"Pesta\xf1a ".concat(b.tabs.length+1),content:""};d(a,{content:{...b,tabs:[...b.tabs,e],activeTabId:e.id}})},[a,b,d]),B=(0,s.useCallback)(e=>{var t;if(b.tabs.length<=1){g({variant:"destructive",title:"Error",description:"Debe haber al menos una pesta\xf1a."});return}let n=b.tabs.filter(t=>t.id!==e),r=e===I?(null===(t=n[0])||void 0===t?void 0:t.id)||"tab-1":I;d(a,{content:{...b,tabs:n,activeTabId:r}})},[a,b,I,d,g]),O=(0,s.useCallback)(e=>{d(a,{content:{...b,activeTabId:e}})},[a,b,d]),_=(0,s.useCallback)((e,t)=>{d(a,{content:{...b,tabs:b.tabs.map(a=>a.id===e?{...a,title:t}:a)}})},[a,b,d]),H=(0,s.useRef)(b);(0,s.useEffect)(()=>{H.current=b},[b]);let U=(0,s.useCallback)((e,t)=>{P(a=>({...a,[e]:t}));let n=H.current;d(a,{content:{...n,tabs:n.tabs.map(a=>a.id===e?{...a,content:t}:a)}})},[a,d]),J=(0,s.useRef)(""),q=(0,s.useRef)({});(0,s.useEffect)(()=>{q.current=T},[T]),(0,s.useEffect)(()=>{let e=b.tabs.map(e=>"".concat(e.id,"|").concat(e.content)).join("||");if(J.current===e&&Object.keys(q.current).length>0)return;J.current=e;let t={};b.tabs.forEach(e=>{let a=S.current[e.id];if(a&&document.activeElement!==a){let a=q.current[e.id];a!==e.content?t[e.id]=e.content:t[e.id]=null!=a?a:e.content}else{var n;t[e.id]=null!==(n=q.current[e.id])&&void 0!==n?n:e.content}}),(Object.keys(t).some(e=>t[e]!==q.current[e])||0===Object.keys(q.current).length)&&P(t)},[b.tabs]);let K=(0,s.useCallback)(async()=>{if(!D.current){g({variant:"destructive",title:"Error",description:"No se pudo encontrar el elemento para exportar."});return}w(!0),g({title:"Exportando...",description:"Generando imagen PNG de alta resoluci\xf3n."});try{(await C()(D.current,{backgroundColor:"#ffffff",scale:3,useCORS:!0,logging:!1,allowTaint:!1,windowWidth:D.current.scrollWidth,windowHeight:D.current.scrollHeight})).toBlob(e=>{if(!e){g({variant:"destructive",title:"Error",description:"No se pudo generar la imagen."}),w(!1);return}let t=URL.createObjectURL(e),a=document.createElement("a");a.href=t;let n=b.title||"bloc-notas";a.download="".concat(n,"_").concat(Date.now(),".png"),document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(t),g({title:"Exportado",description:"El bloc de notas se ha exportado como PNG de alta resoluci\xf3n."}),w(!1)},"image/png",1)}catch(e){console.error("Error al exportar:",e),g({variant:"destructive",title:"Error",description:e.message||"Ocurri\xf3 un error al exportar."}),w(!1)}},[b.title,g]),V=(0,s.useCallback)(()=>{d(a,{hidden:!0})},[a,d]),W=(0,s.useCallback)(e=>{e.stopPropagation();let t=(null==v?void 0:v.size)||{width:500,height:400};if(R){let e=(null==v?void 0:v.originalSize)||t;d(a,{minimized:!1,properties:{...v,size:e,originalSize:void 0}})}else{let e="number"==typeof t.width?t.width:500;d(a,{minimized:!0,properties:{...v,size:{width:e,height:48},originalSize:t}})}},[a,R,v,d]),G=(0,s.useRef)(null);(0,s.useEffect)(()=>{let e=document.activeElement;e&&"TEXTAREA"===e.tagName&&D.current&&D.current.contains(e)&&(G.current=e)},[M]);let Y=(0,s.useRef)(U);(0,s.useEffect)(()=>{Y.current=U},[U]),(0,s.useEffect)(()=>{if(G.current&&M){let e=G.current,t=()=>{Y.current(M.id,e.value)};return e.addEventListener("input",t),()=>e.removeEventListener("input",t)}},[null==M?void 0:M.id]);let Q=(null==v?void 0:v.backgroundColor)||"#ffffff";return R?(0,n.jsx)(X,{id:a,"data-element-type":"tabbed-notepad","data-element-id":a,className:(0,k.cn)("w-full h-full flex items-center shadow-lg rounded-lg border border-gray-200/50",l?"ring-2 ring-blue-500 ring-offset-2":""),style:{backgroundColor:Q,minHeight:"48px"},onClick:e=>{e.target.closest(".drag-handle")||o(a)},children:(0,n.jsxs)($,{className:"p-2 flex flex-row items-center justify-between w-full",children:[(0,n.jsxs)("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:[(0,n.jsx)("div",{className:"drag-handle cursor-grab active:cursor-grabbing",children:(0,n.jsx)(es.Z,{className:"h-4 w-4 text-gray-400"})}),(0,n.jsx)("span",{className:"text-sm font-semibold truncate",children:b.title||"Bloc de Notas"})]}),(0,n.jsx)(E.z,{variant:"ghost",size:"icon",className:"h-7 w-7",title:"Maximizar",onClick:W,children:(0,n.jsx)(el.Z,{className:"h-4 w-4"})})]})}):(0,n.jsxs)(X,{id:a,"data-element-type":"tabbed-notepad","data-element-id":a,ref:D,className:(0,k.cn)("w-full h-full flex flex-col overflow-hidden","min-w-[400px] min-h-[300px]","rounded-lg shadow-lg border border-gray-200/50",l?"ring-2 ring-blue-500 ring-offset-2":"","hover:shadow-xl transition-shadow"),style:{backgroundColor:"transparent"===Q?"#ffffff":Q,pointerEvents:"auto"},onClick:e=>{e.target.closest(".drag-handle")||o(a)},onMouseDown:e=>{e.target.closest(".drag-handle")||(e.stopPropagation(),i(a,!1))},children:[(0,n.jsxs)($,{className:"p-3 border-b border-gray-200 bg-white flex flex-row items-center justify-between",children:[(0,n.jsxs)("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:[(0,n.jsx)("div",{className:"drag-handle cursor-grab active:cursor-grabbing flex-shrink-0",children:(0,n.jsx)(es.Z,{className:"h-4 w-4 text-gray-400"})}),(0,n.jsx)("input",{ref:z,type:"text",value:b.title||"",onChange:e=>{L(),d(a,{content:{...b,title:e.target.value}})},onBlur:A,className:"flex-1 min-w-0 text-sm font-semibold bg-transparent border-none outline-none focus:outline-none focus:ring-0 p-1",placeholder:"T\xedtulo del bloc...",onClick:e=>e.stopPropagation(),onMouseDown:e=>e.stopPropagation()})]}),(0,n.jsxs)("div",{className:"flex items-center gap-1 flex-shrink-0",children:[(0,n.jsx)(eZ,{status:Z,size:"sm"}),(0,n.jsx)(E.z,{variant:"ghost",size:"icon",className:"h-7 w-7",title:"Exportar a PNG",onClick:e=>{e.stopPropagation(),K()},disabled:j,children:(0,n.jsx)(tr.Z,{className:"h-4 w-4"})}),(0,n.jsx)(E.z,{variant:"ghost",size:"icon",className:"h-7 w-7",title:R?"Maximizar":"Minimizar",onClick:e=>{e.stopPropagation(),W(e)},children:R?(0,n.jsx)(el.Z,{className:"h-4 w-4"}):(0,n.jsx)(eg.Z,{className:"h-4 w-4"})}),(0,n.jsx)(E.z,{variant:"ghost",size:"icon",className:"h-7 w-7 text-gray-400 hover:text-gray-600",title:"Cerrar bloc",onClick:e=>{e.stopPropagation(),V()},children:(0,n.jsx)(ef.Z,{className:"h-4 w-4"})})]})]}),(0,n.jsx)(e0,{content:(null==M?void 0:M.content)||"",onCategorySelect:N}),(0,n.jsx)(ee,{className:"flex-1 p-3 overflow-hidden flex flex-col",style:{minHeight:0},children:(0,n.jsxs)(eU,{value:I,onValueChange:O,className:"flex-1 flex flex-col overflow-hidden",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,n.jsx)(eJ,{className:"flex-1 justify-start overflow-x-auto",children:b.tabs.map(e=>(0,n.jsxs)(eq,{value:e.id,className:"relative group/tab",onClick:e=>e.stopPropagation(),children:[(0,n.jsx)("input",{type:"text",value:e.title,onChange:t=>{t.stopPropagation(),_(e.id,t.target.value)},onClick:e=>e.stopPropagation(),onMouseDown:e=>e.stopPropagation(),className:"bg-transparent border-none outline-none text-xs px-1 min-w-[60px] max-w-[120px]"}),b.tabs.length>1&&(0,n.jsx)("span",{className:"inline-flex items-center justify-center h-4 w-4 ml-1 opacity-0 group-hover/tab:opacity-100 transition-opacity cursor-pointer hover:bg-gray-100 rounded",onClick:t=>{t.stopPropagation(),t.preventDefault(),B(e.id)},onMouseDown:e=>{e.stopPropagation(),e.preventDefault()},role:"button",tabIndex:0,onKeyDown:t=>{("Enter"===t.key||" "===t.key)&&(t.preventDefault(),t.stopPropagation(),B(e.id))},children:(0,n.jsx)(ef.Z,{className:"h-3 w-3"})})]},e.id))}),(0,n.jsx)(E.z,{variant:"ghost",size:"icon",className:"h-7 w-7 ml-2",title:"Agregar pesta\xf1a",onClick:e=>{e.stopPropagation(),F()},children:(0,n.jsx)(er.Z,{className:"h-4 w-4"})})]}),b.tabs.map(e=>{let t=void 0!==T[e.id]?T[e.id]:e.content;return(0,n.jsx)(eK,{value:e.id,className:"flex-1 overflow-hidden mt-0",children:(0,n.jsx)("textarea",{ref:t=>{S.current[e.id]=t,t&&void 0===T[e.id]&&P(t=>({...t,[e.id]:e.content}))},value:t,onChange:t=>{U(e.id,t.target.value)},className:"w-full h-full resize-none border-none outline-none bg-transparent p-2 text-sm",placeholder:"Escribe aqu\xed...",onClick:e=>e.stopPropagation(),onMouseDown:e=>e.stopPropagation(),style:{minHeight:"200px"}})},e.id)})]})})]})},accordion:function(e){let{id:t,content:a,properties:r,isSelected:l,onUpdate:i,isListening:o,liveTranscript:c,finalTranscript:d,interimTranscript:u}=e,p="object"==typeof r&&null!==r?r:{},m="object"==typeof a&&null!==a&&"items"in a?a:{items:[{id:"1",title:"Nuevo Item",content:""}]},[h,x]=(0,s.useState)(m.items||[]),[g,f]=(0,s.useState)(h.filter(e=>e.isOpen).map(e=>e.id)),v=(0,s.useRef)("");(0,s.useEffect)(()=>{let e=JSON.stringify(a);v.current!==e&&(v.current=e,"object"==typeof a&&null!==a&&"items"in a&&(x(a.items||[]),f(a.items.filter(e=>e.isOpen).map(e=>e.id))))},[a]);let b=e=>{let a=h.filter(t=>t.id!==e);x(a),f(g.filter(t=>t!==e)),i(t,{content:{items:a}})},j=(e,a)=>{let n=h.map(t=>t.id===e?{...t,...a}:t);x(n),i(t,{content:{items:n}})},w=p.size||{width:320,height:240},y="number"==typeof w.width?w.width:320,N="number"==typeof w.height?w.height:240;return(0,n.jsxs)(X,{className:(0,k.cn)("w-full h-full p-3 bg-white shadow-sm drag-handle",l&&"ring-2 ring-primary"),style:{width:"".concat(y,"px"),height:"".concat(N,"px"),backgroundColor:p.backgroundColor||"#ffffff"},children:[(0,n.jsxs)("div",{className:"flex items-center justify-between mb-2 drag-handle",children:[(0,n.jsxs)("div",{className:"flex items-center gap-2 drag-handle",children:[(0,n.jsx)(es.Z,{className:"h-4 w-4 text-slate-400 cursor-move drag-handle"}),(0,n.jsx)("h3",{className:"font-semibold text-slate-800 text-sm drag-handle",children:"Acorde\xf3n"})]}),(0,n.jsxs)("div",{className:"flex items-center gap-1",children:[l&&(0,n.jsxs)(e4,{children:[(0,n.jsx)(e5,{asChild:!0,children:(0,n.jsx)(E.z,{size:"sm",variant:"ghost",className:"h-7 w-7 p-0",onClick:e=>e.stopPropagation(),children:(0,n.jsx)(ta.Z,{className:"h-4 w-4"})})}),(0,n.jsx)(e3,{className:"w-auto p-0",onClick:e=>e.stopPropagation(),children:(0,n.jsx)(e8.e8,{color:p.backgroundColor||"#ffffff",onChange:e=>i(t,{properties:{...p,backgroundColor:e.hex}})})})]}),(0,n.jsx)(E.z,{size:"sm",variant:"ghost",onClick:()=>{let e=[...h,{id:Date.now().toString(),title:"Nuevo Item",content:"",isOpen:!1}];x(e),i(t,{content:{items:e}})},className:"h-7 w-7 p-0",children:(0,n.jsx)(er.Z,{className:"h-4 w-4"})})]})]}),(0,n.jsx)(ty,{type:"multiple",value:g,onValueChange:e=>{let a=Array.isArray(e)?e:e?[e]:[];f(a),i(t,{content:{items:h.map(e=>({...e,isOpen:a.includes(e.id)}))}})},className:"w-full",children:h.map(e=>(0,n.jsxs)(tN,{value:e.id,children:[(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)(tC,{className:"flex-1 text-left",onClick:e=>e.stopPropagation(),children:(0,n.jsx)(tE,{value:e.title,onChange:t=>j(e.id,{title:t}),isListening:o,liveTranscript:c,finalTranscript:d})}),l&&(0,n.jsx)(E.z,{size:"sm",variant:"ghost",onClick:t=>{t.stopPropagation(),b(e.id)},className:"h-7 w-7 p-0 text-destructive hover:text-destructive",children:(0,n.jsx)(ef.Z,{className:"h-4 w-4"})})]}),(0,n.jsx)(tk,{children:(0,n.jsx)(tz,{value:e.content,onChange:t=>j(e.id,{content:t}),isListening:o,liveTranscript:c,finalTranscript:d,interimTranscript:u,isSelected:l})})]},e.id))}),0===h.length&&(0,n.jsx)("div",{className:"text-center text-slate-400 py-8",children:(0,n.jsx)("p",{children:"No hay items. Haz clic en + para agregar uno."})})]})},"yellow-notepad":function(e){let{id:t,content:a,properties:r,onUpdate:l,deleteElement:i,isSelected:o,isListening:c,liveTranscript:d,finalTranscript:u,interimTranscript:p}=e,{toast:m}=(0,f.pm)(),h=(0,s.useRef)(null),[x,g]=(0,s.useState)(!1),[v,b]=(0,s.useState)(!1),j=a||{},w=j.text||"",y=j.searchQuery||"",N=(0,s.useRef)(j),z=(0,s.useRef)(w);(0,s.useEffect)(()=>{N.current=j,z.current=w},[j,w]);let[D,S]=(0,s.useState)(y),T=(0,s.useRef)(void 0);(0,s.useEffect)(()=>{let e=j.searchQuery;void 0!==e&&e!==T.current&&(T.current=e,e!==D&&S(e))},[j.searchQuery,D]);let{saveStatus:P,handleBlur:R,handleChange:I}=eP({getContent:()=>{var e;return(null===(e=h.current)||void 0===e?void 0:e.innerText)||""},onSave:async e=>{e!==(z.current||"").trim()&&await l(t,{content:{text:e,searchQuery:D}})},debounceMs:2e3,compareContent:(e,t)=>(e||"").trim()===(t||"").trim()}),M=(0,s.useRef)("");(0,s.useEffect)(()=>{M.current!==w&&(M.current=w,h.current&&w!==h.current.innerText&&document.activeElement!==h.current&&(h.current.innerText=w||""))},[w]);let Z=(0,s.useCallback)(async e=>{e.stopPropagation(),e.preventDefault();try{let e=document.querySelector('[data-element-id="'.concat(t,'"]'));if(!e){m({variant:"destructive",title:"Error",description:"No se pudo encontrar el elemento para exportar."});return}b(!0),m({title:"Exportando...",description:"Generando imagen PNG de alta resoluci\xf3n."}),(await C()(e,{backgroundColor:"#FFFFE0",scale:2.1,useCORS:!0,logging:!1,allowTaint:!1,windowWidth:e.scrollWidth,windowHeight:e.scrollHeight})).toBlob(e=>{if(!e){m({variant:"destructive",title:"Error",description:"No se pudo generar la imagen."}),b(!1);return}let t=URL.createObjectURL(e),a=document.createElement("a");a.href=t,a.download="yellow-notepad_".concat(Date.now(),".png"),document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(t),m({title:"Exportado",description:"El cuaderno se ha exportado como PNG de alta resoluci\xf3n."}),b(!1)},"image/png",1)}catch(e){console.error("Error al exportar:",e),m({variant:"destructive",title:"Error",description:e.message||"No se pudo exportar."}),b(!1)}},[m,t]),A=(0,s.useCallback)(()=>{I()},[I]),F=(0,s.useCallback)(async()=>{await R()},[R]),B=(0,s.useCallback)(e=>{let a=e.target.value;S(a),l(t,{content:{...N.current,searchQuery:a}})},[t,l]),O=(0,s.useCallback)(()=>{x||(g(!0),i(t))},[t,i,x]),_=(0,s.useCallback)(()=>{O()},[O]);return(0,n.jsxs)("div",{"data-element-id":t,className:(0,k.cn)("relative w-full h-full flex flex-col overflow-hidden"),style:{backgroundColor:"#FFFFE0",borderRadius:"4px",boxShadow:"0 2px 8px rgba(0,0,0,0.1)"},onMouseDown:e=>{var t;let a=e.target;a===h.current||(null===(t=h.current)||void 0===t?void 0:t.contains(a))?e.currentTarget.classList.remove("drag-handle"):e.currentTarget.classList.add("drag-handle")},children:[(0,n.jsxs)("div",{className:"flex items-center justify-between px-4 py-3 drag-handle",style:{backgroundColor:"#e9e490",color:"#000000"},children:[(0,n.jsxs)("div",{className:"flex items-center gap-3",children:[(0,n.jsx)(E.z,{variant:"ghost",size:"icon",className:"h-6 w-6 hover:bg-black/10 p-0",style:{color:"#000000"},children:(0,n.jsx)(tD.Z,{className:"h-4 w-4"})}),(0,n.jsxs)("div",{className:"flex flex-col",children:[(0,n.jsx)("span",{className:"text-sm font-bold leading-tight",style:{color:"#000000"},children:"Nuevo"}),(0,n.jsx)("span",{className:"text-sm font-bold leading-tight",style:{color:"#000000"},children:"Notepad"})]})]}),(0,n.jsxs)("div",{className:"flex items-center gap-2 flex-1 max-w-xs mx-4",children:[(0,n.jsx)(tv.Z,{className:"h-4 w-4",style:{color:"#000000"}}),(0,n.jsx)(tt.I,{type:"text",placeholder:"Buscar...",value:D,onChange:B,className:"h-7 text-sm bg-transparent border-none text-black placeholder:text-gray-600 focus-visible:ring-0 focus-visible:ring-offset-0",style:{color:"#000000"}})]}),(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsxs)(ew,{children:[(0,n.jsx)(ey,{asChild:!0,children:(0,n.jsx)(E.z,{variant:"ghost",size:"icon",className:"h-6 w-6 hover:bg-black/10 p-0",style:{color:"#000000"},children:(0,n.jsx)(em.Z,{className:"h-4 w-4"})})}),(0,n.jsx)(eE,{children:(0,n.jsxs)(ez,{onMouseDown:e=>{e.preventDefault(),e.stopPropagation(),Z(e)},disabled:v,children:[(0,n.jsx)(eh.Z,{className:"mr-2 h-4 w-4"}),(0,n.jsx)("span",{children:v?"Exportando...":"Exportar a PNG: alta resoluci\xf3n"})]})})]}),(0,n.jsx)(E.z,{variant:"ghost",size:"icon",className:"h-6 w-6 hover:bg-black/10 p-0",onClick:O,style:{color:"#000000"},children:(0,n.jsx)(L.Z,{className:"h-4 w-4"})}),(0,n.jsx)(E.z,{variant:"ghost",size:"icon",className:"h-6 w-6 hover:bg-black/10 p-0",onClick:_,style:{color:"#000000"},children:(0,n.jsx)(ef.Z,{className:"h-4 w-4"})})]})]}),(0,n.jsxs)("div",{className:"flex-1 overflow-y-auto relative",style:{backgroundColor:"#FFFFE0",position:"relative"},children:[(0,n.jsx)("div",{className:"absolute left-0 top-0 bottom-0",style:{width:"15px",borderLeft:"1px solid #ADD8E6"}}),(0,n.jsx)("div",{className:"absolute inset-0 pointer-events-none",style:{backgroundImage:"repeating-linear-gradient(to bottom, transparent, transparent 24px, #ADD8E6 24px, #ADD8E6 25px)",backgroundPosition:"15px 0",backgroundSize:"100% 25px"}}),(0,n.jsx)("div",{ref:h,contentEditable:!0,onInput:A,onBlur:F,onMouseDown:e=>{(e.target===e.currentTarget||e.target.isContentEditable)&&e.stopPropagation()},className:(0,k.cn)("relative z-10 w-full min-h-full","outline-none","text-black","whitespace-pre-wrap","break-words","select-text"),style:{paddingLeft:"20px",paddingRight:"15px",paddingTop:"12px",paddingBottom:"12px",fontFamily:"system-ui, -apple-system, sans-serif",fontSize:"14px",lineHeight:"25px",color:"#000000",minHeight:"100%",userSelect:"text",WebkitUserSelect:"text"}}),o&&(0,n.jsx)("div",{className:"absolute top-2 right-2 z-20",children:(0,n.jsx)(eZ,{status:P,size:"sm"})})]})]})},stopwatch:function(e){let{id:t,onUpdate:a,onSelectElement:r,isSelected:l,deleteElement:i}=e,[o,c]=(0,s.useState)(0),[d,u]=(0,s.useState)(!1),p=(0,s.useRef)(null);(0,s.useEffect)(()=>(d?p.current=setInterval(()=>{c(e=>e+10)},10):p.current&&(clearInterval(p.current),p.current=null),()=>{p.current&&clearInterval(p.current)}),[d]);let m=(0,s.useCallback)(e=>{e.stopPropagation(),u(e=>!e)},[]),h=(0,s.useCallback)(e=>{e.stopPropagation(),u(!1),c(0)},[]),{minutes:x,seconds:g,centiseconds:f}=(e=>{let t=Math.floor(e/1e3);return{minutes:Math.floor(t/60),seconds:t%60,centiseconds:Math.floor(e%1e3/10)}})(o);return(0,n.jsxs)("div",{className:"w-full h-full flex flex-col rounded-xl overflow-hidden shadow-lg",style:{background:"linear-gradient(135deg, #1a1a2e 0%, #16213e 100%)",minWidth:"140px",minHeight:"80px"},onClick:()=>r(t,!1),children:[(0,n.jsx)("div",{className:"drag-handle flex items-center justify-center py-1 cursor-grab active:cursor-grabbing bg-black/20",children:(0,n.jsx)(es.Z,{className:"w-4 h-4 text-white/40"})}),(0,n.jsx)("div",{className:"flex-1 flex items-center justify-center px-3 py-2",children:(0,n.jsxs)("div",{className:"flex items-baseline gap-0.5 font-mono",children:[(0,n.jsx)("span",{className:"text-2xl font-bold text-white",children:x.toString().padStart(2,"0")}),(0,n.jsx)("span",{className:"text-lg text-white/60",children:":"}),(0,n.jsx)("span",{className:"text-2xl font-bold text-white",children:g.toString().padStart(2,"0")}),(0,n.jsxs)("span",{className:"text-xs text-white/40 ml-0.5",children:[".",f.toString().padStart(2,"0")]})]})}),(0,n.jsxs)("div",{className:"flex items-center justify-center gap-2 py-2 px-3 bg-black/20",children:[(0,n.jsx)("button",{onClick:m,className:"\n            w-8 h-8 rounded-full flex items-center justify-center transition-all\n            ".concat(d?"bg-amber-500 hover:bg-amber-600 text-white":"bg-emerald-500 hover:bg-emerald-600 text-white","\n          "),children:d?(0,n.jsx)(tT.Z,{className:"w-4 h-4"}):(0,n.jsx)(tP.Z,{className:"w-4 h-4 ml-0.5"})}),(0,n.jsx)("button",{onClick:h,className:"w-7 h-7 rounded-full bg-white/10 hover:bg-white/20 flex items-center justify-center transition-all",children:(0,n.jsx)(tR.Z,{className:"w-3.5 h-3.5 text-white/70"})})]})]})},countdown:function(e){let{id:t,onUpdate:a,onSelectElement:r,isSelected:l,deleteElement:i}=e,[o,c]=(0,s.useState)(0),[d,u]=(0,s.useState)(!1),[p,m]=(0,s.useState)(5),[h,x]=(0,s.useState)(!1),g=(0,s.useRef)(null);(0,s.useEffect)(()=>(d&&o>0?g.current=setInterval(()=>{c(e=>e<=1e3?(u(!1),x(!0),setTimeout(()=>x(!1),5e3),0):e-1e3)},1e3):g.current&&(clearInterval(g.current),g.current=null),()=>{g.current&&clearInterval(g.current)}),[d,o]);let f=(0,s.useCallback)(e=>{e.stopPropagation(),0===o&&c(6e4*p),x(!1),u(!0)},[o,p]),v=(0,s.useCallback)(e=>{e.stopPropagation(),u(!1)},[]),b=(0,s.useCallback)(e=>{e.stopPropagation(),u(!1),c(0),x(!1)},[]),j=(0,s.useCallback)((e,t)=>{t.stopPropagation(),m(e),d||c(0)},[d]),{minutes:w,seconds:y}=(e=>{let t=Math.floor(e/1e3);return{minutes:Math.floor(t/60),seconds:t%60}})(o),N=0===o&&!d;return(0,n.jsxs)("div",{className:"\n        w-full h-full flex flex-col rounded-xl overflow-hidden shadow-lg transition-all\n        ".concat(h?"animate-pulse ring-2 ring-red-500":"","\n      "),style:{background:h?"linear-gradient(135deg, #7f1d1d 0%, #991b1b 100%)":"linear-gradient(135deg, #0f172a 0%, #1e293b 100%)",minWidth:"160px",minHeight:N?"120px":"80px"},onClick:()=>r(t,!1),children:[(0,n.jsxs)("div",{className:"drag-handle flex items-center justify-center py-1 cursor-grab active:cursor-grabbing bg-black/20",children:[(0,n.jsx)(es.Z,{className:"w-4 h-4 text-white/40"}),h&&(0,n.jsx)(tI.Z,{className:"w-3.5 h-3.5 text-red-300 ml-1 animate-bounce"})]}),(0,n.jsx)("div",{className:"flex-1 flex flex-col items-center justify-center px-3 py-2",children:N?(0,n.jsxs)("div",{className:"flex flex-col items-center gap-2 w-full",children:[(0,n.jsx)("span",{className:"text-xs text-white/50 uppercase tracking-wide",children:"Seleccionar"}),(0,n.jsx)("div",{className:"flex flex-wrap justify-center gap-1",children:tM.map(e=>(0,n.jsxs)("button",{onClick:t=>j(e,t),className:"\n                    px-2 py-1 rounded text-xs font-medium transition-all\n                    ".concat(p===e?"bg-cyan-500 text-white":"bg-white/10 text-white/70 hover:bg-white/20","\n                  "),children:[e,"m"]},e))})]}):(0,n.jsxs)("div",{className:"flex items-baseline gap-1 font-mono",children:[(0,n.jsx)("span",{className:"text-3xl font-bold ".concat(h?"text-red-200":"text-white"),children:w.toString().padStart(2,"0")}),(0,n.jsx)("span",{className:"text-xl ".concat(h?"text-red-300/60":"text-white/60"),children:":"}),(0,n.jsx)("span",{className:"text-3xl font-bold ".concat(h?"text-red-200":"text-white"),children:y.toString().padStart(2,"0")})]})}),(0,n.jsxs)("div",{className:"flex items-center justify-center gap-2 py-2 px-3 bg-black/20",children:[d?(0,n.jsx)("button",{onClick:v,className:"w-8 h-8 rounded-full bg-amber-500 hover:bg-amber-600 flex items-center justify-center transition-all",children:(0,n.jsx)(tT.Z,{className:"w-4 h-4 text-white"})}):(0,n.jsx)("button",{onClick:f,className:"w-8 h-8 rounded-full bg-cyan-500 hover:bg-cyan-600 flex items-center justify-center transition-all",children:(0,n.jsx)(tP.Z,{className:"w-4 h-4 text-white ml-0.5"})}),(0,n.jsx)("button",{onClick:b,className:"w-7 h-7 rounded-full bg-white/10 hover:bg-white/20 flex items-center justify-center transition-all",children:(0,n.jsx)(tR.Z,{className:"w-3.5 h-3.5 text-white/70"})})]})]})},"highlight-text":function(e){let{id:t,content:a,properties:r,onUpdate:l,onSelectElement:i,isSelected:o,isListening:c,liveTranscript:d,finalTranscript:u,interimTranscript:p}=e,[m,h]=(0,s.useState)((null==a?void 0:a.text)||""),[x,g]=(0,s.useState)((null==r?void 0:r.backgroundColor)||tZ[0].value);(0,s.useRef)(null);let f=(0,s.useRef)(null);(0,s.useEffect)(()=>{(null==a?void 0:a.text)!==m&&h((null==a?void 0:a.text)||""),(null==r?void 0:r.backgroundColor)!==x&&g((null==r?void 0:r.backgroundColor)||tZ[0].value)},[a,null==r?void 0:r.backgroundColor]);let v=(0,s.useCallback)(e=>{let n=e.currentTarget.textContent||"";h(n),l(t,{content:{...a,text:n}})},[t,a,l]),b=(0,s.useCallback)(e=>{g(e),l(t,{properties:{...r,backgroundColor:e}})},[t,r,l]);return(0,n.jsxs)("div",{className:"rounded-lg p-4 shadow-lg",style:{width:"100%",height:"100%",backgroundColor:x,border:o?"2px solid #3b82f6":"1px solid #e5e7eb"},onClick:()=>i(t,!1),children:[o&&(0,n.jsx)("div",{className:"mb-2 flex gap-1 flex-wrap",children:tZ.map(e=>(0,n.jsx)("button",{className:"w-6 h-6 rounded border border-gray-300 hover:scale-110 transition-transform",style:{backgroundColor:e.value},onClick:t=>{t.stopPropagation(),b(e.value)},title:e.label},e.name))}),(0,n.jsx)(tp(),{innerRef:f,html:m,onChange:v,className:"outline-none min-h-[100px] w-full",style:{backgroundColor:"transparent"}})]})}},tL=e=>{var t,a;if("object"==typeof e.properties&&null!==e.properties&&"position"in e.properties&&"size"in e.properties&&"zIndex"in e.properties)return e;let n="object"==typeof e.properties&&null!==e.properties?e.properties:{},r="x"in e?e.x:void 0,s="y"in e?e.y:void 0,l="width"in e?e.width:void 0,i="height"in e?e.height:void 0,o="zIndex"in e?e.zIndex:void 0;return{...e,properties:{position:n.position||{x:r||100,y:s||100},size:n.size||{width:l||200,height:i||150},zIndex:null!==(a=null!==(t=n.zIndex)&&void 0!==t?t:o)&&void 0!==a?a:1,rotation:n.rotation||0,...n}}};function tF(e){var t,a,r,l;let{element:i,allElements:o,scale:c,offset:d={x:0,y:0},isSelected:u,updateElement:p,unanchorElement:m,deleteElement:h,onFormatToggle:x,onChangeNotepadFormat:g,onLocateElement:f,onSelectElement:v,onBringToFront:b,onSendToBack:j,onMoveBackward:w,onEditElement:y,onGroupElements:N,addElement:C,activatedElementId:z,onActivateDrag:D,onEditComment:S,onDuplicateElement:T,onUngroup:P,setIsDirty:R,boardId:I,isListening:M,liveTranscript:Z,finalTranscript:A="",interimTranscript:B=""}=e,O=tL(i),[_,H]=(0,s.useState)(!1),U="object"==typeof O.properties&&null!==O.properties?O.properties:{},J=O.parentId&&U.relativePosition?U.relativePosition:U.position||{x:O.x||0,y:O.y||0},q=U.size||{width:O.width||200,height:O.height||150},K=null!==(a=null!==(t=U.rotation)&&void 0!==t?t:O.rotation)&&void 0!==a?a:0,V=null!==(l=null!==(r=U.zIndex)&&void 0!==r?r:O.zIndex)&&void 0!==l?l:1,W={width:"number"==typeof q.width&&q.width>0?q.width:200,height:"number"==typeof q.height&&q.height>0?q.height:150},G=(0,s.useCallback)((e,t)=>{var a,n,r,s,l,i;let c={x:t.x,y:t.y},d="object"==typeof O.properties&&null!==O.properties?O.properties:{};if("container"!==O.type){let t=e.clientX||(null===(n=e.touches)||void 0===n?void 0:null===(a=n[0])||void 0===a?void 0:a.clientX)||0,i=e.clientY||(null===(s=e.touches)||void 0===s?void 0:null===(r=s[0])||void 0===r?void 0:r.clientY)||0,u=t,m=i;if(!u||!m){let e=document.querySelector('[data-element-id="'.concat(O.id,'"]'));if(e){let t=e.getBoundingClientRect();u=t.left+t.width/2,m=t.top+t.height/2}}for(let e of[{x:u,y:m},{x:u-10,y:m},{x:u+10,y:m},{x:u,y:m-10},{x:u,y:m+10}]){let t=document.elementFromPoint(e.x,e.y);if(t){let a=t.closest('[data-element-type="container"]');if(a){let t=a.getAttribute("data-element-id");if(t&&t!==O.id){let n=o.find(e=>e.id===t&&"container"===e.type);if(n){let r=n.content,s=a.getBoundingClientRect(),i=e.x,o=e.y;if(i>=s.left&&i<=s.right&&o>=s.top&&o<=s.bottom&&r&&!(null===(l=r.elementIds)||void 0===l?void 0:l.includes(O.id))){let e=[...r.elementIds||[],O.id];p(n.id,{content:{...r,elementIds:e}}),p(O.id,{parentId:n.id,hidden:!0,properties:{...d,position:c}}),console.log("✅ Elemento guardado en contenedor:",{elementId:O.id,containerId:t,dropX:i,dropY:o,containerRect:s});return}}}}}}}if(O.parentId){let e=o.find(e=>e.id===O.parentId);if(e&&"container"===e.type){let t=e.content;if(t&&(null===(i=t.elementIds)||void 0===i?void 0:i.includes(O.id))){let a=t.elementIds.filter(e=>e!==O.id);p(e.id,{content:{...t,elementIds:a}})}}p(O.id,{parentId:void 0,hidden:!1,properties:{...d,position:c}})}else p(O.id,{properties:{...d,position:c}})},[O,o,p,W]),Y=(0,s.useCallback)((e,t,a,n,r)=>{let s="object"==typeof O.properties&&null!==O.properties?O.properties:{},l={width:parseFloat(a.style.width),height:parseFloat(a.style.height)},i=O.parentId?r:{x:r.x,y:r.y},o={properties:{...s,size:l,...O.parentId?{relativePosition:i}:{position:i}}};p(O.id,o)},[O,p]),X=(0,s.useCallback)(e=>{e.stopPropagation(),e.preventDefault(),H(!0)},[]),$=(0,s.useCallback)(()=>{h&&h(O.id),H(!1)},[h,O.id]),ee=tA[O.type];if(!ee)return console.warn("ElementComponent no encontrado para tipo: ".concat(O.type)),null;if(!W||"number"!=typeof W.width||"number"!=typeof W.height)return console.warn("Tama\xf1o inv\xe1lido para elemento ".concat(O.id,":"),W),null;let et={style:{zIndex:V,border:u?"2px solid hsl(var(--primary))":"none",boxSizing:"border-box",transform:"rotate(".concat(K,"deg)"),transformOrigin:"center center"},size:{width:W.width,height:W.height},position:J,onDragStop:G,onResizeStop:Y,minWidth:50,minHeight:50,dragHandleClassName:"drag-handle",className:(0,k.cn)("focus:outline-none"),onMouseDown:e=>{v(O.id,e.altKey||e.shiftKey||e.metaKey||e.ctrlKey)},enableResizing:!0,scale:c,bounds:O.parentId&&"container"!==O.type?'[data-element-id="'.concat(O.parentId,'"]'):void 0};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(F.s,{...et,children:(0,n.jsxs)("div",{"data-element-id":O.id,"data-element-type":O.type,className:"w-full h-full relative group",children:[u&&(0,n.jsx)(E.z,{variant:"destructive",size:"icon",className:"absolute -top-3 -right-3 z-50 h-8 w-8 rounded-full shadow-lg opacity-0 group-hover:opacity-100 transition-opacity",onClick:X,onMouseDown:e=>e.stopPropagation(),children:(0,n.jsx)(L.Z,{className:"h-4 w-4"})}),(0,n.jsx)(ee,{id:O.id,type:O.type,x:J.x,y:J.y,width:q.width,height:q.height,rotation:K,zIndex:V,content:O.content,properties:O.properties,color:O.color,backgroundColor:O.backgroundColor,hidden:O.hidden,minimized:"notepad"===O.type?O.minimized:void 0,tags:"sticky"===O.type?O.tags:void 0,parentId:O.parentId,isSelected:u,onUpdate:p,deleteElement:h,onSelectElement:v,onEditElement:y,onFormatToggle:x,onChangeNotepadFormat:g,onLocateElement:f,allElements:o,onBringToFront:b,onSendToBack:j,onMoveBackward:w,onGroupElements:N,addElement:C,activatedElementId:z,onActivateDrag:D,onEditComment:S,onDuplicateElement:T,onUngroup:()=>P(O.id),setIsDirty:()=>{},scale:c,offset:d,boardId:I,isListening:M,liveTranscript:Z,finalTranscript:A,interimTranscript:B,..."container"===O.type&&{unanchorElement:m}})]})}),(0,n.jsx)(Q,{isOpen:_,onOpenChange:H,onConfirm:$})]})}function tB(e){return"number"!=typeof e.x||"number"!=typeof e.y||"number"!=typeof e.width||"number"!=typeof e.height?null:{x:e.x+e.width/2,y:e.y+e.height/2}}function tO(e){let{allElements:t,isSelected:a,content:r,scale:s,offset:l,onSelectElement:i,id:o}=e,{fromElementId:c,toElementId:d,label:u,color:p}=r;if(!c||!d||!t)return null;let m=t.find(e=>e.id===c),h=t.find(e=>e.id===d);if(!m||!h)return null;let x=tB(m),g=tB(h);if(!x||!g)return null;let f=x.x*s+((null==l?void 0:l.x)||0),v=x.y*s+((null==l?void 0:l.y)||0),b=g.x*s+((null==l?void 0:l.x)||0),j=g.y*s+((null==l?void 0:l.y)||0);return(0,n.jsxs)("g",{className:(0,k.cn)("connector",{selected:a}),onMouseDown:e=>i(o,e.shiftKey||e.ctrlKey||e.metaKey),children:[(0,n.jsx)("line",{x1:f,y1:v,x2:b,y2:j,stroke:p||"hsl(var(--foreground))",strokeWidth:2,markerEnd:"url(#arrowhead)"}),u&&(0,n.jsx)("text",{x:(f+b)/2,y:(v+j)/2,fill:p||"hsl(var(--foreground))",textAnchor:"middle",dominantBaseline:"middle",fontSize:"12",className:"pointer-events-none",children:u})]})}let t_=(0,s.forwardRef)((e,t)=>{let{elements:a,board:r,selectedElementIds:l,onSelectElement:i,updateElement:o,unanchorElement:c,deleteElement:d,onBringToFront:u,onSendToBack:p,onMoveBackward:m,onFormatToggle:h,onChangeNotepadFormat:x,onLocateElement:g,onGoToHome:f,onCenterView:v,onEditElement:b,onGroupElements:j,addElement:w,saveLastView:y,selectedElement:N,activatedElementId:C,onActivateDrag:E,onEditComment:z,onDuplicateElement:D,onUngroup:S,setIsDirty:T,isMobile:P,isListening:R,liveTranscript:I,finalTranscript:M,interimTranscript:Z}=e,[L,F]=(0,s.useState)(1),[B,O]=(0,s.useState)(null),[_,H]=(0,s.useState)(!1),U=(0,s.useRef)(null),J=(0,s.useRef)(null),q=(0,s.useMemo)(()=>{if(0===a.length)return{width:window.innerWidth+2e3,height:window.innerHeight+2e3};let e=0,t=0;return a.forEach(a=>{let n="number"==typeof a.width?a.width:parseFloat(a.width||"0"),r="number"==typeof a.height?a.height:parseFloat(a.height||"0");isFinite(n)&&isFinite(r)&&(e=Math.max(e,a.x+n),t=Math.max(t,a.y+r))}),{width:Math.max(e+2e3,window.innerWidth),height:Math.max(t+2e3,window.innerHeight)}},[a]),K=(0,s.useRef)(B),V=(0,s.useRef)(y),W=(0,s.useRef)(U.current);(0,s.useEffect)(()=>{K.current=B,V.current=y,W.current=U.current},[B,y]);let G=(0,s.useCallback)(e=>{let t=K.current,a=W.current;if(t&&a&&(e.preventDefault(),t.isPanning)){let n=e.clientX-t.startPoint.x,r=e.clientY-t.startPoint.y;a.scrollLeft=t.initialScroll.x-.7*n,a.scrollTop=t.initialScroll.y-.7*r}},[]),Y=(0,s.useCallback)(()=>{K.current&&V.current(),O(null)},[]);(0,s.useEffect)(()=>(B?(window.addEventListener("mousemove",G),window.addEventListener("mouseup",Y)):(window.removeEventListener("mousemove",G),window.removeEventListener("mouseup",Y)),()=>{window.removeEventListener("mousemove",G),window.removeEventListener("mouseup",Y)}),[B,G,Y]);let Q=(0,s.useCallback)(e=>{e.scrollLeft=0,e.scrollTop=0,(0!==e.scrollLeft||0!==e.scrollTop)&&e.scrollTo(0,0)},[]),X=(0,s.useCallback)(()=>{let e=U.current;e&&(F(P?.3:1),requestAnimationFrame(()=>{e&&Q(e)}))},[P,Q]);(0,s.useEffect)(()=>{let e=U.current;if(!e)return;F(P?.3:1),Q(e),requestAnimationFrame(()=>{e&&Q(e)});let t=setTimeout(()=>{e&&(0!==e.scrollLeft||0!==e.scrollTop)&&(console.warn("⚠️ Scroll no est\xe1 en (0,0), forzando correcci\xf3n..."),Q(e))},100),a=setTimeout(()=>{e&&(0!==e.scrollLeft||0!==e.scrollTop)&&(console.warn("⚠️ Scroll a\xfan no est\xe1 en (0,0) despu\xe9s de 500ms, forzando correcci\xf3n final..."),Q(e))},500);return()=>{clearTimeout(t),clearTimeout(a)}},[r.id,P,Q]);let $=(0,s.useCallback)(()=>{if(!U.current)return{x:window.innerWidth/2,y:window.innerHeight/2};let{scrollLeft:e,scrollTop:t,clientWidth:a,clientHeight:n}=U.current,r=(e+a/2)/L,s=(t+n/2)/L;return{x:Math.max(a/(2*L),r),y:Math.max(n/(2*L),s)}},[L]),ee=(0,s.useCallback)((e,t)=>{let a=U.current;if(!a)return;e=Math.max(.1,Math.min(e,5));let{clientWidth:n,clientHeight:r,scrollLeft:s,scrollTop:l}=a,i=t||{x:n/2,y:r/2},o=s+i.x,c=l+i.y,d=o*e/L-i.x,u=c*e/L-i.y;F(e),requestAnimationFrame(()=>{a.scrollLeft=d,a.scrollTop=u})},[L]),et=(0,s.useCallback)((e,t)=>{let a=U.current;if(!a)return;let n=t?Math.max(.1,Math.min(t,5)):L,{clientWidth:r,clientHeight:s}=a,l=e.x*n-r/2,i=e.y*n-s/2;t&&F(n),requestAnimationFrame(()=>{a.scrollTo({left:l,top:i,behavior:"smooth"})})},[L]),ea=(0,s.useCallback)(function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;if(!e)return;let a="number"==typeof e.width?e.width:parseFloat(e.width||"0"),n="number"==typeof e.height?e.height:parseFloat(e.height||"0");et({x:e.x+a/2,y:e.y+n/2},t)},[et]),en=(0,s.useCallback)(e=>{if(!a||0===a.length){X();return}let t=1/0,n=1/0,r=-1/0,s=-1/0;a.forEach(e=>{let a="number"==typeof e.width?e.width:parseFloat(e.width||"0"),l="number"==typeof e.height?e.height:parseFloat(e.height||"0");t=Math.min(t,e.x),n=Math.min(n,e.y),r=Math.max(r,e.x+a),s=Math.max(s,e.y+l)});let l=r-t,i=s-n;if(0===l||0===i){et({x:t,y:n},1);return}U.current&&et({x:t+l/2,y:n+i/2},e?.3:.4)},[a,X,et]),er=()=>ee(1);(0,s.useImperativeHandle)(t,()=>({getCanvasContainer:()=>U.current,getCanvasContent:()=>J.current,getTransform:()=>{var e,t;return{scale:L,x:(null===(e=U.current)||void 0===e?void 0:e.scrollLeft)||0,y:(null===(t=U.current)||void 0===t?void 0:t.scrollTop)||0}},getViewportCenter:$,centerOnElement:ea,centerOnPoint:et,centerOnElements:en,resetZoom:er,goToHome:X,activatePanMode:()=>(H(e=>!e),_)}),[_]),(0,s.useEffect)(()=>{let e=U.current;if(!e)return;let t=t=>{t.ctrlKey||t.metaKey?(t.preventDefault(),ee(L+(t.deltaY>0?-.1:.1),{x:t.clientX,y:t.clientY})):t.altKey&&(t.preventDefault(),e.scrollLeft-=t.deltaX,e.scrollTop-=t.deltaY)},a=t=>{1===t.button&&(t.preventDefault(),O({isPanning:!0,startPoint:{x:t.clientX,y:t.clientY},initialScroll:{x:e.scrollLeft,y:e.scrollTop}}))},n=e=>{var t,a,n;"Space"!==e.code||e.repeat||(null===(t=document.activeElement)||void 0===t?void 0:t.tagName)==="INPUT"||(null===(a=document.activeElement)||void 0===a?void 0:a.tagName)==="TEXTAREA"||(null===(n=document.activeElement)||void 0===n?void 0:n.isContentEditable)||(e.preventDefault(),H(!0))},r=e=>{"Space"===e.code&&(e.preventDefault(),H(!1))};return e.addEventListener("wheel",t,{passive:!1}),e.addEventListener("mousedown",a),window.addEventListener("keydown",n),window.addEventListener("keyup",r),()=>{e.removeEventListener("wheel",t),e.removeEventListener("mousedown",a),window.removeEventListener("keydown",n),window.removeEventListener("keyup",r)}},[L,ee]);let es=(0,s.useMemo)(()=>a.filter(e=>"connector"!==e.type),[a]),el=(0,s.useMemo)(()=>a.filter(e=>"connector"===e.type),[a]),ei=(0,s.useMemo)(()=>a,[a]),eo=(0,s.useRef)({x:0,y:0}),[ec,ed]=(0,s.useState)({x:0,y:0}),eu=(0,s.useRef)(null);return(0,s.useEffect)(()=>{let e=U.current;if(!e)return;let t=()=>{eu.current&&clearTimeout(eu.current),eu.current=setTimeout(()=>{let t={x:e.scrollLeft||0,y:e.scrollTop||0},a=Math.abs(t.x-eo.current.x),n=Math.abs(t.y-eo.current.y);(a>10||n>10)&&(eo.current=t,ed(t))},50)};return e.addEventListener("scroll",t,{passive:!0}),()=>{e.removeEventListener("scroll",t),eu.current&&clearTimeout(eu.current)}},[]),(0,n.jsxs)("div",{className:"relative w-full h-screen",children:[(0,n.jsx)("div",{ref:U,className:(0,k.cn)("relative w-full h-screen overflow-auto bg-canvas-teal",_&&"cursor-grab",(null==B?void 0:B.isPanning)&&"cursor-grabbing"),style:{backgroundColor:"#96e4e6",backgroundImage:"radial-gradient(#ffffff 1px, transparent 0)",backgroundSize:"".concat(20*L,"px ").concat(20*L,"px")},onMouseDown:e=>{if((1===e.button||0===e.button&&e.altKey)&&U.current){e.preventDefault(),O({isPanning:!0,startPoint:{x:e.clientX,y:e.clientY},initialScroll:{x:U.current.scrollLeft,y:U.current.scrollTop}});return}if(0===e.button){let t=e.target;(t===J.current||t===U.current)&&i(null,!1)}_&&U.current&&0===e.button&&(e.preventDefault(),O({isPanning:!0,startPoint:{x:e.clientX,y:e.clientY},initialScroll:{x:U.current.scrollLeft,y:U.current.scrollTop}}))},children:(0,n.jsxs)("div",{ref:J,className:"relative canvas-content",style:{width:"".concat(q.width,"px"),height:"".concat(q.height,"px"),transform:"scale(".concat(L,")"),transformOrigin:"top left"},children:[(0,n.jsxs)("svg",{className:"absolute top-0 left-0 w-full h-full pointer-events-none",style:{width:q.width,height:q.height},children:[(0,n.jsx)("defs",{children:(0,n.jsx)("marker",{id:"arrowhead",markerWidth:"10",markerHeight:"7",refX:"0",refY:"3.5",orient:"auto",children:(0,n.jsx)("polygon",{points:"0 0, 10 3.5, 0 7",fill:"hsl(var(--foreground))"})})}),el.map(e=>(0,n.jsx)(tO,{...e,scale:L,offset:ec,allElements:ei,onUpdate:o,deleteElement:d,onSelectElement:i,onEditElement:b,onLocateElement:g,onEditComment:z},e.id))]}),es.filter(e=>!e.hidden).map(e=>{let t=null==l?void 0:l.includes(e.id);return(0,n.jsx)(tF,{element:e,allElements:ei,scale:L,offset:ec,isSelected:t,updateElement:o,unanchorElement:c,deleteElement:d,onFormatToggle:h,onChangeNotepadFormat:x,onLocateElement:g,onSelectElement:i,onBringToFront:u,onSendToBack:p,onMoveBackward:m,onEditElement:b,onGroupElements:j,addElement:w,activatedElementId:C,onActivateDrag:E,onEditComment:z,onDuplicateElement:D,onUngroup:S,setIsDirty:T,boardId:r.id,isListening:R,liveTranscript:I,finalTranscript:M,interimTranscript:Z},e.id)})]})}),(0,n.jsx)(A,{zoomIn:()=>ee(L+.1),zoomOut:()=>ee(L-.1),resetZoom:er,scale:L,centerOnElements:en,goToHome:X,selectedElement:N,onBringToFront:u,onSendToBack:p,onMoveBackward:m,isMobile:P})]})});t_.displayName="Canvas";var tH=a(1786),tU=a(65773),tJ=a(9172),tq=a(17290),tK=a(80121),tV=a(24739),tW=a(81475),tG=a(66904),tY=a(44890),tQ=a(39702),tX=a(32065),t$=a(9521),t0=a(34742),t1=a(3683),t2=a(86622),t4=a(71488),t5=a(58856);let t3=function(){let e={};return{on(t,a){var n;e[t]||(e[t]=[]),null===(n=e[t])||void 0===n||n.push(a)},off(t,a){var n;e[t]&&(e[t]=null===(n=e[t])||void 0===n?void 0:n.filter(e=>e!==a))},emit(t,a){var n;e[t]&&(null===(n=e[t])||void 0===n||n.forEach(e=>e(a)))}}}();class t8 extends Error{withUser(e){return new t8(this.context,e)}constructor(e,t=null){super("Firestore Permission Denied: The following request was denied by Firestore Security Rules:\n".concat(JSON.stringify({auth:t?function(e){var t;let a=e.providerData||[];return{uid:e.uid,token:{name:e.displayName,picture:e.photoURL,email:e.email,email_verified:e.emailVerified,phone_number:e.phoneNumber,firebase:{identities:a.reduce((e,t)=>(t.providerId&&(e[t.providerId]=[t.uid]),e),{}),sign_in_provider:e.isAnonymous?"anonymous":(null===(t=a[0])||void 0===t?void 0:t.providerId)||"custom"}}}}(t):null,method:e.operation,path:"/databases/(default)/documents/".concat(e.path),request:e.requestResourceData?{data:e.requestResourceData}:void 0},null,2))),this.name="FirestorePermissionError",this.context=e,this.user=t,Object.setPrototypeOf(this,t8.prototype)}}function t6(e){let{isOpen:t,onOpenChange:a}=e,[l,c]=(0,s.useState)(""),[u,p]=(0,s.useState)(!1),m=(0,o.hi)(),{user:h}=(0,i.E)();(0,r.useRouter)();let{toast:x}=(0,f.pm)(),g=async()=>{if(!m||!h||!l.trim()){x({variant:"destructive",title:"Error",description:"El nombre del tablero no puede estar vac\xedo."});return}p(!0);let e=(0,d.hJ)(m,"users",h.uid,"canvasBoards"),t={name:l,userId:h.uid,createdAt:(0,d.serverTimestamp)(),updatedAt:(0,d.serverTimestamp)()};try{await (0,d.ET)(e,t),x({title:"Tablero Creado",description:'Se ha creado el tablero "'.concat(l,'".')}),a(!1),c("")}catch(a){console.error("Error creating new board:",a),h&&t3.emit("permission-error",new t8({path:e.path,operation:"create",requestResourceData:t},h))}finally{p(!1)}};return(0,n.jsx)(eL.Vq,{open:t,onOpenChange:a,children:(0,n.jsxs)(eL.cZ,{children:[(0,n.jsxs)(eL.fK,{children:[(0,n.jsx)(eL.$N,{children:"Crear Nuevo Tablero"}),(0,n.jsx)(eL.Be,{children:"Dale un nombre a tu nuevo lienzo de ideas."})]}),(0,n.jsx)("div",{className:"grid gap-4 py-4",children:(0,n.jsxs)("div",{className:"grid grid-cols-4 items-center gap-4",children:[(0,n.jsx)(eO._,{htmlFor:"boardName",className:"text-right",children:"Nombre"}),(0,n.jsx)(tt.I,{id:"boardName",name:"boardName",value:l,onChange:e=>c(e.target.value),className:"col-span-3",placeholder:"Ej: Ideas para mi proyecto",onKeyDown:e=>"Enter"===e.key&&g()})]})}),(0,n.jsxs)(eL.cN,{children:[(0,n.jsx)(E.z,{variant:"ghost",onClick:()=>a(!1),children:"Cancelar"}),(0,n.jsx)(E.z,{onClick:g,disabled:!l.trim()||u,children:u?"Creando...":"Crear Tablero"})]})]})})}let t7=s.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,n.jsx)("textarea",{className:(0,k.cn)("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",a),ref:t,...r})});t7.displayName="Textarea";var t9=a(93835);let ae={mejorar:{icon:t2.Z,label:"Mejorar",prompt:"Reescribe de manera m\xe1s clara y profesional:"},resumir:{icon:eV.Z,label:"Resumir",prompt:"Resume en 3-5 frases:"},expandir:{icon:tG.Z,label:"Expandir",prompt:"Desarrolla con m\xe1s detalles:"},estructurar:{icon:t9.Z,label:"Estructurar",prompt:"Organiza en secciones claras:"},brainstorm:{icon:eW.Z,label:"Ideas",prompt:"Genera 5 ideas relacionadas:"},checklist:{icon:eG.Z,label:"Checklist",prompt:"Convierte en lista de tareas:"}};function at(e){let{initialContent:t,onSave:a}=e,{toast:r}=(0,f.pm)(),[l,i]=(0,s.useState)(t),[o,c]=(0,s.useState)(""),[d,u]=(0,s.useState)(!1),p=async e=>{if(!l.trim())return;u(!0),await new Promise(e=>setTimeout(e,1e3));let t="";switch(e){case"mejorar":t=l.replace(/(^\w|\.\s*\w)/g,e=>e.toUpperCase());break;case"resumir":t=l.split(/[.!?]+/).slice(0,3).join(". ")+".";break;case"expandir":t=l+"\n\n[Desarrollo adicional simulado]";break;case"estructurar":t="# "+l.split("\n")[0]+"\n\n## Detalles\n\n"+l;break;case"brainstorm":t="1. Idea relacionada 1\n2. Idea relacionada 2\n3. Idea relacionada 3";break;case"checklist":t=l.split("\n").map(e=>"☐ "+e).join("\n")}c(t),u(!1)},m=async()=>{await navigator.clipboard.writeText(o),r({title:"Copiado",description:"Texto copiado al portapapeles."})};return(0,n.jsxs)(eU,{defaultValue:"editar",className:"h-full",children:[(0,n.jsxs)(eJ,{className:"grid w-full grid-cols-2",children:[(0,n.jsx)(eq,{value:"editar",children:"Editar"}),(0,n.jsx)(eq,{value:"resultado",children:"Resultado"})]}),(0,n.jsxs)(eK,{value:"editar",className:"space-y-4 mt-4",children:[(0,n.jsx)(t7,{value:l,onChange:e=>i(e.target.value),placeholder:"Pega o escribe tu texto aqu\xed...",className:"min-h-[200px]"}),(0,n.jsx)("div",{className:"grid grid-cols-3 gap-2",children:Object.entries(ae).map(e=>{let[t,a]=e,r=a.icon;return(0,n.jsxs)(E.z,{variant:"outline",onClick:()=>p(t),disabled:d,className:"flex items-center gap-2",children:[(0,n.jsx)(r,{className:"w-4 h-4"}),a.label]},t)})}),d&&(0,n.jsx)("div",{className:"text-center py-4",children:"Procesando..."})]}),(0,n.jsxs)(eK,{value:"resultado",className:"space-y-4 mt-4",children:[(0,n.jsx)(t7,{value:o,readOnly:!0,className:"min-h-[200px]"}),(0,n.jsxs)("div",{className:"flex gap-2",children:[(0,n.jsx)(E.z,{onClick:()=>a(o),className:"flex-1",children:"Aplicar Cambios"}),(0,n.jsxs)(E.z,{variant:"outline",onClick:m,children:[(0,n.jsx)(tn.Z,{className:"w-4 h-4 mr-2"}),"Copiar"]})]})]})]})}let aa={work:{bg:"#e3f2fd",border:"#1976d2",name:"Trabajo"},personal:{bg:"#f3e5f5",border:"#7b1fa2",name:"Personal"},urgent:{bg:"#ffebee",border:"#d32f2f",name:"Urgente"},idea:{bg:"#e8f5e8",border:"#388e3c",name:"Ideas"},meeting:{bg:"#fff3e0",border:"#f57c00",name:"Reuniones"},creative:{bg:"#fce4ec",border:"#c2185b",name:"Creativo"}},an=(0,a(90535).j)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function ar(e){let{className:t,variant:a,...r}=e;return(0,n.jsx)("div",{className:(0,k.cn)(an({variant:a}),t),...r})}let as=[{name:"yellow",hex:"#fef08a"},{name:"pink",hex:"#fda4af"},{name:"blue",hex:"#93c5fd"},{name:"green",hex:"#86efac"},{name:"orange",hex:"#fdba74"},{name:"purple",hex:"#d8b4fe"}],al=e=>{let{icon:t,label:a,onClick:r,isActive:s,isRecording:l,hasDropdown:i,disabled:o,className:c}=e;return(0,n.jsxs)(t4.u,{children:[(0,n.jsx)(t4.aJ,{asChild:!0,children:(0,n.jsxs)("button",{onClick:r,disabled:o,className:(0,k.cn)("relative w-9 h-9 flex items-center justify-center rounded-none transition-all duration-150","hover:bg-white/10 active:scale-95",s&&"bg-white/20 shadow-inner",l&&"bg-red-500 animate-pulse",o&&"opacity-40 cursor-not-allowed",c),children:[(0,n.jsx)(t,{className:(0,k.cn)("w-[18px] h-[18px]",l?"text-white":"text-white/90"),strokeWidth:1.5}),i&&(0,n.jsx)(R.Z,{className:"absolute bottom-0.5 right-0.5 w-2 h-2 text-white/60"})]})}),(0,n.jsx)(t4._v,{side:"right",className:"text-xs",children:a})]})},ai=()=>(0,n.jsx)("div",{className:"w-full h-px bg-white/20 my-1"});function ao(e){let{elements:t,boards:a,onUploadImage:l,onAddImageFromUrl:i,onPanToggle:o,isListening:c=!1,onToggleDictation:d,onDeleteBoard:u,onOpenNotepad:p,onLocateElement:m,addElement:h,clearCanvas:x,onExportBoardToPng:g,onFormatToggle:v,isFormatToolbarOpen:b,isPanningActive:j,onAddComment:w,onOpenGlobalSearch:y}=e,{toast:N}=(0,f.pm)(),C=(0,r.useRouter)(),[z,D]=(0,s.useState)(!1),[S,T]=(0,s.useState)({x:16,y:80}),[P,R]=(0,s.useState)("select"),[I,M]=(0,s.useState)(!1),[Z,A]=(0,s.useState)(!1),[B,H]=(0,s.useState)(!1),[U,Q]=(0,s.useState)(!1),[X,$]=(0,s.useState)("");(0,s.useEffect)(()=>{try{let e=localStorage.getItem("toolbarV2Pos");e&&T(JSON.parse(e))}catch(e){}},[]);let ee=(e,t)=>{T({x:e,y:t}),localStorage.setItem("toolbarV2Pos",JSON.stringify({x:e,y:t}))},et=(0,s.useMemo)(()=>t.filter(e=>["notepad","notepad-simple","yellow-notepad","tabbed-notepad"].includes(e.type)),[t]),ea=(0,s.useMemo)(()=>et.filter(e=>e.hidden),[et]),en=(0,s.useMemo)(()=>t.filter(e=>{if("comment"!==e.type)return!1;let t=e.content;return t&&(t.title||t.label||t.text)}),[t]),el=async(e,t)=>{try{await h(e,t),N({title:"✓ Creado"})}catch(e){N({variant:"destructive",title:"Error",description:e.message})}},ei=async()=>{auth&&(await (0,t5.w7)(),C.push("/"))},eo=async e=>{let t=window.innerWidth/2,a=window.innerHeight/2;switch(e){case"meeting":await eu(t,a);break;case"project":await ep(t,a);break;case"tasks":await em(t,a);break;case"brainstorm":await eh(t,a)}M(!1),N({title:"Plantilla aplicada",description:"Los elementos se han creado exitosamente."})},ec=async e=>{N({title:"Tema aplicado",description:"Tema aplicado."})},ed=()=>{X.trim()&&($(""),N({title:"Etiqueta agregada",description:'Etiqueta "'.concat(X,'" agregada.')}))},eu=async(e,t)=>{await h("text",{content:'<div style="font-size: 24px; font-weight: bold;">Reuni\xf3n de Equipo</div>',properties:{position:{x:e-200,y:t-150},size:{width:400,height:60}}}),await h("notepad-simple",{content:{title:"Agenda",text:"<div>• Punto 1<br>• Punto 2<br>• Punto 3</div>"},properties:{position:{x:e-250,y:t-50}}}),await h("todo",{content:{title:"Acciones Pendientes",items:[]},properties:{position:{x:e+50,y:t-50}}})},ep=async(e,t)=>{await h("text",{content:'<div style="font-size: 20px; font-weight: bold;">Nuevo Proyecto</div>',properties:{position:{x:e-150,y:t-200}}}),await h("sticky",{content:"OBJETIVOS",color:"green",properties:{position:{x:e-200,y:t-100}}}),await h("sticky",{content:"CRONOGRAMA",color:"blue",properties:{position:{x:e,y:t-100}}}),await h("sticky",{content:"RECURSOS",color:"yellow",properties:{position:{x:e+100,y:t-100}}})},em=async(e,t)=>{await h("todo",{content:{title:"Mis Tareas",items:[]},properties:{position:{x:e-150,y:t-100}}})},eh=async(e,t)=>{let a=["yellow","pink","blue","green"];for(let n=0;n<6;n++)await h("sticky",{content:"Idea ".concat(n+1),color:a[n%a.length],properties:{position:{x:e+(n%3-1)*120,y:t+(Math.floor(n/3)-1)*120}}})},eg=e=>{var t,a,n;return"notepad"===e.type||"notepad-simple"===e.type?(null===(a=e.content)||void 0===a?void 0:a.title)||"Cuaderno":"sticky"===e.type?(null===(n=e.content)||void 0===n?void 0:n.substring(0,20))||"Nota":"".concat(e.type," ").concat(null===(t=e.id)||void 0===t?void 0:t.substring(0,4))},ef=e=>{let t=new Date,a=Math.ceil((new Date(e).getTime()-t.getTime())/864e5);return a<0||a<=1?"destructive":a<=3?"default":"secondary"},ev=e=>{let t=new Date,a=Math.ceil((new Date(e).getTime()-t.getTime())/864e5);return a<0?"Vencido":0===a?"Hoy":1===a?"Ma\xf1ana":"En ".concat(a," d\xedas")};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(t6,{isOpen:z,onOpenChange:D}),(0,n.jsx)(F.s,{position:S,size:{width:52,height:"auto"},bounds:"window",dragHandleClassName:"toolbar-drag",onDragStop:(e,t)=>ee(t.x,t.y),enableResizing:!1,className:"z-[10001]",children:(0,n.jsxs)("div",{className:"flex flex-col items-center py-2 px-1.5 rounded-xl bg-[#2d2d2d] shadow-2xl border border-white/10",children:[(0,n.jsx)("div",{className:"toolbar-drag cursor-grab active:cursor-grabbing w-full flex justify-center py-1 mb-1 hover:bg-white/5 rounded",children:(0,n.jsx)(es.Z,{className:"w-4 h-4 text-white/40"})}),(0,n.jsx)(al,{icon:tH.Z,label:"Seleccionar (V)",isActive:"select"===P,onClick:()=>R("select")}),(0,n.jsx)(al,{icon:tU.Z,label:"Mover lienzo (H)",isActive:j||"pan"===P,onClick:()=>{R("pan"),o()}}),(0,n.jsx)(ai,{}),(0,n.jsxs)(e4,{children:[(0,n.jsx)(e5,{asChild:!0,children:(0,n.jsx)("div",{children:(0,n.jsx)(al,{icon:tJ.Z,label:"Nota adhesiva",hasDropdown:!0})})}),(0,n.jsx)(e3,{side:"right",className:"w-auto p-2 bg-[#3d3d3d] border-white/10",children:(0,n.jsx)("div",{className:"grid grid-cols-3 gap-1.5",children:as.map(e=>(0,n.jsx)("button",{onClick:()=>el("sticky",{color:e.name}),className:"w-8 h-8 rounded shadow-sm hover:scale-110 transition-transform border border-black/20",style:{backgroundColor:e.hex}},e.name))})})]}),(0,n.jsxs)(e4,{children:[(0,n.jsx)(e5,{asChild:!0,children:(0,n.jsx)("div",{children:(0,n.jsx)(al,{icon:tq.Z,label:"Texto",hasDropdown:!0})})}),(0,n.jsx)(e3,{side:"right",className:"w-auto p-2 bg-[#3d3d3d] border-white/10",children:(0,n.jsx)("div",{className:"grid grid-cols-4 gap-1.5",children:["#ffffff","#fef08a","#fda4af","#93c5fd","#86efac","#fdba74","#d8b4fe","transparent"].map(e=>(0,n.jsx)("button",{onClick:()=>el("text",{properties:{backgroundColor:e}}),className:(0,k.cn)("w-7 h-7 rounded hover:scale-110 transition-transform","transparent"===e?"border-2 border-dashed border-white/30":"border border-black/20 shadow-sm"),style:{backgroundColor:"transparent"===e?"transparent":e}},e))})})]}),(0,n.jsxs)(ew,{children:[(0,n.jsx)(ey,{asChild:!0,children:(0,n.jsx)("div",{children:(0,n.jsx)(al,{icon:eV.Z,label:"Cuaderno",hasDropdown:!0})})}),(0,n.jsxs)(eE,{side:"right",className:"bg-[#3d3d3d] border-white/10 text-white",children:[(0,n.jsxs)(ez,{onClick:()=>el("notepad"),className:"hover:bg-white/10",children:[(0,n.jsx)(er.Z,{className:"mr-2 h-4 w-4"})," Cuaderno cl\xe1sico"]}),(0,n.jsxs)(ez,{onClick:()=>el("yellow-notepad"),className:"hover:bg-white/10",children:[(0,n.jsx)(er.Z,{className:"mr-2 h-4 w-4"})," Bloc amarillo"]}),(0,n.jsxs)(ez,{onClick:()=>el("tabbed-notepad"),className:"hover:bg-white/10",children:[(0,n.jsx)(er.Z,{className:"mr-2 h-4 w-4"})," Con pesta\xf1as"]}),ea.length>0&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(eD,{className:"bg-white/10"}),(0,n.jsxs)(eN,{children:[(0,n.jsxs)(eC,{className:"hover:bg-white/10",children:[(0,n.jsx)(tK.Z,{className:"mr-2 h-4 w-4"})," Cerrados (",ea.length,")"]}),(0,n.jsx)(ek,{className:"bg-[#3d3d3d] border-white/10 text-white",children:ea.map(e=>{var t;return(0,n.jsx)(ez,{onClick:()=>p(e.id),className:"hover:bg-white/10",children:(null===(t=e.content)||void 0===t?void 0:t.title)||"Sin t\xedtulo"},e.id)})})]})]})]})]}),(0,n.jsxs)(ew,{children:[(0,n.jsx)(ey,{asChild:!0,children:(0,n.jsx)("div",{children:(0,n.jsx)(al,{icon:tj.Z,label:"Imagen",hasDropdown:!0})})}),(0,n.jsxs)(eE,{side:"right",className:"bg-[#3d3d3d] border-white/10 text-white",children:[(0,n.jsx)(ez,{onClick:l,className:"hover:bg-white/10",children:"Subir archivo"}),(0,n.jsx)(ez,{onClick:i,className:"hover:bg-white/10",children:"Desde URL"}),(0,n.jsx)(eD,{className:"bg-white/10"}),(0,n.jsx)(ez,{onClick:()=>el("moodboard"),className:"hover:bg-white/10",children:"Moodboard"})]})]}),(0,n.jsx)(al,{icon:eG.Z,label:"Lista de tareas",onClick:()=>el("todo")}),(0,n.jsx)(ai,{}),(0,n.jsx)(al,{icon:tV.Z,label:"Cron\xf3metro",onClick:()=>el("stopwatch")}),(0,n.jsx)(al,{icon:tW.Z,label:"Temporizador",onClick:()=>el("countdown")}),(0,n.jsx)(al,{icon:tG.Z,label:"Destacar",onClick:()=>el("highlight-text")}),(0,n.jsxs)(ew,{children:[(0,n.jsx)(ey,{asChild:!0,children:(0,n.jsx)("div",{children:(0,n.jsx)(al,{icon:tg.Z,label:"Etiqueta / Quitar",hasDropdown:!0})})}),(0,n.jsx)(eE,{side:"right",className:"w-56 bg-[#3d3d3d] border-white/10 text-white",children:en.length>0?(0,n.jsx)("div",{className:"max-h-48 overflow-y-auto",children:en.map(e=>{let t=e.content;return(0,n.jsxs)(ez,{onClick:()=>m(e.id),className:"hover:bg-white/10",children:[(0,n.jsx)(tg.Z,{className:"mr-2 h-4 w-4 text-cyan-400"}),(0,n.jsx)("span",{className:"truncate",children:(null==t?void 0:t.label)||(null==t?void 0:t.title)||"Sin nombre"})]},e.id)})}):(0,n.jsx)("div",{className:"px-3 py-4 text-center text-sm text-white/50",children:"Sin marcadores"})})]}),(0,n.jsx)(ai,{}),(0,n.jsx)(al,{icon:c?tY.Z:tQ.Z,label:c?"Detener dictado":"Dictar",onClick:d,isRecording:c}),(0,n.jsx)(al,{icon:tX.Z,label:"Panel de formato",onClick:v,isActive:b}),(0,n.jsx)(ai,{}),(0,n.jsxs)(ew,{children:[(0,n.jsx)(ey,{asChild:!0,children:(0,n.jsx)("div",{children:(0,n.jsx)(al,{icon:t$.Z,label:"Tableros",hasDropdown:!0})})}),(0,n.jsxs)(eE,{side:"right",className:"bg-[#3d3d3d] border-white/10 text-white",children:[(0,n.jsxs)(ez,{onClick:()=>D(!0),className:"hover:bg-white/10",children:[(0,n.jsx)(er.Z,{className:"mr-2 h-4 w-4"})," Nuevo tablero"]}),a.length>0&&(0,n.jsxs)(eN,{children:[(0,n.jsxs)(eC,{className:"hover:bg-white/10",children:[(0,n.jsx)(t0.Z,{className:"mr-2 h-4 w-4"})," Abrir"]}),(0,n.jsx)(ek,{className:"bg-[#3d3d3d] border-white/10 text-white",children:a.map(e=>(0,n.jsx)(ez,{onClick:()=>C.push("/board/".concat(e.id)),className:"hover:bg-white/10",children:e.name||"Sin nombre"},e.id))})]}),(0,n.jsx)(eD,{className:"bg-white/10"}),(0,n.jsxs)(ez,{onClick:u,className:"text-red-400 hover:bg-white/10",children:[(0,n.jsx)(L.Z,{className:"mr-2 h-4 w-4"})," Eliminar"]})]})]}),(0,n.jsxs)(ew,{children:[(0,n.jsx)(ey,{asChild:!0,children:(0,n.jsx)("div",{children:(0,n.jsx)(al,{icon:ex.Z,label:"Opciones",hasDropdown:!0})})}),(0,n.jsxs)(eE,{side:"right",className:"bg-[#3d3d3d] border-white/10 text-white",children:[(0,n.jsxs)(O,{children:[(0,n.jsx)(_,{asChild:!0,children:(0,n.jsxs)(ez,{onSelect:e=>e.preventDefault(),className:"hover:bg-white/10",children:[(0,n.jsx)(L.Z,{className:"mr-2 h-4 w-4"})," Limpiar tablero"]})}),(0,n.jsxs)(J,{children:[(0,n.jsxs)(q,{children:[(0,n.jsx)(V,{children:"\xbfLimpiar tablero?"}),(0,n.jsx)(W,{children:"Se eliminar\xe1n todos los elementos. Esta acci\xf3n no se puede deshacer."})]}),(0,n.jsxs)(K,{children:[(0,n.jsx)(Y,{children:"Cancelar"}),(0,n.jsx)(G,{onClick:x,className:"bg-red-500",children:"Limpiar"})]})]})]}),(0,n.jsx)(eD,{className:"bg-white/10"}),(0,n.jsxs)(ez,{onClick:ei,className:"hover:bg-white/10",children:[(0,n.jsx)(t1.Z,{className:"mr-2 h-4 w-4"})," Cerrar sesi\xf3n"]})]})]}),(0,n.jsx)(ai,{}),(0,n.jsx)(al,{icon:t$.Z,label:"Plantillas",onClick:()=>M(!0)}),(0,n.jsx)(al,{icon:ta.Z,label:"Temas",onClick:()=>A(!0)}),(0,n.jsx)(al,{icon:t2.Z,label:"Redactor AI",onClick:()=>H(!0)}),(0,n.jsx)(al,{icon:tI.Z,label:"Recordatorios",onClick:()=>Q(!0)})]})}),(0,n.jsx)(eL.Vq,{open:I,onOpenChange:M,children:(0,n.jsxs)(eL.cZ,{className:"max-w-md",children:[(0,n.jsxs)(eL.fK,{children:[(0,n.jsxs)(eL.$N,{className:"flex items-center gap-2",children:[(0,n.jsx)(t$.Z,{className:"w-5 h-5"}),"Plantillas R\xe1pidas"]}),(0,n.jsx)(eL.Be,{children:"Crea estructuras predefinidas para comenzar r\xe1pidamente"})]}),(0,n.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,n.jsxs)(E.z,{variant:"outline",onClick:()=>eo("meeting"),className:"h-20 flex-col gap-2",children:[(0,n.jsx)(eQ.Z,{className:"w-6 h-6"}),(0,n.jsx)("span",{className:"text-sm",children:"Reuni\xf3n"})]}),(0,n.jsxs)(E.z,{variant:"outline",onClick:()=>eo("project"),className:"h-20 flex-col gap-2",children:[(0,n.jsx)(t0.Z,{className:"w-6 h-6"}),(0,n.jsx)("span",{className:"text-sm",children:"Proyecto"})]}),(0,n.jsxs)(E.z,{variant:"outline",onClick:()=>eo("tasks"),className:"h-20 flex-col gap-2",children:[(0,n.jsx)(eG.Z,{className:"w-6 h-6"}),(0,n.jsx)("span",{className:"text-sm",children:"Tareas"})]}),(0,n.jsxs)(E.z,{variant:"outline",onClick:()=>eo("brainstorm"),className:"h-20 flex-col gap-2",children:[(0,n.jsx)(eW.Z,{className:"w-6 h-6"}),(0,n.jsx)("span",{className:"text-sm",children:"Ideas"})]})]})]})}),(0,n.jsx)(eL.Vq,{open:Z,onOpenChange:A,children:(0,n.jsxs)(eL.cZ,{className:"max-w-md",children:[(0,n.jsxs)(eL.fK,{children:[(0,n.jsxs)(eL.$N,{className:"flex items-center gap-2",children:[(0,n.jsx)(ta.Z,{className:"w-5 h-5"}),"Temas y Etiquetas"]}),(0,n.jsx)(eL.Be,{children:"Aplica colores tem\xe1ticos y organiza con etiquetas"})]}),(0,n.jsxs)("div",{className:"space-y-4",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"text-sm font-medium",children:"Colores Tem\xe1ticos"}),(0,n.jsx)("div",{className:"grid grid-cols-3 gap-2 mt-2",children:Object.entries(aa).map(e=>{let[t,a]=e;return(0,n.jsxs)(E.z,{variant:"outline",size:"sm",onClick:()=>ec(t),className:"flex items-center gap-2",children:[(0,n.jsx)("div",{className:"w-3 h-3 rounded",style:{backgroundColor:a.bg}}),(0,n.jsx)("span",{className:"text-xs",children:a.name})]},t)})})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"text-sm font-medium",children:"Etiquetas"}),(0,n.jsxs)("div",{className:"flex gap-2 mt-2",children:[(0,n.jsx)(tt.I,{placeholder:"Nueva etiqueta...",value:X,onChange:e=>$(e.target.value),onKeyPress:e=>"Enter"===e.key&&ed()}),(0,n.jsx)(E.z,{size:"sm",onClick:ed,children:"Agregar"})]})]})]})]})}),(0,n.jsx)(eL.Vq,{open:B,onOpenChange:H,children:(0,n.jsxs)(eL.cZ,{className:"max-w-4xl max-h-[80vh] overflow-hidden",children:[(0,n.jsxs)(eL.fK,{children:[(0,n.jsxs)(eL.$N,{className:"flex items-center gap-2",children:[(0,n.jsx)(t2.Z,{className:"w-5 h-5"}),"Redactor AI"]}),(0,n.jsx)(eL.Be,{children:"Mejora, resume y estructura tu texto con IA"})]}),(0,n.jsx)(at,{initialContent:"Texto de ejemplo para editar",onSave:e=>{H(!1),N({title:"Texto actualizado",description:"El contenido ha sido procesado y guardado."})}})]})}),(0,n.jsx)(eL.Vq,{open:U,onOpenChange:Q,children:(0,n.jsxs)(eL.cZ,{className:"max-w-md",children:[(0,n.jsxs)(eL.fK,{children:[(0,n.jsxs)(eL.$N,{className:"flex items-center gap-2",children:[(0,n.jsx)(tI.Z,{className:"w-5 h-5"}),"Recordatorios"]}),(0,n.jsx)(eL.Be,{children:"Gestiona fechas l\xedmite y recordatorios visuales"})]}),(0,n.jsxs)("div",{className:"space-y-4",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"text-sm font-medium",children:"Recordatorios Activos"}),(0,n.jsx)("div",{className:"space-y-2 mt-2",children:t.filter(e=>{var t;return null===(t=e.properties)||void 0===t?void 0:t.dueDate}).map(e=>{var t,a;return(0,n.jsxs)("div",{className:"flex items-center justify-between p-2 border rounded",children:[(0,n.jsx)("span",{className:"text-sm truncate",children:eg(e)}),(0,n.jsx)(ar,{variant:ef(null===(t=e.properties)||void 0===t?void 0:t.dueDate),children:ev(null===(a=e.properties)||void 0===a?void 0:a.dueDate)})]},e.id)})})]}),(0,n.jsx)(E.z,{onClick:()=>{let e=prompt("Fecha l\xedmite (YYYY-MM-DD):");e&&N({title:"Recordatorio establecido",description:"Fecha: ".concat(e)})},className:"w-full",children:"Establecer Recordatorio"})]})]})})]})}var ac=a(40769),ad=a(17789),au=a(53622),ap=a(63382),am=a(81952),ah=a(42229),ax=a(32157),ag=a(94594),af=a(38755),av=a(80422),ab=a(77497),aj=e=>{let{isOpen:t,onClose:a,onAddComment:r,onEditComment:l,isMobileSheet:i,elements:o,onLocateElement:c,onPanToggle:d,addElement:u,isPanningActive:p=!1,selectedElement:m}=e,h=(null==m?void 0:m.type)==="comment",[x,g]=(0,s.useState)(null),f=(0,s.useRef)(null),[v,b]=(0,s.useState)("18px"),[j,w]=(0,s.useState)({x:0,y:0}),[y,N]=(0,s.useState)(!1),[C,z]=(0,s.useState)(""),D=(0,s.useRef)(!1);(0,s.useEffect)(()=>{if(!t){D.current=!1;return}if(i||D.current)return;D.current=!0;let e=localStorage.getItem("formattingToolbarPosition");if(e)try{let t=JSON.parse(e);if(t&&"number"==typeof t.x&&"number"==typeof t.y&&!isNaN(t.x)&&!isNaN(t.y)){w(t);return}}catch(e){console.error("Failed to load formatting toolbar position",e)}w({x:Math.max(0,(window.innerWidth-600)/2),y:20})},[t,i]);let S=async()=>{if(u)try{let e=window.innerWidth/2,t=window.innerHeight/2;await u("container",{content:{title:"Lienzo",elementIds:[]},properties:{position:{x:e-200,y:t-255},size:{width:400,height:510},backgroundColor:"white"}})}catch(e){console.error("Error creating lienzo:",e)}},T=(e,t,a)=>{e.preventDefault(),e.stopPropagation();let n=window.getSelection();if(!n||0===n.rangeCount){let e=document.activeElement;e&&(e.isContentEditable||"DIV"===e.tagName)&&(e.focus(),a?document.execCommand(t,!1,a):document.execCommand(t,!1),e.dispatchEvent(new Event("input",{bubbles:!0})));return}a?document.execCommand(t,!1,a):document.execCommand(t,!1);let r=document.activeElement;r&&r.dispatchEvent(new Event("input",{bubbles:!0})),g(null)},P=(e,t)=>{e.preventDefault();let a=window.getSelection();if(!a||0===a.rangeCount||a.isCollapsed)return;let n=a.getRangeAt(0),r=document.createElement("span");r.style.textDecoration="underline",r.style.textDecorationColor=t,r.style.textDecorationThickness="2.5px",r.appendChild(n.extractContents()),n.insertNode(r),g(null)},I=(e,t)=>{e.preventDefault(),e.stopPropagation();let a=window.getSelection();if(!a||0===a.rangeCount){let e=document.activeElement;if(e&&e.isContentEditable){let n=Array.from(e.childNodes);if(1===n.length&&n[0].nodeType===Node.ELEMENT_NODE){let a=n[0];if("SPAN"===a.tagName&&a.style.color){a.style.color=t,e.dispatchEvent(new Event("input",{bubbles:!0})),g(null);return}}let r=document.createElement("span");for(r.style.color=t;e.firstChild;)r.appendChild(e.firstChild);e.appendChild(r);let s=document.createRange();s.selectNodeContents(r),s.collapse(!1),a&&(a.removeAllRanges(),a.addRange(s)),e.dispatchEvent(new Event("input",{bubbles:!0}))}g(null);return}if(a.isCollapsed){let e=a.getRangeAt(0).commonAncestorContainer,n=e.nodeType===Node.TEXT_NODE?e.parentElement:e;if(n&&n.isContentEditable){let e=Array.from(n.childNodes);if(1===e.length&&e[0].nodeType===Node.ELEMENT_NODE){let a=e[0];if("SPAN"===a.tagName&&a.style.color){a.style.color=t,n.dispatchEvent(new Event("input",{bubbles:!0})),g(null);return}}let r=document.createElement("span");for(r.style.color=t;n.firstChild;)r.appendChild(n.firstChild);n.appendChild(r);let s=document.createRange();s.selectNodeContents(r),s.collapse(!1),a.removeAllRanges(),a.addRange(s),n.dispatchEvent(new Event("input",{bubbles:!0}))}g(null);return}let n=a.getRangeAt(0),r=document.createElement("span");r.style.color=t;try{r.appendChild(n.extractContents()),n.insertNode(r),n.setStartAfter(r),n.collapse(!0),a.removeAllRanges(),a.addRange(n);let e=document.activeElement;e&&e.dispatchEvent(new Event("input",{bubbles:!0}))}catch(e){console.error("Error aplicando color:",e)}g(null)};if(!t)return null;let M=(0,k.cn)("bg-black text-white py-1 px-1.5","flex items-center justify-center w-full min-h-[32px] gap-0.5","text-xs"),Z=(0,k.cn)("bg-white border-none rounded px-1.5 py-1","cursor-pointer flex items-center justify-center","min-w-[24px] h-6 transition-colors","hover:bg-gray-100"),A="w-3.5 h-3.5 text-black",L=(0,k.cn)("bg-[#2a2a2a] border-none rounded","cursor-pointer flex items-center justify-center","w-6 h-6 p-1 transition-colors","hover:bg-[#3a3a3a]"),B=(0,n.jsxs)("div",{className:M,children:[h&&m&&l&&(0,n.jsxs)(t4.u,{children:[(0,n.jsx)(t4.aJ,{asChild:!0,children:(0,n.jsx)("button",{className:(0,k.cn)(Z,"bg-teal-500 hover:bg-teal-600"),onClick:e=>{e.preventDefault(),e.stopPropagation(),l(m)},children:(0,n.jsx)(tg.Z,{className:"w-[14px] h-[14px] text-white"})})}),(0,n.jsx)(t4._v,{children:(0,n.jsx)("p",{children:"Editar etiqueta de posici\xf3n"})})]}),(0,n.jsxs)(t4.u,{children:[(0,n.jsx)(t4.aJ,{asChild:!0,children:(0,n.jsxs)(ew,{children:[(0,n.jsx)(ey,{asChild:!0,children:(0,n.jsx)("button",{className:L,onClick:e=>{e.preventDefault(),e.stopPropagation()},children:(0,n.jsx)(em.Z,{className:"w-[14px] h-[14px] text-white"})})}),(0,n.jsx)(eE,{children:(0,n.jsx)(ez,{onClick:e=>{e.preventDefault(),e.stopPropagation()},children:(0,n.jsx)("span",{children:"Opciones"})})})]})}),(0,n.jsx)(t4._v,{children:(0,n.jsx)("p",{children:"M\xe1s opciones"})})]}),(0,n.jsxs)(t4.u,{children:[(0,n.jsx)(t4.aJ,{asChild:!0,children:(0,n.jsx)("button",{className:Z,onClick:e=>{e.preventDefault(),e.stopPropagation(),r()},children:(0,n.jsx)(to.Z,{className:A})})}),(0,n.jsx)(t4._v,{children:(0,n.jsx)("p",{children:"Crear etiqueta / Localizador"})})]}),(0,n.jsxs)(t4.u,{children:[(0,n.jsx)(t4.aJ,{asChild:!0,children:(0,n.jsx)("button",{className:Z,onClick:e=>{e.preventDefault(),e.stopPropagation(),null==u||u("stopwatch")},children:(0,n.jsx)(tV.Z,{className:A})})}),(0,n.jsx)(t4._v,{children:(0,n.jsx)("p",{children:"Agregar cron\xf3metro"})})]}),(0,n.jsxs)(t4.u,{children:[(0,n.jsx)(t4.aJ,{asChild:!0,children:(0,n.jsx)("button",{className:Z,onClick:e=>{e.preventDefault(),e.stopPropagation(),null==u||u("countdown")},children:(0,n.jsx)(tW.Z,{className:A})})}),(0,n.jsx)(t4._v,{children:(0,n.jsx)("p",{children:"Agregar temporizador"})})]}),(0,n.jsxs)(e4,{open:"fontSize"===x,onOpenChange:e=>g(e?"fontSize":null),children:[(0,n.jsxs)(t4.u,{children:[(0,n.jsx)(t4.aJ,{asChild:!0,children:(0,n.jsx)(e5,{asChild:!0,children:(0,n.jsx)("button",{className:Z,onMouseDown:e=>e.preventDefault(),children:(0,n.jsx)(tq.Z,{className:A})})})}),(0,n.jsx)(t4._v,{children:(0,n.jsx)("p",{children:"Tama\xf1o de fuente"})})]}),(0,n.jsx)(e3,{className:"w-auto p-2 bg-white",onMouseDown:e=>e.preventDefault(),children:(0,n.jsx)("div",{className:"space-y-1",children:["12px","14px","16px","18px","20px","24px","32px"].map(e=>(0,n.jsx)("button",{className:"w-full text-left px-2 py-1 text-sm hover:bg-gray-100 rounded",onClick:t=>{t.preventDefault(),t.stopPropagation(),b(e);let a=window.getSelection();if(a&&a.rangeCount>0){let t=a.getRangeAt(0),n=document.createElement("span");n.style.fontSize=e;try{t.surroundContents(n)}catch(e){n.appendChild(t.extractContents()),t.insertNode(n)}let r=document.activeElement;r&&r.dispatchEvent(new Event("input",{bubbles:!0}))}else{let t=document.activeElement;t&&t.isContentEditable&&(t.style.fontSize=e,t.dispatchEvent(new Event("input",{bubbles:!0})))}g(null)},children:e},e))})})]}),(0,n.jsxs)(eL.Vq,{open:y,onOpenChange:N,children:[(0,n.jsxs)(t4.u,{children:[(0,n.jsx)(t4.aJ,{asChild:!0,children:(0,n.jsx)(eL.hg,{asChild:!0,children:(0,n.jsx)("button",{className:Z,onClick:e=>{e.preventDefault(),e.stopPropagation()},children:(0,n.jsx)(th.Z,{className:A})})})}),(0,n.jsx)(t4._v,{children:(0,n.jsx)("p",{children:"Insertar Enlace"})})]}),(0,n.jsxs)(eL.cZ,{className:"sm:max-w-md",children:[(0,n.jsx)(eL.fK,{children:(0,n.jsx)(eL.$N,{children:"Insertar Enlace"})}),(0,n.jsxs)("div",{className:"space-y-4 py-4",children:[(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsx)("label",{htmlFor:"link-url",className:"text-sm font-medium",children:"URL del enlace"}),(0,n.jsx)(tt.I,{id:"link-url",type:"url",placeholder:"https://ejemplo.com",value:C,onChange:e=>z(e.target.value),onKeyDown:e=>{if("Enter"===e.key){e.preventDefault();let t=window.getSelection();if(C.trim()){if(t&&t.rangeCount>0&&!t.isCollapsed){let e=t.getRangeAt(0),a=document.createElement("a");a.href=C.trim(),a.target="_blank",a.rel="noopener noreferrer",a.appendChild(e.extractContents()),e.insertNode(a);let n=document.activeElement;n&&n.dispatchEvent(new Event("input",{bubbles:!0}))}else{let e=document.createElement("a");e.href=C.trim(),e.target="_blank",e.rel="noopener noreferrer",e.textContent=C.trim(),document.execCommand("insertHTML",!1,e.outerHTML);let t=document.activeElement;t&&t.dispatchEvent(new Event("input",{bubbles:!0}))}z(""),N(!1)}}},autoFocus:!0})]}),(0,n.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,n.jsx)(E.z,{variant:"outline",onClick:()=>{z(""),N(!1)},children:"Cancelar"}),(0,n.jsx)(E.z,{onClick:()=>{let e=window.getSelection();if(C.trim()){if(e&&e.rangeCount>0&&!e.isCollapsed){let t=e.getRangeAt(0),a=document.createElement("a");a.href=C.trim(),a.target="_blank",a.rel="noopener noreferrer",a.appendChild(t.extractContents()),t.insertNode(a);let n=document.activeElement;n&&n.dispatchEvent(new Event("input",{bubbles:!0}))}else{let e=document.createElement("a");e.href=C.trim(),e.target="_blank",e.rel="noopener noreferrer",e.textContent=C.trim(),document.execCommand("insertHTML",!1,e.outerHTML);let t=document.activeElement;t&&t.dispatchEvent(new Event("input",{bubbles:!0}))}z(""),N(!1)}},children:"Insertar"})]})]})]})]}),(0,n.jsxs)(e4,{open:"underlineColor"===x,onOpenChange:e=>g(e?"underlineColor":null),children:[(0,n.jsx)(e5,{asChild:!0,children:(0,n.jsx)("button",{className:Z,onMouseDown:e=>e.preventDefault(),title:"Subrayar",children:(0,n.jsx)(ac.Z,{className:A})})}),(0,n.jsx)(e3,{className:"w-auto p-2 bg-white",onMouseDown:e=>e.preventDefault(),children:(0,n.jsx)("div",{className:"grid grid-cols-4 gap-1.5",children:["#14b8a6","#f97316","#84cc16","#eab308","#f59e0b","#3b82f6","#6b9508","#5cc4c0","#e0d40e","#010974","#02d2d0","#95060c","#720abb","#ab6dd6","#f4f647","#016d77"].map((e,t)=>(0,n.jsx)("button",{className:"w-6 h-6 rounded border hover:scale-110",style:{backgroundColor:e},onMouseDown:t=>P(t,e)},t))})})]}),(0,n.jsxs)(e4,{open:"highlight"===x,onOpenChange:e=>{if(e){let e=window.getSelection();e&&e.rangeCount>0&&!e.isCollapsed?f.current=e.getRangeAt(0).cloneRange():f.current=null,g("highlight")}else g(null)},children:[(0,n.jsx)(e5,{asChild:!0,children:(0,n.jsx)("button",{className:Z,onMouseDown:e=>e.preventDefault(),title:"Destacar",children:(0,n.jsx)(ad.Z,{className:A})})}),(0,n.jsx)(e3,{className:"w-auto p-2 bg-white",onMouseDown:e=>e.preventDefault(),children:(0,n.jsx)("div",{className:"grid grid-cols-4 gap-1.5",children:["#fef08a","#fde68a","#fed7aa","#fecaca","#fbcfe8","#e9d5ff","#ddd6fe","#c7d2fe"].map((e,t)=>(0,n.jsx)("button",{className:"w-6 h-6 rounded border hover:scale-110",style:{backgroundColor:e},onMouseDown:t=>{t.preventDefault();let a=window.getSelection();if(f.current&&(null==a||a.removeAllRanges(),null==a||a.addRange(f.current)),a&&a.rangeCount>0&&!a.isCollapsed){let t=a.getRangeAt(0),n=document.createElement("span");n.style.backgroundColor=e;try{n.appendChild(t.extractContents()),t.insertNode(n);let e=document.activeElement;e&&e.dispatchEvent(new Event("input",{bubbles:!0}))}catch(e){console.error(e)}}g(null)}},t))})})]}),(0,n.jsxs)(e4,{open:"textColor"===x,onOpenChange:e=>g(e?"textColor":null),children:[(0,n.jsx)(e5,{asChild:!0,children:(0,n.jsx)("button",{className:Z,onMouseDown:e=>e.preventDefault(),title:"Color de texto",children:(0,n.jsx)(e6.Z,{className:A})})}),(0,n.jsx)(e3,{className:"w-auto p-2 bg-white",onMouseDown:e=>e.preventDefault(),children:(0,n.jsx)("div",{className:"grid grid-cols-4 gap-1.5",children:["#14b8a6","#f97316","#84cc16","#eab308","#f59e0b","#3b82f6","#1f2937","#475569"].map((e,t)=>(0,n.jsx)("button",{className:"w-6 h-6 rounded border hover:scale-110",style:{backgroundColor:e},onMouseDown:t=>I(t,e)},t))})})]}),(0,n.jsx)("div",{className:"w-px h-5 bg-white/30 mx-0.5"}),(0,n.jsxs)(t4.u,{children:[(0,n.jsx)(t4.aJ,{asChild:!0,children:(0,n.jsx)("button",{className:Z,onMouseDown:e=>T(e,"bold"),children:(0,n.jsx)(au.Z,{className:A})})}),(0,n.jsx)(t4._v,{children:(0,n.jsx)("p",{children:"Negrita"})})]}),(0,n.jsxs)(t4.u,{children:[(0,n.jsx)(t4.aJ,{asChild:!0,children:(0,n.jsx)("button",{className:Z,onMouseDown:e=>T(e,"italic"),children:(0,n.jsx)(ap.Z,{className:A})})}),(0,n.jsx)(t4._v,{children:(0,n.jsx)("p",{children:"Cursiva"})})]}),(0,n.jsxs)(t4.u,{children:[(0,n.jsx)(t4.aJ,{asChild:!0,children:(0,n.jsx)("button",{className:Z,onMouseDown:e=>T(e,"strikeThrough"),children:(0,n.jsx)(am.Z,{className:A})})}),(0,n.jsx)(t4._v,{children:(0,n.jsx)("p",{children:"Tachado"})})]}),(0,n.jsx)("div",{className:"w-px h-5 bg-white/30 mx-0.5"}),(0,n.jsxs)(t4.u,{children:[(0,n.jsx)(t4.aJ,{asChild:!0,children:(0,n.jsxs)(ew,{children:[(0,n.jsx)(ey,{asChild:!0,children:(0,n.jsxs)("button",{className:(0,k.cn)(Z,"!px-1 !min-w-0"),children:[(0,n.jsx)(ah.Z,{className:A}),(0,n.jsx)(R.Z,{className:"h-2.5 w-2.5"})]})}),(0,n.jsxs)(eE,{children:[(0,n.jsxs)(ez,{onMouseDown:e=>{e.preventDefault(),e.stopPropagation(),T(e,"justifyLeft")},children:[(0,n.jsx)(ah.Z,{className:"h-4 w-4 mr-2"}),"Alinear Izquierda"]}),(0,n.jsxs)(ez,{onMouseDown:e=>{e.preventDefault(),e.stopPropagation(),T(e,"justifyCenter")},children:[(0,n.jsx)(ax.Z,{className:"h-4 w-4 mr-2"}),"Centrar"]}),(0,n.jsxs)(ez,{onMouseDown:e=>{e.preventDefault(),e.stopPropagation(),T(e,"justifyRight")},children:[(0,n.jsx)(ag.Z,{className:"h-4 w-4 mr-2"}),"Alinear Derecha"]}),(0,n.jsxs)(ez,{onMouseDown:e=>{e.preventDefault(),e.stopPropagation(),T(e,"justifyFull")},children:[(0,n.jsx)(af.Z,{className:"h-4 w-4 mr-2"}),"Justificar"]})]})]})}),(0,n.jsx)(t4._v,{children:(0,n.jsx)("p",{children:"Alinear Texto"})})]}),(0,n.jsx)("div",{className:"w-px h-5 bg-white/30 mx-0.5"}),(0,n.jsxs)(t4.u,{children:[(0,n.jsx)(t4.aJ,{asChild:!0,children:(0,n.jsx)("button",{className:Z,onMouseDown:e=>{e.preventDefault(),e.stopPropagation();let t=document.createElement("span");t.style.color="#a0a1a6",t.textContent="-- ".concat((0,eS.WU)(new Date,"dd/MM/yy")," "),document.execCommand("insertHTML",!1,t.outerHTML);let a=document.activeElement;a&&a.dispatchEvent(new Event("input",{bubbles:!0}))},children:(0,n.jsx)(eQ.Z,{className:A})})}),(0,n.jsx)(t4._v,{children:(0,n.jsx)("p",{children:"Insertar Fecha"})})]}),(0,n.jsxs)(t4.u,{children:[(0,n.jsx)(t4.aJ,{asChild:!0,children:(0,n.jsx)("button",{className:Z,onMouseDown:e=>{e.preventDefault(),e.stopPropagation(),document.execCommand("removeFormat",!1);let t=window.getSelection();if(t&&t.rangeCount>0){let e=t.getRangeAt(0).commonAncestorContainer;e.nodeType===Node.ELEMENT_NODE&&e.querySelectorAll('span[style*="text-decoration"]').forEach(e=>{let t=e.parentNode;t&&(t.replaceChild(document.createTextNode(e.textContent||""),e),t.normalize())})}let a=document.activeElement;a&&a.dispatchEvent(new Event("input",{bubbles:!0}))},children:(0,n.jsx)(ed.Z,{className:A})})}),(0,n.jsx)(t4._v,{children:(0,n.jsx)("p",{children:"Limpiar Formato"})})]}),(0,n.jsx)("div",{className:"w-px h-5 bg-white/30 mx-0.5"}),(0,n.jsxs)(t4.u,{children:[(0,n.jsx)(t4.aJ,{asChild:!0,children:(0,n.jsx)("button",{className:(0,k.cn)(Z,p&&"bg-gray-200"),onClick:d,children:(0,n.jsx)(av.Z,{className:A})})}),(0,n.jsx)(t4._v,{children:(0,n.jsx)("p",{children:"Mover tablero"})})]}),(0,n.jsxs)(t4.u,{children:[(0,n.jsx)(t4.aJ,{asChild:!0,children:(0,n.jsx)("button",{className:Z,onClick:S,children:(0,n.jsx)(ab.Z,{className:A})})}),(0,n.jsx)(t4._v,{children:(0,n.jsx)("p",{children:"Crear lienzo blanco"})})]}),(0,n.jsxs)(t4.u,{children:[(0,n.jsx)(t4.aJ,{asChild:!0,children:(0,n.jsx)("button",{className:L,onClick:a,children:(0,n.jsx)(ef.Z,{className:"w-[14px] h-[14px] text-white"})})}),(0,n.jsx)(t4._v,{children:(0,n.jsx)("p",{children:"Cerrar"})})]})]});return i?B:(0,n.jsxs)(F.s,{size:{width:"auto",height:"auto"},position:j,onDragStop:(e,t)=>{let a={x:t.x,y:t.y};w(a);try{localStorage.setItem("formattingToolbarPosition",JSON.stringify(a))}catch(e){console.error("Failed to save formatting toolbar position",e)}},dragHandleClassName:"drag-handle",bounds:"window",enableResizing:!1,className:"z-[60000] pointer-events-auto",children:[(0,n.jsx)("div",{className:"drag-handle cursor-grab active:cursor-grabbing py-1 text-slate-800 flex justify-center mb-1",children:(0,n.jsx)(es.Z,{className:"size-4"})}),B]})};function aw(e){let{isOpen:t,onOpenChange:a,onAddImage:r}=e,[l,i]=(0,s.useState)("");return(0,n.jsx)(eL.Vq,{open:t,onOpenChange:a,children:(0,n.jsxs)(eL.cZ,{children:[(0,n.jsxs)(eL.fK,{children:[(0,n.jsx)(eL.$N,{children:"A\xf1adir Imagen desde URL"}),(0,n.jsx)(eL.Be,{children:"Pega la URL completa de la imagen que deseas a\xf1adir al lienzo."})]}),(0,n.jsx)("div",{className:"grid gap-4 py-4",children:(0,n.jsxs)("div",{className:"grid grid-cols-4 items-center gap-4",children:[(0,n.jsx)(eO._,{htmlFor:"imageUrl",className:"text-right",children:"URL"}),(0,n.jsx)(tt.I,{id:"imageUrl",name:"imageUrl",value:l,onChange:e=>i(e.target.value),className:"col-span-3",placeholder:"https://..."})]})}),(0,n.jsxs)(eL.cN,{children:[(0,n.jsx)(E.z,{variant:"ghost",onClick:()=>a(!1),children:"Cancelar"}),(0,n.jsx)(E.z,{onClick:()=>{l&&r(l)},disabled:!l,children:"A\xf1adir Imagen"})]})]})})}var ay=a(42325);let aN=s.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,n.jsx)(ay.fC,{className:(0,k.cn)("grid gap-2",a),...r,ref:t})});aN.displayName=ay.fC.displayName;let aC=s.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,n.jsx)(ay.ck,{ref:t,className:(0,k.cn)("aspect-square h-4 w-4 rounded-full border border-primary text-primary ring-offset-background focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",a),...r,children:(0,n.jsx)(ay.z$,{className:"flex items-center justify-center",children:(0,n.jsx)(ej.Z,{className:"h-2.5 w-2.5 fill-current text-current"})})})});aC.displayName=ay.ck.displayName;let ak=[{id:"letter",label:'Carta (8.5" x 11")',description:"Formato est\xe1ndar para documentos."},{id:"10x15",label:"Ficha (10cm x 15cm)",description:"Ideal para notas r\xe1pidas y fichas de estudio."}];function aE(e){let{isOpen:t,onOpenChange:a,notepad:r,onSaveFormat:l}=e,[i,o]=(0,s.useState)("letter");return(0,s.useEffect)(()=>{if(r){var e;o((null===(e=r.properties)||void 0===e?void 0:e.format)||"letter")}},[r]),(0,n.jsx)(eL.Vq,{open:t,onOpenChange:a,children:(0,n.jsxs)(eL.cZ,{children:[(0,n.jsx)(eL.fK,{children:(0,n.jsx)(eL.$N,{children:"Cambiar Formato del Cuaderno"})}),(0,n.jsx)("div",{className:"py-4",children:(0,n.jsx)(aN,{value:i,onValueChange:e=>o(e),children:ak.map(e=>(0,n.jsxs)(eO._,{htmlFor:e.id,className:"flex items-start space-x-3 p-4 rounded-md border hover:bg-accent cursor-pointer",children:[(0,n.jsx)(aC,{value:e.id,id:e.id}),(0,n.jsxs)("div",{className:"grid gap-1.5",children:[(0,n.jsx)("span",{className:"font-semibold",children:e.label}),(0,n.jsx)("span",{className:"text-sm text-muted-foreground",children:e.description})]})]},e.id))})}),(0,n.jsxs)(eL.cN,{children:[(0,n.jsx)(E.z,{variant:"outline",onClick:()=>a(!1),children:"Cancelar"}),(0,n.jsx)(E.z,{onClick:()=>{(null==r?void 0:r.id)&&l(r.id,i)},children:"Guardar Cambios"})]})]})})}function az(e){let{isOpen:t,onOpenChange:a,comment:r,onUpdate:l,onDelete:i}=e,[o,c]=(0,s.useState)(""),[d,u]=(0,s.useState)(""),[p,m]=(0,s.useState)(""),{toast:h}=(0,f.pm)(),x=(0,s.useRef)(null),g=(0,s.useRef)(null),v=(0,s.useRef)(null);(0,s.useEffect)(()=>{if(t&&r&&r.content){let e=r.content;c(e.title||""),u(e.label||""),m(e.text||"")}else c(""),u(""),m("")},[t,r]);let{saveStatus:b,handleBlur:j,handleChange:w}=eP({getContent:()=>{var e;return(null===(e=x.current)||void 0===e?void 0:e.value)||o},onSave:async e=>{if(e!==o&&r){let t=r.content;l(r.id,{content:{...t,title:e}})}},debounceMs:2e3,compareContent:(e,t)=>e===t,disabled:!t}),{saveStatus:y,handleBlur:N,handleChange:C}=eP({getContent:()=>{var e;return(null===(e=g.current)||void 0===e?void 0:e.value)||d},onSave:async e=>{if(e!==d&&r){let t=r.content;l(r.id,{content:{...t,label:e}})}},debounceMs:2e3,compareContent:(e,t)=>e===t,disabled:!t}),{saveStatus:k,handleBlur:z,handleChange:D}=eP({getContent:()=>{var e;return(null===(e=v.current)||void 0===e?void 0:e.value)||p},onSave:async e=>{if(e!==p&&r){let t=r.content;l(r.id,{content:{...t,text:e}})}},debounceMs:2e3,compareContent:(e,t)=>e===t,disabled:!t});return(0,n.jsx)(eL.Vq,{open:t,onOpenChange:a,children:(0,n.jsxs)(eL.cZ,{className:"sm:max-w-[425px]",children:[(0,n.jsxs)(eL.fK,{children:[(0,n.jsx)(eL.$N,{children:"Editar Comentario"}),(0,n.jsx)(eL.Be,{children:"Realiza cambios en tu comentario aqu\xed. Haz clic en guardar cuando hayas terminado."})]}),(0,n.jsxs)("div",{className:"grid gap-4 py-4",children:[(0,n.jsxs)("div",{className:"grid grid-cols-4 items-center gap-4",children:[(0,n.jsx)(eO._,{htmlFor:"title",className:"text-right",children:"T\xedtulo"}),(0,n.jsxs)("div",{className:"col-span-3 relative",children:[(0,n.jsx)(tt.I,{ref:x,id:"title",value:o,onChange:e=>{c(e.target.value),w()},onBlur:j,className:"pr-8",placeholder:"T\xedtulo del comentario (opcional)"}),(0,n.jsx)("div",{className:"absolute top-2 right-2",children:(0,n.jsx)(eZ,{status:b,size:"sm"})})]})]}),(0,n.jsxs)("div",{className:"grid grid-cols-4 items-center gap-4",children:[(0,n.jsx)(eO._,{htmlFor:"label",className:"text-right",children:"Etiqueta"}),(0,n.jsxs)("div",{className:"col-span-3 relative",children:[(0,n.jsx)(tt.I,{ref:g,id:"label",value:d,onChange:e=>{u(e.target.value),C()},onBlur:N,className:"pr-8",placeholder:"Etiqueta corta (opcional)"}),(0,n.jsx)("div",{className:"absolute top-2 right-2",children:(0,n.jsx)(eZ,{status:y,size:"sm"})})]})]}),(0,n.jsxs)("div",{className:"grid grid-cols-4 items-start gap-4",children:[" ",(0,n.jsx)(eO._,{htmlFor:"commentText",className:"text-right mt-2",children:"Texto"}),(0,n.jsxs)("div",{className:"col-span-3 relative",children:[(0,n.jsx)(t7,{ref:v,id:"commentText",value:p,onChange:e=>{m(e.target.value),D()},onBlur:z,className:"h-24 pr-8",placeholder:"Escribe tu comentario aqu\xed..."}),(0,n.jsx)("div",{className:"absolute top-2 right-2",children:(0,n.jsx)(eZ,{status:k,size:"sm"})})]})]})]}),(0,n.jsxs)(eL.cN,{children:[(0,n.jsxs)(O,{children:[(0,n.jsx)(_,{asChild:!0,children:(0,n.jsxs)(E.z,{variant:"destructive",className:"mr-auto",children:[(0,n.jsx)(L.Z,{className:"mr-2 h-4 w-4"})," Eliminar"]})}),(0,n.jsxs)(J,{children:[(0,n.jsxs)(q,{children:[(0,n.jsx)(V,{children:"\xbfEst\xe1s seguro de eliminar este comentario?"}),(0,n.jsx)(W,{children:"Esta acci\xf3n no se puede deshacer. Esto eliminar\xe1 permanentemente tu comentario."})]}),(0,n.jsxs)(K,{children:[(0,n.jsx)(Y,{children:"Cancelar"}),(0,n.jsx)(G,{onClick:()=>{r&&(i(r.id),h({variant:"destructive",title:"Comentario Eliminado",description:"El comentario ha sido borrado permanentemente."}),a(!1))},className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Eliminar"})]})]})]}),(0,n.jsx)(E.z,{variant:"outline",onClick:()=>a(!1),children:"Cancelar"}),(0,n.jsx)(E.z,{onClick:()=>{r&&(j(),N(),z(),l(r.id,{content:{...r.content,title:o,label:d,text:p}}),h({title:"Comentario Actualizado",description:"El comentario ha sido guardado."}),a(!1))},children:"Guardar cambios"})]})]})})}function aD(e){let{element:t,isVisible:a,onClose:r}=e,[l,i]=(0,s.useState)(!1);if(!a||!t)return null;let o=async()=>{try{await navigator.clipboard.writeText(t.id),i(!0),setTimeout(()=>i(!1),2e3)}catch(e){console.error("Error al copiar ID:",e)}},c="object"==typeof t.properties&&null!==t.properties?t.properties:{},d=c.position||{x:t.x||0,y:t.y||0},u=c.size||{width:t.width||0,height:t.height||0};return(0,n.jsxs)(X,{className:"fixed top-4 right-4 w-80 z-[9999] shadow-xl border-2 border-blue-500 bg-white",children:[(0,n.jsx)($,{className:"pb-2",children:(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsx)("h3",{className:"text-sm font-semibold text-gray-800 flex items-center gap-2",children:"\uD83D\uDCCB Informaci\xf3n del Elemento"}),(0,n.jsx)(E.z,{variant:"ghost",size:"icon",className:"h-5 w-5",onClick:r,children:(0,n.jsx)(ef.Z,{className:"h-4 w-4"})})]})}),(0,n.jsxs)(ee,{className:"space-y-3 text-sm",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("span",{className:"font-medium text-gray-600",children:"Tipo:"}),(0,n.jsx)("span",{className:"ml-2 text-gray-800 capitalize",children:t.type})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("span",{className:"font-medium text-gray-600",children:"ID:"}),(0,n.jsxs)("div",{className:"flex items-center gap-2 mt-1",children:[(0,n.jsx)("code",{className:"text-xs bg-gray-100 px-2 py-1 rounded flex-1 truncate",children:t.id}),(0,n.jsx)(E.z,{variant:"outline",size:"icon",className:"h-7 w-7 flex-shrink-0",onClick:o,title:"Copiar ID",children:l?(0,n.jsx)(eb.Z,{className:"h-3 w-3 text-green-600"}):(0,n.jsx)(tn.Z,{className:"h-3 w-3"})})]})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("span",{className:"font-medium text-gray-600",children:"Posici\xf3n:"}),(0,n.jsxs)("div",{className:"ml-2 mt-1 text-gray-800",children:[(0,n.jsxs)("div",{children:["X: ",Math.round(d.x),"px"]}),(0,n.jsxs)("div",{children:["Y: ",Math.round(d.y),"px"]})]})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("span",{className:"font-medium text-gray-600",children:"Tama\xf1o:"}),(0,n.jsxs)("div",{className:"ml-2 mt-1 text-gray-800",children:[(0,n.jsxs)("div",{children:["Ancho: ",Math.round("number"==typeof u.width?u.width:0),"px"]}),(0,n.jsxs)("div",{children:["Alto: ",Math.round("number"==typeof u.height?u.height:0),"px"]})]})]}),void 0!==t.zIndex&&(0,n.jsxs)("div",{children:[(0,n.jsx)("span",{className:"font-medium text-gray-600",children:"Z-Index:"}),(0,n.jsx)("span",{className:"ml-2 text-gray-800",children:t.zIndex})]}),t.parentId&&(0,n.jsxs)("div",{children:[(0,n.jsx)("span",{className:"font-medium text-gray-600",children:"Padre:"}),(0,n.jsxs)("code",{className:"ml-2 text-xs bg-gray-100 px-2 py-1 rounded",children:[t.parentId.substring(0,8),"..."]})]}),"container"===t.type&&(0,n.jsxs)("div",{children:[(0,n.jsx)("span",{className:"font-medium text-gray-600",children:"Elementos:"}),(0,n.jsx)("span",{className:"ml-2 text-gray-800",children:"object"==typeof t.content&&null!==t.content&&"elementIds"in t.content?t.content.elementIds.length:0})]}),"sticky"===t.type&&t.color&&(0,n.jsxs)("div",{children:[(0,n.jsx)("span",{className:"font-medium text-gray-600",children:"Color:"}),(0,n.jsxs)("div",{className:"ml-2 mt-1 flex items-center gap-2",children:[(0,n.jsx)("div",{className:"w-4 h-4 rounded border border-gray-300",style:{backgroundColor:t.color}}),(0,n.jsx)("span",{className:"text-gray-800",children:t.color})]})]})]})]})}function aS(e){let{isOpen:t,onOpenChange:a,currentBoardName:r,onSave:l}=e,[i,o]=(0,s.useState)(r);(0,s.useEffect)(()=>{t&&o(r)},[t,r]);let c=()=>{i.trim()&&l(i),a(!1)};return(0,n.jsx)(eL.Vq,{open:t,onOpenChange:e=>{e?a(!0):c()},children:(0,n.jsxs)(eL.cZ,{onInteractOutside:c,children:[(0,n.jsxs)(eL.fK,{children:[(0,n.jsx)(eL.$N,{children:"Renombrar Tablero"}),(0,n.jsx)(eL.Be,{children:"El tablero se guardar\xe1 autom\xe1ticamente cuando cierres este di\xe1logo o presiones Enter."})]}),(0,n.jsx)("div",{className:"grid gap-4 py-4",children:(0,n.jsxs)("div",{className:"grid grid-cols-4 items-center gap-4",children:[(0,n.jsx)(eO._,{htmlFor:"boardName",className:"text-right",children:"Nombre"}),(0,n.jsx)(tt.I,{id:"boardName",name:"boardName",value:i,onChange:e=>o(e.target.value),className:"col-span-3",onKeyDown:e=>{"Enter"===e.key&&c()},onBlur:c,autoFocus:!0})]})})]})})}function aT(e){let{name:t}=e;return(0,n.jsx)("div",{className:"fixed top-4 left-4 z-[9999] pointer-events-none",children:(0,n.jsx)("h1",{className:"text-sm font-medium tracking-tight opacity-70",style:{fontFamily:"'Space Grotesk', 'Poppins', sans-serif",color:"#1a1a1a",textShadow:"0 1px 2px rgba(255,255,255,0.8)",letterSpacing:"-0.01em"},children:t||"Sin t\xedtulo"})})}var aP=a(53916);function aR(e){let{elements:t,isOpen:a,onClose:r,onLocateElement:l}=e,[i,o]=(0,s.useState)(""),c=(0,s.useMemo)(()=>new aP.Z(t,{keys:[{name:"content",weight:.7},{name:"type",weight:.3}],threshold:.3,includeScore:!0}),[t]),d=(0,s.useMemo)(()=>i.trim()?c.search(i).map(e=>e.item):[],[i,c]),u=e=>{l(e),r(),o("")},p=e=>{if("string"==typeof e.content)return e.content;if("object"==typeof e.content&&null!==e.content){if("text"in e.content)return String(e.content.text);if("title"in e.content)return String(e.content.title);if("label"in e.content)return String(e.content.label)}return"Elemento ".concat(e.type)};return(0,n.jsx)(eL.Vq,{open:a,onOpenChange:r,children:(0,n.jsxs)(eL.cZ,{className:"max-w-2xl",children:[(0,n.jsx)(eL.fK,{children:(0,n.jsx)(eL.$N,{children:"Buscar en tablero"})}),(0,n.jsxs)("div",{className:"relative",children:[(0,n.jsx)(tv.Z,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),(0,n.jsx)(tt.I,{type:"text",placeholder:"Buscar elementos...",value:i,onChange:e=>o(e.target.value),className:"pl-10 pr-10",autoFocus:!0}),i&&(0,n.jsx)("button",{onClick:()=>o(""),className:"absolute right-3 top-1/2 transform -translate-y-1/2",children:(0,n.jsx)(ef.Z,{className:"h-4 w-4 text-gray-400"})})]}),i&&(0,n.jsx)("div",{className:"mt-4 max-h-96 overflow-y-auto",children:d.length>0?(0,n.jsx)("div",{className:"space-y-1",children:d.map(e=>(0,n.jsxs)("button",{onClick:()=>u(e.id),className:"w-full text-left p-3 hover:bg-gray-100 rounded-lg border border-gray-200",children:[(0,n.jsx)("div",{className:"font-semibold text-sm capitalize",children:e.type}),(0,n.jsx)("div",{className:"text-xs text-gray-600 truncate mt-1",children:p(e)})]},e.id))}):(0,n.jsx)("div",{className:"text-center text-gray-500 py-8",children:"No se encontraron resultados"})})]})})}let aI=()=>{let[e,t]=(0,s.useState)(!1),[a,n]=(0,s.useState)(""),[r,l]=(0,s.useState)(""),i=(0,s.useRef)(null),o=window.SpeechRecognition||window.webkitSpeechRecognition,c=(0,s.useCallback)(()=>{if(i.current)try{i.current.stop()}catch(e){}t(!1),n("")},[]),d=(0,s.useCallback)(()=>{if(!o)return;if(e){c();return}let a=window.SpeechRecognition||window.webkitSpeechRecognition;if(!a)return;let r=new a;r.continuous=!0,r.interimResults=!0,r.lang="es-ES",r.onstart=()=>{t(!0),n(""),l("")},r.onresult=e=>{let t="",a="";for(let n=e.resultIndex;n<e.results.length;n++){let r=e.results[n],s=r[0].transcript;r.isFinal?a+=s+" ":t+=s}t&&n(t),a&&(n(""),l(e=>(e+" "+a).trim()))},r.onend=()=>{t(!1),i.current=null},r.onerror=()=>{t(!1),i.current=null},i.current=r,r.start()},[e,o,c]);return(0,s.useEffect)(()=>()=>{c()},[c]),{isSupported:o,isListening:e,interimTranscript:a,finalTranscript:r,toggle:d,stop:c}};function aM(e){let{boardId:t}=e,c=(0,r.useRouter)(),{user:u,loading:p}=(0,i.E)(),m=(0,o.cr)(),{toast:h}=(0,f.pm)(),x=b("(max-width: 768px)");(0,s.useEffect)(()=>{p||u||(async()=>{try{let{signInAnonymously:e}=await Promise.resolve().then(a.bind(a,44752)),{auth:t}=await Promise.resolve().then(a.bind(a,8858));t&&(await e(t),console.log("✅ Usuario an\xf3nimo creado autom\xe1ticamente"))}catch(e){console.error("❌ Error creando usuario an\xf3nimo:",e)}})()},[p,u]);let j=(0,s.useRef)(null),w=(0,s.useRef)(null),N=(0,s.useRef)(null),{elements:k,board:E,loadBoard:z,createBoard:D,updateElement:S,deleteElement:T,selectedElementIds:P,setSelectedElementIds:R,isLoading:I,error:M,cleanup:Z}=g();(0,s.useEffect)(()=>{j.current=z,w.current=D,N.current=Z},[z,D,Z]),(0,s.useEffect)(()=>()=>{N.current&&N.current()},[t]);let{boards:A,handleRenameBoard:L,handleDeleteBoard:F,clearCanvas:B}=function(e){let t=(0,o.hi)(),{user:a}=(0,i.E)(),{toast:n}=(0,f.pm)(),l=(0,r.useRouter)(),c=(0,s.useRef)(l),u=(0,s.useRef)(n);(0,s.useEffect)(()=>{c.current=l,u.current=n},[l,n]);let[p,m]=(0,s.useState)(null),[h,x]=(0,s.useState)([]),[g,v]=(0,s.useState)([]),[b,j]=(0,s.useState)(!0);(0,s.useEffect)(()=>{if(!t||!a)return;let e=(0,d.IO)((0,d.hJ)(t,"users",a.uid,"canvasBoards"),(0,d.Xo)("updatedAt","desc")),n=(0,d.cf)(e,e=>{x(e.docs.map(e=>({...e.data(),id:e.id})))},e=>{console.error("Error fetching boards list:",e)});return()=>n()},[t,a]),(0,s.useEffect)(()=>{if(!t||!a||!e)return;j(!0);let n=(0,d.JU)(t,"users",a.uid,"canvasBoards",e),r=(0,d.cf)(n,e=>{e.exists()?m({...e.data(),id:e.id}):(u.current({variant:"destructive",title:"Error",description:"Este tablero no existe o no tienes permiso para verlo."}),c.current.push("/")),j(!1)},e=>{console.error("Error fetching board:",e),j(!1),u.current({variant:"destructive",title:"Error de Carga",description:"No se pudo cargar el tablero."}),c.current.push("/")});return()=>{r()}},[t,a,e]);let w=(0,s.useCallback)(async r=>{if(!t||!a||!e||!p||!r.trim()){n({variant:"destructive",title:"Error",description:"No se puede renombrar el tablero. Verifica que est\xe9s autenticado."});return}if(r.trim()!==p.name)try{let s=(0,d.JU)(t,"users",a.uid,"canvasBoards",e);await (0,d.r7)(s,{name:r.trim(),updatedAt:(0,d.serverTimestamp)()}),n({title:"Tablero renombrado",description:'El tablero ahora se llama "'.concat(r.trim(),'".')})}catch(e){console.error("Error renombrando tablero:",e),n({variant:"destructive",title:"Error",description:e.message||"No se pudo renombrar el tablero. Verifica tus permisos."})}},[t,a,p,e,n]);return{board:p,boards:h,elements:g,isLoading:b,handleRenameBoard:w,handleDeleteBoard:(0,s.useCallback)(async()=>{if(t&&a&&e){n({title:"Eliminando tablero..."});try{let r=(0,d.JU)(t,"users",a.uid,"canvasBoards",e);await (0,d.oe)(r),n({title:"Tablero eliminado",description:"El tablero y todo su contenido han sido eliminados."}),l.push("/")}catch(e){console.error("Error deleting board:",e),n({variant:"destructive",title:"Error",description:"No se pudo eliminar el tablero."})}}},[t,a,e,l,n]),clearCanvas:(0,s.useCallback)(async r=>{if(!t||!a||!e||!r){n({variant:"destructive",title:"Error",description:"No se puede limpiar el tablero. Verifica que est\xe9s autenticado."});return}if(0===r.length){n({title:"Tablero vac\xedo",description:"El tablero ya est\xe1 vac\xedo."});return}try{let s=(0,d.hJ)(t,"users",a.uid,"canvasBoards",e,"canvasElements"),l=(0,d.qs)(t);r.forEach(e=>l.delete((0,d.JU)(s,e.id)));let i=(0,d.JU)(t,"users",a.uid,"canvasBoards",e);l.update(i,{updatedAt:(0,d.serverTimestamp)()}),await l.commit(),n({title:"Tablero Limpio",description:"Se eliminaron ".concat(r.length," elemento(s) del tablero.")})}catch(e){console.error("Error limpiando tablero:",e),n({variant:"destructive",title:"Error",description:e.message||"No se pudo limpiar el tablero. Verifica tus permisos."})}},[t,a,e,n])}}(t),O=(0,s.useRef)(null),[_,H]=(0,s.useState)(!0),[U,J]=(0,s.useState)(!1),[q,K]=(0,s.useState)(!1),[V,W]=(0,s.useState)(!1),[G,Y]=(0,s.useState)(!1),[Q,X]=(0,s.useState)(null),[$,ee]=(0,s.useState)(null),[et,ea]=(0,s.useState)(null),[en,er]=(0,s.useState)(!1),[es,el]=(0,s.useState)(!1),[ei,eo]=(0,s.useState)(null),[ec,ed]=(0,s.useState)(!1),[eu,ep]=(0,s.useState)(!1),{isListening:em,finalTranscript:eh,interimTranscript:ex,toggle:eg,stop:ef}=aI(),ev=ex?"".concat(eh," ").concat(ex).trim():eh,eb=(0,s.useRef)("");(0,s.useEffect)(()=>{if(!em||!eh||eh===eb.current)return;let e=document.activeElement;if(!e)return;let t=eh.replace(eb.current,"").trim();if(!t)return;let a=t.endsWith(" ")?"":" ";try{if(e.isContentEditable)document.execCommand("insertText",!1,t+a),e.dispatchEvent(new Event("input",{bubbles:!0}));else if(e instanceof HTMLInputElement||e instanceof HTMLTextAreaElement){var n,r;let s=null!==(n=e.selectionStart)&&void 0!==n?n:e.value.length,l=null!==(r=e.selectionEnd)&&void 0!==r?r:e.value.length,i=e.value.slice(0,s),o=e.value.slice(l);e.value=i+t+a+o;let c=s+t.length+a.length;e.selectionStart=e.selectionEnd=c,e.dispatchEvent(new Event("input",{bubbles:!0})),e.dispatchEvent(new Event("change",{bubbles:!0}))}}catch(e){console.error("No se pudo insertar dictado",e),ef()}eb.current=eh},[eh,em,ef]);let ej=(0,s.useCallback)(()=>O.current?O.current.getViewportCenter():{x:400,y:400},[]),ew=(0,s.useRef)(k);(0,s.useEffect)(()=>{ew.current=k},[k]);let{addElement:ey}=function(e,t,a){let n=(0,v.CU)(),{user:r}=(0,v.aF)(),{toast:l}=(0,f.pm)(),i=(0,s.useRef)(t),o=(0,s.useRef)(a);(0,s.useEffect)(()=>{i.current=t,o.current=a},[t,a]);let c=(0,s.useCallback)(async(t,a)=>{var s,l,c,u;let p,m;if(!n||!r||!e)return Promise.reject(Error(n?r?"Board ID no v\xe1lido":"Usuario no autenticado":"Firestore no est\xe1 disponible"));let h=(0,d.hJ)(n,"users",r.uid,"canvasBoards",e,"canvasElements");if("connector"===t)return(await (0,d.ET)(h,{type:"connector",userId:r.uid,properties:{},content:null==a?void 0:a.content,createdAt:(0,d.serverTimestamp)(),updatedAt:(0,d.serverTimestamp)()})).id;let x=i.current();p="container"===t?0:o.current();let g=a&&a.properties&&a.properties.position?a.properties.position:x,f=a&&a.properties&&a.properties.size?a.properties.size:{width:200,height:150},v="number"==typeof f.width?f.width:200,b="number"==typeof f.height?f.height:150,j=(e,t)=>{let a=g.x,n=g.y,r=a-e/2,s=n-t/2,l=window.innerWidth,i=window.innerHeight;return{x:Math.max(0,r=e<=l?Math.max(20,Math.min(r,a+l/2-e)):Math.max(20,a-l/4)),y:Math.max(0,s=t<=i?Math.max(20,Math.min(s,n+i/2-t)):Math.max(20,n-i/4))}},w={size:f,zIndex:p,rotation:0};switch(a&&a.properties&&"object"==typeof a.properties&&Object.assign(w,a.properties),t){case"notepad":let y={width:794,height:978},N=j(y.width,y.height);m={type:t,x:N.x,y:N.y,width:y.width,height:y.height,userId:r.uid,properties:{...w,position:N,size:y,format:"letter"},content:{title:"Nuevo Cuaderno",pages:[,,,,,].fill("<div><br></div>"),currentPage:0},zIndex:p,createdAt:(0,d.serverTimestamp)(),updatedAt:(0,d.serverTimestamp)()};break;case"notepad-simple":let C={width:302,height:491},k=j(C.width,C.height);m={type:t,x:k.x,y:k.y,width:C.width,height:C.height,userId:r.uid,properties:{...w,position:k,size:C},content:{title:"Nuevo Notepad",text:"<div><br></div>"},zIndex:p,createdAt:(0,d.serverTimestamp)(),updatedAt:(0,d.serverTimestamp)()};break;case"super-notebook":let E={width:794,height:1021},z=j(E.width,E.height);m={type:t,x:z.x,y:z.y,width:E.width,height:E.height,userId:r.uid,properties:{...w,position:z,size:E},content:{title:"Super Cuaderno",pages:[,,,,,].fill("<div><br></div>"),currentPage:0},zIndex:p,createdAt:(0,d.serverTimestamp)(),updatedAt:(0,d.serverTimestamp)()};break;case"sticky":let D=(null==a?void 0:a.color)||"yellow",S={width:224,height:224},T=j(S.width,S.height);m={type:"sticky",x:T.x,y:T.y,width:S.width,height:S.height,userId:r.uid,properties:{...w,position:T,size:S,color:D},content:"string"==typeof(null==a?void 0:a.content)?a.content:"Escribe algo...",zIndex:p,createdAt:(0,d.serverTimestamp)(),updatedAt:(0,d.serverTimestamp)(),...(null==a?void 0:a.tags)&&{tags:a.tags}};break;case"todo":let P={width:300,height:150},R=j(P.width,P.height);m={type:t,x:R.x,y:R.y,width:P.width,height:P.height,userId:r.uid,properties:{...w,position:R,size:P},content:(null==a?void 0:a.content)||{title:"Lista de Tareas",items:[]},zIndex:p,createdAt:(0,d.serverTimestamp)(),updatedAt:(0,d.serverTimestamp)()};break;case"image":let I=j(v,b);m={type:t,x:I.x,y:I.y,width:v,height:b,userId:r.uid,properties:{...w,position:I,size:{width:v,height:b}},content:null==a?void 0:a.content,zIndex:p,createdAt:(0,d.serverTimestamp)(),updatedAt:(0,d.serverTimestamp)()};break;case"text":let M=j(v,b),Z=(null==a?void 0:null===(s=a.properties)||void 0===s?void 0:s.backgroundColor)||"#ffffff";m={type:t,x:M.x,y:M.y,width:v,height:b,userId:r.uid,properties:{...w,position:M,size:{width:v,height:b},backgroundColor:Z},content:(null==a?void 0:a.content)||'<div style="font-size: 18px;">Escribe algo...</div>',color:(null==a?void 0:a.color)||"white",zIndex:p,createdAt:(0,d.serverTimestamp)(),updatedAt:(0,d.serverTimestamp)()};break;case"container":let A=(null==a?void 0:null===(l=a.properties)||void 0===l?void 0:l.size)?a.properties.size:{width:378,height:567},L=(null==a?void 0:a.content)&&"object"==typeof a.content&&"title"in a.content?a.content:null,F=(null==L?void 0:L.title)==="Lienzo"||(null==L?void 0:L.title)==="lienzo",B=F?{width:Math.round(("number"==typeof A.width?A.width:378)*.5),height:"number"==typeof A.height?A.height:567}:A,O=j("number"==typeof B.width?B.width:378,"number"==typeof B.height?B.height:567),_=F?"#daf4c5":(null==a?void 0:null===(c=a.properties)||void 0===c?void 0:c.backgroundColor)?a.properties.backgroundColor:"white",H=F?-1:p;m={type:"container",x:O.x,y:O.y,width:"number"==typeof B.width?B.width:378,height:"number"==typeof B.height?B.height:567,userId:r.uid,properties:{...w,position:O,size:B,backgroundColor:_,zIndex:H},content:L||{title:"Nuevo Contenedor",elementIds:[],layout:"single"},zIndex:H,createdAt:(0,d.serverTimestamp)(),updatedAt:(0,d.serverTimestamp)()};break;case"comment":let U={width:32,height:32},J=j(U.width,U.height);m={type:t,x:J.x,y:J.y,width:U.width,height:U.height,userId:r.uid,properties:{...w,position:J,size:U},content:(null==a?void 0:a.content)||{title:"",label:"",comment:""},parentId:(null==a?void 0:a.parentId)||void 0,zIndex:p,createdAt:(0,d.serverTimestamp)(),updatedAt:(0,d.serverTimestamp)()};break;case"moodboard":let q={width:600,height:500},K=j(q.width,q.height);m={type:t,x:K.x,y:K.y,width:q.width,height:q.height,userId:r.uid,properties:{...w,position:K,size:q,backgroundColor:"#ffffff"},content:(null==a?void 0:a.content)||{title:"Nuevo Moodboard",images:[],annotations:[],layout:"grid"},zIndex:p,createdAt:(0,d.serverTimestamp)(),updatedAt:(0,d.serverTimestamp)()};break;case"tabbed-notepad":let V={width:500,height:400},W=j(V.width,V.height);m={type:t,x:W.x,y:W.y,width:V.width,height:V.height,userId:r.uid,properties:{...w,position:W,size:V,backgroundColor:"#ffffff"},content:(null==a?void 0:a.content)||{title:"Bloc de Notas",tabs:[{id:"tab-1",title:"Pesta\xf1a 1",content:""}],activeTabId:"tab-1"},zIndex:p,createdAt:(0,d.serverTimestamp)(),updatedAt:(0,d.serverTimestamp)()};break;case"accordion":let G={width:320,height:240},Y=j(G.width,G.height);m={type:t,x:Y.x,y:Y.y,width:G.width,height:G.height,userId:r.uid,properties:{...w,position:Y,size:G,backgroundColor:"#ffffff"},content:(null==a?void 0:a.content)||{items:[{id:"1",title:"Nuevo Item",content:""}]},zIndex:p,createdAt:(0,d.serverTimestamp)(),updatedAt:(0,d.serverTimestamp)()};break;case"stopwatch":let Q={width:200,height:120},X=j(Q.width,Q.height);m={type:"stopwatch",x:X.x,y:X.y,width:Q.width,height:Q.height,userId:r.uid,properties:{...w,position:X,size:Q,backgroundColor:"#000000"},content:{time:0,isRunning:!1},zIndex:p,createdAt:(0,d.serverTimestamp)(),updatedAt:(0,d.serverTimestamp)()};break;case"countdown":let $={width:200,height:180},ee=j($.width,$.height);m={type:"countdown",x:ee.x,y:ee.y,width:$.width,height:$.height,userId:r.uid,properties:{...w,position:ee,size:$,backgroundColor:"#000000"},content:{timeLeft:0,selectedMinutes:5,isRunning:!1},zIndex:p,createdAt:(0,d.serverTimestamp)(),updatedAt:(0,d.serverTimestamp)()};break;case"highlight-text":let et={width:300,height:150},ea=j(et.width,et.height),en=(null==a?void 0:null===(u=a.properties)||void 0===u?void 0:u.backgroundColor)?a.properties.backgroundColor:"#fffb8b";m={type:"highlight-text",x:ea.x,y:ea.y,width:et.width,height:et.height,userId:r.uid,properties:{...w,position:ea,size:et,backgroundColor:en},content:{text:""},zIndex:p,createdAt:(0,d.serverTimestamp)(),updatedAt:(0,d.serverTimestamp)()};break;case"yellow-notepad":let er={width:400,height:600},es=j(er.width,er.height);m={type:t,x:es.x,y:es.y,width:er.width,height:er.height,userId:r.uid,properties:{...w,position:es,size:er,backgroundColor:"#FFFFE0"},content:(null==a?void 0:a.content)||{text:"",searchQuery:""},zIndex:p,createdAt:(0,d.serverTimestamp)(),updatedAt:(0,d.serverTimestamp)()};break;default:return Promise.reject(Error("Tipo de elemento inv\xe1lido: ".concat(t)))}return(await (0,d.ET)(h,m)).id},[n,r,e]);return{addElement:c,updateElement:(0,s.useCallback)((t,a)=>{if(!n||!r||!e)return;let s=(0,d.JU)(n,"users",r.uid,"canvasBoards",e,"canvasElements",t),l={updatedAt:(0,d.serverTimestamp)()};Object.keys(a).forEach(e=>{let t=a[e];void 0!==t?l[e]=t:"parentId"===e&&(l[e]=null)}),(0,d.r7)(s,l);let i=(0,d.JU)(n,"users",r.uid,"canvasBoards",e);(0,d.r7)(i,{updatedAt:(0,d.serverTimestamp)()}).catch(e=>{console.error("Error actualizando tablero:",e)})},[n,r,e]),deleteElement:(0,s.useCallback)(async(t,a)=>{if(!n||!r||!e)return;let s=a.find(e=>e.id===t);if(!s)return;let l=(0,d.hJ)(n,"users",r.uid,"canvasBoards",e,"canvasElements"),i=(0,d.qs)(n),o=(0,d.JU)(l,t);if("container"===s.type){let e=s.content;e&&Array.isArray(e.elementIds)&&e.elementIds.forEach(e=>{let t=(0,d.JU)(l,e);i.delete(t)})}i.delete(o),await i.commit()},[n,r,e]),unanchorElement:(0,s.useCallback)(async t=>{var a,s,i,o,c,u;if(!n||!r||!e)return;let p=(0,d.hJ)(n,"users",r.uid,"canvasBoards",e,"canvasElements"),m=(0,d.JU)(p,t),h=await (0,d.QT)(m);if(!h.exists()){l({variant:"destructive",title:"Error",description:"El elemento no existe."});return}let x=h.data();if(!(null==x?void 0:x.parentId)){l({variant:"destructive",title:"Error",description:"El elemento no est\xe1 anclado a ning\xfan contenedor."});return}let g=x.parentId,f=(0,d.JU)(p,g),v=await (0,d.QT)(f);if(!v.exists()){l({variant:"destructive",title:"Error",description:"No se encontr\xf3 el contenedor padre."});return}let b=v.data();if(!b){l({variant:"destructive",title:"Error",description:"No se pudo obtener datos del contenedor padre."});return}let j=null==b?void 0:b.content,w=null==b?void 0:b.properties,y=((null==j?void 0:j.elementIds)||[]).filter(e=>e!==t),N=null!==(c=null==w?void 0:null===(a=w.position)||void 0===a?void 0:a.x)&&void 0!==c?c:0,C="number"==typeof(null==w?void 0:null===(s=w.size)||void 0===s?void 0:s.width)?w.size.width:((null==w?void 0:null===(i=w.size)||void 0===i?void 0:i.width)?parseFloat(String(w.size.width)):300)||300,k=null!==(u=null==w?void 0:null===(o=w.position)||void 0===o?void 0:o.y)&&void 0!==u?u:0,E=x.properties,z=(null==E?void 0:E.position)||{x:x.x||0,y:x.y||0},D=z.x>0&&z.y>0?z:{x:N+C+20,y:k+50},S=(0,d.qs)(n);S.update(f,{content:{...j,elementIds:y},updatedAt:(0,d.serverTimestamp)()});let T=E||{},P="number"==typeof x.width&&"number"==typeof x.height?{width:x.width,height:x.height}:T.size||{width:200,height:150};S.update(m,{parentId:null,hidden:!1,x:D.x,y:D.y,properties:{...T,position:D,size:P},updatedAt:(0,d.serverTimestamp)()});try{await S.commit(),l({title:"Elemento desanclado",description:"El elemento ha sido devuelto al lienzo."})}catch(e){console.error("Error al desanclar elemento:",e),l({variant:"destructive",title:"Error",description:"No se pudo desanclar el elemento."})}},[n,r,e,l])}}(t,ej,(0,s.useCallback)(()=>{let e=ew.current;if(!(null==e?void 0:e.length))return 1;let t=e.filter(e=>"number"==typeof e.zIndex).map(e=>e.zIndex);return t.length?Math.max(...t)+1:2},[])),eN=1===P.length?P[0]:null,eC=(0,s.useMemo)(()=>eN&&(null==k?void 0:k.length)&&k.find(e=>e.id===eN)||null,[eN,k]);(0,s.useEffect)(()=>{(null==eC?void 0:eC.id)!==(null==Q?void 0:Q.id)&&(X(eC),ed(!!eC))},[eC,null==Q?void 0:Q.id]);let ek=(0,s.useRef)(!1),eE=(0,s.useRef)(!1),ez=(0,s.useRef)(null),eD=(0,s.useRef)(null);(0,s.useEffect)(()=>{var e,a;if(!t||!(null==u?void 0:u.uid)&&p)return;let n=(null==u?void 0:u.uid)||"temp-"+Date.now();if(eE.current){console.log("⏸️ Ya hay una carga en progreso, ignorando...");return}if(ek.current&&ez.current===t&&eD.current===n){console.log("⏸️ Tablero ya cargado:",t);return}if(p){console.log("⏸️ Auth a\xfan cargando, esperando...");return}eE.current=!0,ek.current=!0,ez.current=t,eD.current=n,console.log("\uD83D\uDCC2 Cargando tablero:",t,"para usuario:",n);let r="new"===t?null===(e=w.current)||void 0===e?void 0:e.call(w,n):null===(a=j.current)||void 0===a?void 0:a.call(j,t,n);if(!r){console.error("❌ No se pudo obtener funci\xf3n de carga"),eE.current=!1,ek.current=!1;return}return r.then(e=>{eE.current=!1,"new"===t&&e?(console.log("✅ Tablero creado:",e),c.push("/board/".concat(e,"/"))):console.log("✅ Tablero cargado")}).catch(e=>{console.error("❌ Error:",e),eE.current=!1,ek.current=!1,ez.current=null,eD.current=null}),()=>{}},[t,null==u?void 0:u.uid,p,c]),(0,s.useEffect)(()=>()=>{var e;null===(e=N.current)||void 0===e||e.call(N),ek.current=!1,eE.current=!1,ez.current=null,eD.current=null},[]);let eS=(0,s.useCallback)(e=>{R(e?[e]:[])},[R]),eT=(0,s.useCallback)(async()=>{if(!(null==u?void 0:u.uid)||!m){h({title:"Error",description:"Debes iniciar sesi\xf3n"});return}let e=document.createElement("input");e.type="file",e.accept="image/*",e.onchange=async e=>{var t;let a=null===(t=e.target.files)||void 0===t?void 0:t[0];if(a)try{let e=await y(a,u.uid,m);e.success?(await ey("image",{content:{url:e.url},properties:{size:{width:300,height:200}}}),h({title:"Imagen subida"})):h({variant:"destructive",title:"Error",description:e.error})}catch(e){h({variant:"destructive",title:"Error al subir imagen"})}},e.click()},[u,m,ey,h]),eP=(0,s.useRef)(null),eR=(0,s.useCallback)(e=>{let t=k.find(t=>t.id===e);t&&O.current?(eS(e),O.current.centerOnElement(t),eP.current=null):eP.current=e},[k,eS]);(0,s.useEffect)(()=>{if(eP.current){let e=k.find(e=>e.id===eP.current);e&&O.current&&(eS(eP.current),O.current.centerOnElement(e),eP.current=null)}},[k,eS]);let eI=(0,s.useCallback)(e=>{let t=k.find(t=>t.id===e);if(t){var a;S(e,{hidden:!1}),eS(e),null===(a=O.current)||void 0===a||a.centerOnElement(t)}},[k,S,eS]),eM=(0,s.useCallback)(e=>{let t=k.find(t=>t.id===e);t&&(ea(t),K(!0))},[k]),eZ=(0,s.useCallback)((e,t)=>{let a="letter"===t?{width:794,height:1021}:{width:378,height:567};S(e,{width:a.width,height:a.height,properties:{...null==et?void 0:et.properties,format:t,size:a}}),K(!1)},[et,S]),eA=(0,s.useCallback)(e=>{eo(e),el(!0)},[]),eL=(0,s.useCallback)(e=>{let t=k.find(t=>t.id===e);if(t){var a;ee(e),null===(a=O.current)||void 0===a||a.centerOnElement(t)}},[k]),eF=(0,s.useCallback)(async()=>{if(!O.current)return;let e=O.current.getCanvasContainer();if(e)try{h({title:"Exportando..."}),(await C()(e,{backgroundColor:"#96e4e6",scale:2,useCORS:!0})).toBlob(e=>{if(!e)return;let t=URL.createObjectURL(e),a=document.createElement("a");a.href=t,a.download="".concat((null==E?void 0:E.name)||"tablero","_").concat(Date.now(),".png"),a.click(),URL.revokeObjectURL(t),h({title:"Exportado"})},"image/png")}catch(e){h({variant:"destructive",title:"Error al exportar"})}},[E,h]),eB=(0,s.useCallback)(async()=>{try{let e=ej(),t=await ey("comment",{content:{title:"Nuevo Localizador",label:"Localizador",text:""},properties:{position:e,size:{width:48,height:48}}}),a={id:t,type:"comment",content:{title:"Nuevo Localizador",label:"Localizador",text:""},properties:{position:e,size:{width:48,height:48}},x:e.x,y:e.y,width:48,height:48};setTimeout(()=>{let e=k.find(e=>e.id===t);eo(e||a),el(!0)},150),h({title:"Localizador creado - Edita la etiqueta"})}catch(e){h({variant:"destructive",title:"Error"})}},[ey,ej,h,k]);return p&&!u?(0,n.jsxs)("div",{className:"flex h-screen w-full items-center justify-center",style:{backgroundColor:"#96e4e6"},children:[(0,n.jsx)(l.Z,{className:"h-8 w-8 animate-spin"}),(0,n.jsx)("p",{className:"ml-4",children:"Cargando..."})]}):I||!E?(0,n.jsxs)("div",{className:"flex h-screen w-full items-center justify-center",style:{backgroundColor:"#96e4e6"},children:[(0,n.jsx)(l.Z,{className:"h-8 w-8 animate-spin"}),(0,n.jsx)("p",{className:"ml-4",children:"Cargando tablero..."})]}):M?(0,n.jsxs)("div",{className:"flex h-screen w-full flex-col items-center justify-center",style:{backgroundColor:"#96e4e6"},children:[(0,n.jsxs)("p",{className:"text-red-600 text-lg",children:["Error: ",M]}),(0,n.jsx)("button",{onClick:()=>c.push("/login"),className:"mt-4 px-4 py-2 bg-blue-500 text-white rounded",children:"Volver al inicio"})]}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(aS,{isOpen:G,onOpenChange:Y,currentBoardName:(null==E?void 0:E.name)||"",onSave:e=>{L(e),Y(!1)}}),(0,n.jsxs)("div",{className:"h-screen w-screen relative overflow-hidden",children:[(0,n.jsx)(aT,{name:(null==E?void 0:E.name)||""}),(0,n.jsx)(t_,{ref:O,elements:k,board:E,selectedElementIds:P,onSelectElement:eS,updateElement:S,deleteElement:T,unanchorElement:e=>S(e,{parentId:void 0}),addElement:ey,onLocateElement:eR,onFormatToggle:()=>H(e=>!e),onChangeNotepadFormat:eM,onEditElement:eL,selectedElement:Q,activatedElementId:$,isMobile:x,setIsDirty:er,isListening:em,liveTranscript:ev,finalTranscript:eh,interimTranscript:ex,onBringToFront:()=>{},onSendToBack:()=>{},onMoveBackward:()=>{},onGoToHome:()=>{var e;return null===(e=O.current)||void 0===e?void 0:e.goToHome()},onCenterView:()=>{},onGroupElements:()=>{},saveLastView:()=>{},onActivateDrag:()=>{},onEditComment:eA,onDuplicateElement:()=>{},onUngroup:()=>{}}),(0,n.jsx)(ao,{elements:k||[],boards:A||[],onUploadImage:eT,onAddImageFromUrl:()=>J(!0),onPanToggle:()=>{var e;return null===(e=O.current)||void 0===e?void 0:e.activatePanMode()},onRenameBoard:()=>Y(!0),onDeleteBoard:F,isListening:em,interimTranscript:ex,onToggleDictation:eg,onOpenNotepad:eI,onLocateElement:eR,onAddComment:eB,addElement:ey,clearCanvas:()=>B(k),onExportBoardToPng:eF,onFormatToggle:()=>H(e=>!e),isFormatToolbarOpen:_,onOpenGlobalSearch:()=>ep(!0)}),(0,n.jsx)(aj,{isOpen:_,onClose:()=>H(!1),elements:Q?[Q]:[],onAddComment:eB,onEditComment:eA,isMobileSheet:x,onLocateElement:eR,onPanToggle:()=>{var e;W(e=>!e),null===(e=O.current)||void 0===e||e.activatePanMode()},addElement:ey,isPanningActive:V,selectedElement:Q}),(0,n.jsx)(aE,{isOpen:q,onOpenChange:K,notepad:et,onSaveFormat:eZ}),(0,n.jsx)(aw,{isOpen:U,onOpenChange:J,onAddImage:async e=>{await ey("image",{content:{url:e},properties:{size:{width:300,height:200}}}),J(!1)}}),ei&&(0,n.jsx)(az,{isOpen:es,onOpenChange:el,comment:ei,onUpdate:S,onDelete:T}),(0,n.jsx)(aD,{element:Q,isVisible:ec,onClose:()=>ed(!1)}),(0,n.jsx)(aR,{elements:k||[],isOpen:eu,onClose:()=>ep(!1),onLocateElement:eR})]})]})}function aZ(){let e=(0,r.useParams)(),t=null==e?void 0:e.boardId;return t?(0,n.jsx)(aM,{boardId:t}):(0,n.jsxs)("div",{className:"flex h-screen w-full flex-col items-center justify-center",style:{backgroundColor:"#96e4e6"},children:[(0,n.jsx)(l.Z,{className:"h-8 w-8 animate-spin text-slate-900"}),(0,n.jsx)("p",{className:"mt-4 text-lg font-semibold text-slate-900",children:"Cargando tablero..."})]})}},71488:function(e,t,a){"use strict";a.d(t,{_v:function(){return d},aJ:function(){return c},pn:function(){return i},u:function(){return o}});var n=a(57437),r=a(2265),s=a(91668),l=a(93448);let i=s.zt,o=s.fC,c=s.xz,d=r.forwardRef((e,t)=>{let{className:a,sideOffset:r=4,...i}=e;return(0,n.jsx)(s.VY,{ref:t,sideOffset:r,className:(0,l.cn)("z-50 overflow-hidden rounded-md bg-slate-900 px-2 py-1 text-xs text-white shadow-lg","animate-in fade-in-0 zoom-in-95","data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95","data-[side=bottom]:slide-in-from-top-1 data-[side=left]:slide-in-from-right-1","data-[side=right]:slide-in-from-left-1 data-[side=top]:slide-in-from-bottom-1",a),...i})});d.displayName=s.VY.displayName},63996:function(e,t,a){"use strict";a.d(t,{CU:function(){return i},aF:function(){return o}}),a(57437);var n=a(2265);let r={firebaseApp:null,firestore:null,auth:null,storage:null,user:null,isUserLoading:!0,userError:null},s=(0,n.createContext)(r),l=()=>{let e=(0,n.useContext)(s);return void 0===e?(console.error("useFirebaseContext must be used within a FirebaseProvider."),r):e},i=()=>{var e,t;return null!==(t=null===(e=l())||void 0===e?void 0:e.firestore)&&void 0!==t?t:null},o=()=>{let{user:e,isUserLoading:t,userError:a}=l();return{user:e,isUserLoading:t,userError:a}}},5690:function(e,t,a){"use strict";function n(e){let t=window.getSelection();if(!t||0===t.rangeCount)return null;let a=t.getRangeAt(0),n=a.cloneRange();n.selectNodeContents(e),n.setEnd(a.endContainer,a.endOffset);let r=n.toString().length,s=r+a.toString().length;return{start:r,end:s,node:a.endContainer}}function r(e,t){if(!t)return!1;let a=window.getSelection();if(!a)return!1;try{var n,r,s,l;let i=document.createTreeWalker(e,NodeFilter.SHOW_TEXT,null),o=0,c=null,d=0;for(;i.nextNode();){let e=i.currentNode,a=(null===(r=e.textContent)||void 0===r?void 0:r.length)||0;if(o+a>=t.start){c=e,d=t.start-o;break}o+=a}if(!c){let t=function(e){let t=document.createTreeWalker(e,NodeFilter.SHOW_TEXT,null),a=null;for(;t.nextNode();)a=t.currentNode;return a}(e);if(t)c=t,d=(null===(s=t.textContent)||void 0===s?void 0:s.length)||0;else{let t=document.createRange();return t.selectNodeContents(e),t.collapse(!1),a.removeAllRanges(),a.addRange(t),!0}}let u=document.createRange();if(u.setStart(c,Math.min(d,(null===(n=c.textContent)||void 0===n?void 0:n.length)||0)),t.end!==t.start){let a=0,n=document.createTreeWalker(e,NodeFilter.SHOW_TEXT,null);for(;n.nextNode();){let e=n.currentNode,r=(null===(l=e.textContent)||void 0===l?void 0:l.length)||0;if(a+r>=t.end){u.setEnd(e,t.end-a);break}a+=r}}else u.collapse(!0);return a.removeAllRanges(),a.addRange(u),!0}catch(n){console.error("Error restaurando cursor:",n);let t=document.createRange();return t.selectNodeContents(e),t.collapse(!1),a.removeAllRanges(),a.addRange(t),!1}}function s(e,t){if(e.innerHTML===t)return;let a=n(e);e.innerHTML=t,a&&setTimeout(()=>{r(e,a)},0)}a.r(t),a.d(t,{restoreCursorPosition:function(){return r},saveCursorPosition:function(){return n},updateInnerHTMLPreservingCursor:function(){return s}})},55392:function(){}},function(e){e.O(0,[35,358,637,125,505,337,338,279,899,876,712,39,656,682,53,971,117,744],function(){return e(e.s=58781)}),_N_E=e.O()}]);